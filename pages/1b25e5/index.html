<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.29">
    <link rel="icon" href="/img/memo-favicon.ico"><title>关于yum仓库往nexus私服传包等实践 | Memo</title><meta name="description" content="这是我的第一个 VuePress 站点">
    <link rel="modulepreload" href="./assets/app.dbf5d933.js"><link rel="modulepreload" href="./assets/index.html.684f33a2.js"><link rel="modulepreload" href="./assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="./assets/index.html.5cbbfe55.js">
    <link rel="stylesheet" href="./assets/style.9ca9d938.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a aria-current="page" href="/./pages/1b25e5/" class="router-link-active router-link-exact-active"><!----><span class="site-name can-hide">Memo</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/./" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="专题"><span class="title">专题</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="专题"><span class="title">专题</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./topic/pages/2351.html" class="nav-link" aria-label="ELK"><!--[--><!--]--> ELK <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/1742.html" class="nav-link" aria-label="K8S"><!--[--><!--]--> K8S <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/45c5da/" class="nav-link" aria-label="Nexus"><!--[--><!--]--> Nexus <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/2415.html" class="nav-link" aria-label="Jenkins"><!--[--><!--]--> Jenkins <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/220101204130/" class="nav-link" aria-label="Go"><!--[--><!--]--> Go <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/22020104155458/" class="nav-link" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="周刊"><span class="title">周刊</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="周刊"><span class="title">周刊</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./weekly/pages/11c668/" class="nav-link" aria-label="2021"><!--[--><!--]--> 2021 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./weekly/pages/220103181312/" class="nav-link" aria-label="2022"><!--[--><!--]--> 2022 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="编程"><span class="title">编程</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="编程"><span class="title">编程</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./code/pages/aeab08/" class="nav-link" aria-label="Golang"><!--[--><!--]--> Golang <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./code/pages/5164.html" class="nav-link" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./code/pages/531.html" class="nav-link" aria-label="Shell"><!--[--><!--]--> Shell <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="运维"><span class="title">运维</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="运维"><span class="title">运维</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./ops/pages/027a17/" class="nav-link" aria-label="最佳实践"><!--[--><!--]--> 最佳实践 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/29.html" class="nav-link" aria-label="迎刃而解"><!--[--><!--]--> 迎刃而解 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/930.html" class="nav-link" aria-label="Nginx"><!--[--><!--]--> Nginx <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/2782.html" class="nav-link" aria-label="Php"><!--[--><!--]--> Php <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/596.html" class="nav-link" aria-label="Zabbix"><!--[--><!--]--> Zabbix <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/2468.html" class="nav-link" aria-label="Prometheus"><!--[--><!--]--> Prometheus <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/5380.html" class="nav-link" aria-label="Grafana"><!--[--><!--]--> Grafana <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/5279.html" class="nav-link" aria-label="CentOS"><!--[--><!--]--> CentOS <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/1847.html" class="nav-link" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/5173.html" class="nav-link" aria-label="Ansible"><!--[--><!--]--> Ansible <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/3410.html" class="nav-link" aria-label="Ldap"><!--[--><!--]--> Ldap <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/202208241125/" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/2951.html" class="nav-link" aria-label="Kafka"><!--[--><!--]--> Kafka <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/202209081510" class="nav-link" aria-label="MySQL"><!--[--><!--]--> MySQL <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/4050.html" class="nav-link" aria-label="Etcd"><!--[--><!--]--> Etcd <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/285.html" class="nav-link" aria-label="Other"><!--[--><!--]--> Other <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="博客"><span class="title">博客</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="博客"><span class="title">博客</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./blog/pages/211229105530.html" class="nav-link" aria-label="博客相关"><!--[--><!--]--> 博客相关 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/eryajf/eryajf.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="切换夜间模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/./" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="专题"><span class="title">专题</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="专题"><span class="title">专题</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./topic/pages/2351.html" class="nav-link" aria-label="ELK"><!--[--><!--]--> ELK <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/1742.html" class="nav-link" aria-label="K8S"><!--[--><!--]--> K8S <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/45c5da/" class="nav-link" aria-label="Nexus"><!--[--><!--]--> Nexus <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/2415.html" class="nav-link" aria-label="Jenkins"><!--[--><!--]--> Jenkins <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/220101204130/" class="nav-link" aria-label="Go"><!--[--><!--]--> Go <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/22020104155458/" class="nav-link" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="周刊"><span class="title">周刊</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="周刊"><span class="title">周刊</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./weekly/pages/11c668/" class="nav-link" aria-label="2021"><!--[--><!--]--> 2021 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./weekly/pages/220103181312/" class="nav-link" aria-label="2022"><!--[--><!--]--> 2022 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="编程"><span class="title">编程</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="编程"><span class="title">编程</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./code/pages/aeab08/" class="nav-link" aria-label="Golang"><!--[--><!--]--> Golang <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./code/pages/5164.html" class="nav-link" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./code/pages/531.html" class="nav-link" aria-label="Shell"><!--[--><!--]--> Shell <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="运维"><span class="title">运维</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="运维"><span class="title">运维</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./ops/pages/027a17/" class="nav-link" aria-label="最佳实践"><!--[--><!--]--> 最佳实践 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/29.html" class="nav-link" aria-label="迎刃而解"><!--[--><!--]--> 迎刃而解 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/930.html" class="nav-link" aria-label="Nginx"><!--[--><!--]--> Nginx <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/2782.html" class="nav-link" aria-label="Php"><!--[--><!--]--> Php <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/596.html" class="nav-link" aria-label="Zabbix"><!--[--><!--]--> Zabbix <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/2468.html" class="nav-link" aria-label="Prometheus"><!--[--><!--]--> Prometheus <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/5380.html" class="nav-link" aria-label="Grafana"><!--[--><!--]--> Grafana <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/5279.html" class="nav-link" aria-label="CentOS"><!--[--><!--]--> CentOS <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/1847.html" class="nav-link" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/5173.html" class="nav-link" aria-label="Ansible"><!--[--><!--]--> Ansible <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/3410.html" class="nav-link" aria-label="Ldap"><!--[--><!--]--> Ldap <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/202208241125/" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/2951.html" class="nav-link" aria-label="Kafka"><!--[--><!--]--> Kafka <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/202209081510" class="nav-link" aria-label="MySQL"><!--[--><!--]--> MySQL <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/4050.html" class="nav-link" aria-label="Etcd"><!--[--><!--]--> Etcd <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/285.html" class="nav-link" aria-label="Other"><!--[--><!--]--> Other <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="博客"><span class="title">博客</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="博客"><span class="title">博客</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./blog/pages/211229105530.html" class="nav-link" aria-label="博客相关"><!--[--><!--]--> 博客相关 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/eryajf/eryajf.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><p>如何配置一个yum私服，这个问题很早之前就已经研究过，博客也发表过此文章：<a href="https://wiki.eryajf.net/pages/2002.html" target="_blank" rel="noopener noreferrer">使用nexus3配置yum私有仓库<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>，只不过打算重新启用的时候，发现原来博客中前半部分的配置没什么毛病，在后半部分的使用上，则稍有欠缺，这里另起文章，作为补充。</p><p>这个跟Python私服有点类似：</p><p>其实用一句话来表述，就是<code>通过私服拉包的时候，走group的代理，从本地上传包的时候，要走local的仓库。</code></p><p>接下来就记录一下配置方法并用测试包来验证下。</p><p>创建私服的过程这里不详述了，已知现有Yum私仓，物料信息如下：</p><ul><li>group：http://nexus.test.com/repository/yum/</li><li>local：http://nexus.test.com/repository/wpt-yum-local/</li></ul><p>这两个仓库在客户端引用的时候，要分别配置，其中group可代理外部包自动下载，一些想要固定版本之类的包，则可以通过上传到local里边进行存储。</p><p>group的配置上边文章已经介绍，这里着重说一下local仓库的应用，本文以将elk-7.14.0版本的RPM包及其依赖down到本地并传到私服的全流程。</p><h2 id="_1-配置elk-repo" tabindex="-1"><a class="header-anchor" href="#_1-配置elk-repo" aria-hidden="true">#</a> 1，配置elk-repo</h2><p>首先要在一台能够联网的的主机上配置elk的repo，最好是能访问国外网站的节点，通过 <code>repotrack</code>命令将RPM包及依赖下载到本地。</p><p>一些软件包repo源在国外，并不容易下载，这里提供一个开源的国内镜像同步搜索工具:</p><p>::: cardList 1</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> search<span class="token punctuation">-</span>mirror
  <span class="token key atrule">desc</span><span class="token punctuation">:</span> 开源软件的国内镜像站点
  <span class="token key atrule">avatar</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//avatars2.githubusercontent.com/u/416130<span class="token punctuation">?</span>s=460<span class="token important">&amp;u=8753e86600e300a9811cdc539aa158deec2e2724&amp;v=4</span> <span class="token comment"># 可选</span>
  <span class="token key atrule">link</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//m.eryajf.net/<span class="token comment">#/</span>
  <span class="token key atrule">bgColor</span><span class="token punctuation">:</span> <span class="token string">&#39;#FBDE4B&#39;</span> <span class="token comment"># 可选，默认var(--bodyBg)。颜色值有#号时请添加单引号</span>
  <span class="token key atrule">textColor</span><span class="token punctuation">:</span> <span class="token string">&#39;#fff&#39;</span> <span class="token comment"># 可选，默认var(--textColor)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>:::</p><p>参考elastic官方文档，可以看到<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.14/rpm.html" target="_blank" rel="noopener noreferrer">7.x<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>（另外<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.7/rpm.html" target="_blank" rel="noopener noreferrer">6.x<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>）的repo配置姿势大致如下：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 安装秘钥</span>
$ <span class="token function">rpm</span> --import https://artifacts.elastic.co/GPG-KEY-elasticsearch

<span class="token comment"># 配置repo</span>
$ <span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/yum.repos.d/es7.repo <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
[elasticsearch]
name=Elasticsearch repository for 7.x packages
baseurl=https://artifacts.elastic.co/packages/7.x/yum
gpgcheck=1
gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
enabled=1
autorefresh=1
type=rpm-md
EOF</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>注意官方配置的 <code>enabled=</code>为<code>0</code>，这里要改成<code>1</code>。</p><p>如上配置搞定之后，来两步常规的构建缓存动作：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ yum clean all
$ yum makecache
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>缓存构建完毕，这个时候可以简单查看一下源里的包：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ yum list <span class="token operator">|</span><span class="token function">grep</span> elasticsearch
apm-server.i686                           <span class="token number">7.14</span>.0-1                   elasticsearch
apm-server.x86_64                         <span class="token number">7.14</span>.0-1                   elasticsearch
app-search.noarch                         <span class="token number">7.6</span>.2-1                    elasticsearch
auditbeat.i686                            <span class="token number">7.14</span>.0-1                   elasticsearch
auditbeat.x86_64                          <span class="token number">7.14</span>.0-1                   elasticsearch
elastic-agent.i686                        <span class="token number">7.12</span>.1-1                   elasticsearch
elastic-agent.x86_64                      <span class="token number">7.14</span>.0-1                   elasticsearch
elasticsearch.x86_64                      <span class="token number">7.14</span>.0-1                   elasticsearch
enterprise-search.noarch                  <span class="token number">7.14</span>.0-1                   elasticsearch
filebeat.i686                             <span class="token number">7.14</span>.0-1                   elasticsearch
filebeat.x86_64                           <span class="token number">7.14</span>.0-1                   elasticsearch
heartbeat-elastic.i686                    <span class="token number">7.14</span>.0-1                   elasticsearch
heartbeat-elastic.x86_64                  <span class="token number">7.14</span>.0-1                   elasticsearch
journalbeat.i686                          <span class="token number">7.14</span>.0-1                   elasticsearch
journalbeat.x86_64                        <span class="token number">7.14</span>.0-1                   elasticsearch
kibana.x86_64                             <span class="token number">7.14</span>.0-1                   elasticsearch
logstash.noarch                           <span class="token number">1</span>:7.9.3-1                  elasticsearch
logstash.x86_64                           <span class="token number">1</span>:7.14.0-1                 elasticsearch
metricbeat.i686                           <span class="token number">7.14</span>.0-1                   elasticsearch
metricbeat.x86_64                         <span class="token number">7.14</span>.0-1                   elasticsearch
packetbeat.i686                           <span class="token number">7.14</span>.0-1                   elasticsearch
packetbeat.x86_64                         <span class="token number">7.14</span>.0-1                   elasticsearch
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>可以看到我们常用的几大金刚的rpm包全在里边了。</p><p><code>注意</code>：这个地方不指定版本的时候，默认是对应大版本的最后一个版本，我们亦可以通过 <code>yum list | grep elasticsearch-7.10.1</code>来查看指定小版本的包。</p><p><img src="http://t.eryajf.net/imgs/2021/09/3ddc54d030b9c22e.jpg" alt="20210429— - 2021-04-29T154332.757"></p><h2 id="_2-下载包" tabindex="-1"><a class="header-anchor" href="#_2-下载包" aria-hidden="true">#</a> 2，下载包</h2><p>如上准备工作完成之后，我们就要下载包了，下载包有多种方式，<a href="https://www.cnblogs.com/dyh004/p/13975275.html" target="_blank" rel="noopener noreferrer">这篇文章<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>介绍了三种方式，其中的 <code>repotrack</code>既能下载RPM包及依赖又能下载依赖的依赖，因此针对一些离线环境是比较友好的，这里也使用此命令。</p><p>我们首先将四大金刚写入到一个文件：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">cat</span> a
kibana
elasticsearch
logstash
filebeat
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>然后使用如下命令将包缓存到本地：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> a<span class="token variable">`</span></span><span class="token punctuation">;</span><span class="token keyword">do</span> repotrack <span class="token variable">$i</span> -p <span class="token number">7</span><span class="token punctuation">;</span><span class="token keyword">done</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li><code>-p</code>参数是指定包的下载路径。</li></ul><p>同理，如果你想缓存其他指定版本的包，可用如下命令：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> a<span class="token variable">`</span></span><span class="token punctuation">;</span><span class="token keyword">do</span> repotrack <span class="token variable">$i</span>-7.10.1 -p <span class="token number">7</span><span class="token punctuation">;</span><span class="token keyword">done</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>命令跑完之后，可以在本地看到缓存下来的RPM包。</p><h2 id="_3-上传到私服" tabindex="-1"><a class="header-anchor" href="#_3-上传到私服" aria-hidden="true">#</a> 3，上传到私服</h2><p>想要缓存的包已经有了之后，就可以通过命令将包批量传到私服了：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> <span class="token number">7</span>
$ <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token function">ls</span><span class="token variable">`</span></span><span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token function">curl</span> -v --user <span class="token string">&#39;admin:admin&#39;</span> --upload-file <span class="token variable">$i</span> http://nexus.test.com/repository/wpt-yum-local/7/os/x86_64/Packages/<span class="token variable">$i</span><span class="token punctuation">;</span><span class="token keyword">done</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>注意</code>：在local这个块儿的path后边加了个 <code>7/os/x86_64/Packages</code>，是为了与group缓存的path对齐，从而在客户端检索的时候能够直接使用。</p><h2 id="_4-正式应用" tabindex="-1"><a class="header-anchor" href="#_4-正式应用" aria-hidden="true">#</a> 4，正式应用</h2><p>私服已经有了RPM包，这个时候找一台客户端主机，可以清空他的repo配置文件：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> /etc/yum.repos.d
$ <span class="token function">mkdir</span> bak <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> * bak
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>添加如下一个配置文件：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/yum.repos.d/nexus.repo <span class="token operator">&lt;&lt;</span> <span class="token string">&#39;EOF&#39;
[nexus]
name=Nexus Repository
baseurl=http://nexus.test.com/repository/yum/$releasever/os/$basearch/
enabled=1
gpgcheck=0

[nexus-local]
name=Nexus Repository
baseurl=http://nexus.test.com/repository/wpt-yum-local/
enabled=1
gpgcheck=0
EOF</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>如上配置将group和local分别写在配置文件，可实现内外两种包都能无忧下载并安装。</p><p>如上配置搞定之后，来两步常规的构建缓存动作：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ yum clean all
$ yum makecache
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>缓存构建完毕，这个时候可以简单查看一下源里的包：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ yum list <span class="token operator">|</span><span class="token function">grep</span> elasticsearch
elasticsearch.x86_64                      <span class="token number">7.14</span>.0-1                   nexus-local
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>此时可以看到这个包是在<code>nexus-local</code>这个源里，那么再进行安装elk的包就直接走本地私服的yum源了。</p><blockquote><p>如上姿势是拿这种标准下的包进行举例，与此雷同的还有诸如remi源同样可以利用此方式转移到本地私服，但是还有一些比如gitlab，或者grafana这种的，默认通过yum源只能安装最新版本，而无法拿到之前的历史版本，这种时候可以直接下载对应版本的rpm包，直接curl上传到私服仓库即可。</p></blockquote><h2 id="_5-报错汇总" tabindex="-1"><a class="header-anchor" href="#_5-报错汇总" aria-hidden="true">#</a> 5，报错汇总</h2><p>在配置之后，将私服配置推广到了所有服务器，过程中遇到了一些报错，这里记录一波。</p><h3 id="_1-yum命令无法执行" tabindex="-1"><a class="header-anchor" href="#_1-yum命令无法执行" aria-hidden="true">#</a> 1，yum命令无法执行</h3><p>只要一执行命令，就报如下错误：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ yum clean
error: rpmdb: BDB0113 Thread/process <span class="token number">19126</span>/139888834549824 failed: BDB1507 Thread died <span class="token keyword">in</span> Berkeley DB library
error: db5 error<span class="token punctuation">(</span>-30973<span class="token punctuation">)</span> from dbenv-<span class="token operator">&gt;</span>failchk: BDB0087 DB_RUNRECOVERY: Fatal error, run database recovery
error: cannot <span class="token function">open</span> Packages index using db5 -  <span class="token punctuation">(</span>-30973<span class="token punctuation">)</span>
error: cannot <span class="token function">open</span> Packages database <span class="token keyword">in</span> /var/lib/rpm
CRITICAL:yum.main:

Error: rpmdb <span class="token function">open</span> failed
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>解决办法：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">rm</span> -rf /var/lib/rpm/__db.*
$ yum clean all <span class="token operator">&amp;&amp;</span> yum makecache
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-安装软件的报错" tabindex="-1"><a class="header-anchor" href="#_2-安装软件的报错" aria-hidden="true">#</a> 2，安装软件的报错</h3><p>在安装软件的时候，报如下错误：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Error: Multilib version problems found. This often means that the root
       cause is something <span class="token keyword">else</span> and multilib version checking is just
       pointing out that there is a problem. Eg.:

         <span class="token number">1</span>. You have an upgrade <span class="token keyword">for</span> libuuid <span class="token function">which</span> is missing some
            dependency that another package requires. Yum is trying to
            solve this by installing an older version of libuuid of the
            different architecture. If you exclude the bad architecture
            yum will tell you what the root cause is <span class="token punctuation">(</span>which package
            requires what<span class="token punctuation">)</span>. You can try redoing the upgrade with
            --exclude libuuid.otherarch <span class="token punctuation">..</span>. this should give you an error
            message showing the root cause of the problem.

         <span class="token number">2</span>. You have multiple architectures of libuuid installed, but
            yum can only see an upgrade <span class="token keyword">for</span> one of those architectures.
            If you don&#39;t want/need both architectures anymore <span class="token keyword">then</span> you
            can remove the one with the missing update and everything
            will work.

         <span class="token number">3</span>. You have duplicate versions of libuuid installed already.
            You can use <span class="token string">&quot;yum check&quot;</span> to get yum show these errors.

       <span class="token punctuation">..</span>.you can also use --setopt<span class="token operator">=</span>protected_multilib<span class="token operator">=</span>false to remove
       this checking, however this is almost never the correct thing to
       <span class="token keyword">do</span> as something <span class="token keyword">else</span> is very likely to go wrong <span class="token punctuation">(</span>often causing
       much <span class="token function">more</span> problems<span class="token punctuation">)</span>.

       Protected multilib versions: libuuid-2.23.2-65.el7.i686 <span class="token operator">!=</span> libuuid-2.23.2-65.el7_9.1.x86_64
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>那么在安装的时候加上提示的参数即可解决此问题：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ yum <span class="token function">install</span> openresty --setopt<span class="token operator">=</span>protected_multilib<span class="token operator">=</span>false
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/eryajf/eryajf.github.io/edit/main/02.系列专题/01.Nexus系列文章/14.关于yum仓库往nexus私服传包等实践.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页"><!--[--><!--]--> 在 GitHub 上编辑此页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: fengxuechao@tal.com">fengxuechao</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="./assets/app.dbf5d933.js" defer></script>
  </body>
</html>
