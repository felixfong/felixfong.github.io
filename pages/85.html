<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.29">
    <link rel="icon" href="/img/memo-favicon.ico"><title>Jenkins中一个项目的构建 | Memo</title><meta name="description" content="这是我的第一个 VuePress 站点">
    <link rel="modulepreload" href="./assets/app.dbf5d933.js"><link rel="modulepreload" href="./assets/85.html.90e3a013.js"><link rel="modulepreload" href="./assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="./assets/85.html.a081e12a.js">
    <link rel="stylesheet" href="./assets/style.9ca9d938.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/./pages/" class=""><!----><span class="site-name can-hide">Memo</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/./" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="专题"><span class="title">专题</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="专题"><span class="title">专题</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./topic/pages/2351.html" class="nav-link" aria-label="ELK"><!--[--><!--]--> ELK <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/1742.html" class="nav-link" aria-label="K8S"><!--[--><!--]--> K8S <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/45c5da/" class="nav-link" aria-label="Nexus"><!--[--><!--]--> Nexus <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/2415.html" class="nav-link" aria-label="Jenkins"><!--[--><!--]--> Jenkins <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/220101204130/" class="nav-link" aria-label="Go"><!--[--><!--]--> Go <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/22020104155458/" class="nav-link" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="周刊"><span class="title">周刊</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="周刊"><span class="title">周刊</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./weekly/pages/11c668/" class="nav-link" aria-label="2021"><!--[--><!--]--> 2021 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./weekly/pages/220103181312/" class="nav-link" aria-label="2022"><!--[--><!--]--> 2022 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="编程"><span class="title">编程</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="编程"><span class="title">编程</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./code/pages/aeab08/" class="nav-link" aria-label="Golang"><!--[--><!--]--> Golang <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./code/pages/5164.html" class="nav-link" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./code/pages/531.html" class="nav-link" aria-label="Shell"><!--[--><!--]--> Shell <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="运维"><span class="title">运维</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="运维"><span class="title">运维</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./ops/pages/027a17/" class="nav-link" aria-label="最佳实践"><!--[--><!--]--> 最佳实践 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/29.html" class="nav-link" aria-label="迎刃而解"><!--[--><!--]--> 迎刃而解 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/930.html" class="nav-link" aria-label="Nginx"><!--[--><!--]--> Nginx <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/2782.html" class="nav-link" aria-label="Php"><!--[--><!--]--> Php <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/596.html" class="nav-link" aria-label="Zabbix"><!--[--><!--]--> Zabbix <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/2468.html" class="nav-link" aria-label="Prometheus"><!--[--><!--]--> Prometheus <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/5380.html" class="nav-link" aria-label="Grafana"><!--[--><!--]--> Grafana <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/5279.html" class="nav-link" aria-label="CentOS"><!--[--><!--]--> CentOS <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/1847.html" class="nav-link" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/5173.html" class="nav-link" aria-label="Ansible"><!--[--><!--]--> Ansible <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/3410.html" class="nav-link" aria-label="Ldap"><!--[--><!--]--> Ldap <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/202208241125/" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/2951.html" class="nav-link" aria-label="Kafka"><!--[--><!--]--> Kafka <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/202209081510" class="nav-link" aria-label="MySQL"><!--[--><!--]--> MySQL <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/4050.html" class="nav-link" aria-label="Etcd"><!--[--><!--]--> Etcd <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/285.html" class="nav-link" aria-label="Other"><!--[--><!--]--> Other <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="博客"><span class="title">博客</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="博客"><span class="title">博客</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./blog/pages/211229105530.html" class="nav-link" aria-label="博客相关"><!--[--><!--]--> 博客相关 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/eryajf/eryajf.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="切换夜间模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/./" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="专题"><span class="title">专题</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="专题"><span class="title">专题</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./topic/pages/2351.html" class="nav-link" aria-label="ELK"><!--[--><!--]--> ELK <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/1742.html" class="nav-link" aria-label="K8S"><!--[--><!--]--> K8S <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/45c5da/" class="nav-link" aria-label="Nexus"><!--[--><!--]--> Nexus <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/2415.html" class="nav-link" aria-label="Jenkins"><!--[--><!--]--> Jenkins <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/220101204130/" class="nav-link" aria-label="Go"><!--[--><!--]--> Go <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./topic/pages/22020104155458/" class="nav-link" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="周刊"><span class="title">周刊</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="周刊"><span class="title">周刊</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./weekly/pages/11c668/" class="nav-link" aria-label="2021"><!--[--><!--]--> 2021 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./weekly/pages/220103181312/" class="nav-link" aria-label="2022"><!--[--><!--]--> 2022 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="编程"><span class="title">编程</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="编程"><span class="title">编程</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./code/pages/aeab08/" class="nav-link" aria-label="Golang"><!--[--><!--]--> Golang <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./code/pages/5164.html" class="nav-link" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./code/pages/531.html" class="nav-link" aria-label="Shell"><!--[--><!--]--> Shell <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="运维"><span class="title">运维</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="运维"><span class="title">运维</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./ops/pages/027a17/" class="nav-link" aria-label="最佳实践"><!--[--><!--]--> 最佳实践 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/29.html" class="nav-link" aria-label="迎刃而解"><!--[--><!--]--> 迎刃而解 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/930.html" class="nav-link" aria-label="Nginx"><!--[--><!--]--> Nginx <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/2782.html" class="nav-link" aria-label="Php"><!--[--><!--]--> Php <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/596.html" class="nav-link" aria-label="Zabbix"><!--[--><!--]--> Zabbix <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/2468.html" class="nav-link" aria-label="Prometheus"><!--[--><!--]--> Prometheus <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/5380.html" class="nav-link" aria-label="Grafana"><!--[--><!--]--> Grafana <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/5279.html" class="nav-link" aria-label="CentOS"><!--[--><!--]--> CentOS <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/1847.html" class="nav-link" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/5173.html" class="nav-link" aria-label="Ansible"><!--[--><!--]--> Ansible <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/3410.html" class="nav-link" aria-label="Ldap"><!--[--><!--]--> Ldap <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/202208241125/" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/2951.html" class="nav-link" aria-label="Kafka"><!--[--><!--]--> Kafka <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/202209081510" class="nav-link" aria-label="MySQL"><!--[--><!--]--> MySQL <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/4050.html" class="nav-link" aria-label="Etcd"><!--[--><!--]--> Etcd <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/./ops/pages/285.html" class="nav-link" aria-label="Other"><!--[--><!--]--> Other <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="博客"><span class="title">博客</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="博客"><span class="title">博客</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/./blog/pages/211229105530.html" class="nav-link" aria-label="博客相关"><!--[--><!--]--> 博客相关 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/eryajf/eryajf.github.io" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="絮叨几句" tabindex="-1"><a class="header-anchor" href="#絮叨几句" aria-hidden="true">#</a> 絮叨几句</h2><p>在上一篇的文章当中，基本上准备工作都做好了，现在就来真刀真枪来进行项目的构建了，在做真正的项目构建之前，有一些简单的准备工作还是要做的。</p><p>我这里就用公司里边的Java项目，全程演示一遍怎么完成这里边的配置。而如果是其他的诸如前端啊，PHP之类的项目，则就更简单了，ok，先来做一些准备工作。</p><h3 id="服务器配备" tabindex="-1"><a class="header-anchor" href="#服务器配备" aria-hidden="true">#</a> 服务器配备：</h3><table><thead><tr><th style="text-align:center;">Jenkins</th><th style="text-align:center;">192.168.96.26</th></tr></thead><tbody><tr><td style="text-align:center;">Gitlab</td><td style="text-align:center;">192.168.96.27</td></tr><tr><td style="text-align:center;">Nexus</td><td style="text-align:center;">192.168.96.28</td></tr><tr><td style="text-align:center;">MySQL</td><td style="text-align:center;">192.168.96.29</td></tr><tr><td style="text-align:center;">Test Tomcat</td><td style="text-align:center;">192.168.96.17</td></tr></tbody></table><p>这个地方看似需要准备的挺多的，其实很多都是已经搞好了的。中间的三个基本上都是我们搭建好了之后，交付给开发人员或者DBA让他们进行操作，我们这里讲的，就只是对Jenkins以及另外一台上的tomcat之间的项目关系。</p><p>很多时候就是这样，把Jenkins作为单独的服务器，然后其他的服务器上，可能会有四到五台的tomcat来进行测试，这里模拟的就是这种测试环境，很多时候看到的网上的教程都是在Jenkins服务器本地直接进行的构建，其实都是一个道理，只要弄通了这整个流程的来龙去脉，能够抓住不变的东西，那么任凭其他的再怎么变，也都不足担心。</p><h3 id="现在需要在要操作的服务器上做一些准备工作" tabindex="-1"><a class="header-anchor" href="#现在需要在要操作的服务器上做一些准备工作" aria-hidden="true">#</a> 现在需要在要操作的服务器上做一些准备工作</h3><ul><li>1， 将Jenkins的秘钥拷贝到Git服务器，以使其在拉取代码的时候免密码操作。</li><li>2， 将Jenkins的秘钥拷贝到testtomcat服务器，以使其在同步等操作的时候免密码。</li><li>3， 在test tomcat 服务器添加与mysql的连接。我们公司是将mysql的ip写入到了test tomcat服务的hosts里边了。</li><li>4， 设置Jenkins上的maven与nexus的连接。</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vim /usr/local/maven/conf/settings.xml
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><img src="http://t.eryajf.net/imgs/2021/09/db211ae382b91b06.jpg" alt="image"></p><p>接着还需要将maven像jdk那样把环境写入到系统配置当中，不然等会儿编译可能会报错。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /etc/profile
 
在最底下添加。
<span class="token comment"># maven所在的目录</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">M2_HOME</span><span class="token operator">=</span>/usr/local/maven
<span class="token builtin class-name">export</span> <span class="token assign-left variable">M2</span><span class="token operator">=</span><span class="token variable">$M2_HOME</span>/bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$M2</span><span class="token builtin class-name">:</span><span class="token environment constant">$PATH</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>现在，终于，可以，进行一个项目的配置了。</p><h2 id="配置开始" tabindex="-1"><a class="header-anchor" href="#配置开始" aria-hidden="true">#</a> 配置开始</h2><p>来到Jenkins界面中。</p><p><img src="http://t.eryajf.net/imgs/2021/09/f3ddbe9e89a23076.jpg" alt="image"></p><p>输入项目的名称，选中构建一个自由风格的项目。</p><hr><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>插曲：大家可能看到这张图带有水印与其他的不一样，因为这张是修改过程中后补上来的。在此要感谢一下读者cooki同学，详细情况在下边留言当中已有表明。嗟乎，人生能有这样的读者，夫复何求！！！</p></div><p><img src="http://t.eryajf.net/imgs/2021/09/7cf0f64b3eb0184e.jpg" alt="image"></p><hr><p>回归正题。</p><p>也可以在最低下复制其他的项目名称，直接copy其他的项目的配置，这样会省去很多相同的操作，非常nice。</p><p><img src="http://t.eryajf.net/imgs/2021/09/b5654d902faf7027.jpg" alt="image"></p><p>点击确定，进行下一步</p><p><img src="http://t.eryajf.net/imgs/2021/09/38683527e30a9a7b.jpg" alt="image"></p><p>选择参数化构建过程，这里都是拿干货来说了，其他不重要的，可以自己进行测试着玩。 最后配置出来是这个样子</p><p><img src="http://t.eryajf.net/imgs/2021/09/3c68ae86ce04911d.jpg" alt="image"></p><p>基本上这样就能够满足测试之需求了，注意这里边的名称都是可以作为参数进行传递的。一般项目都是有部署与回滚的功能，而在部署当中，添加一个Git分支的选择，这对于开发来讲，是非常必要的。</p><p>接下来是代码管理</p><p><img src="http://t.eryajf.net/imgs/2021/09/c019c63ac09c5346.jpg" alt="image"></p><p>我们这里用的是Git代码库，首先把项目的链接复制过来，然后需要添加一个能够登陆的用户，下边add添加一个就行，如果这个地方总是返回128错误，应该是Jenkins添加秘钥到Git了，但是还没有进行过登陆的确认，这个时候到服务器上进行一次代码的clone，然后就会看到这个地方的报错消失了。</p><p>这个时候，先不做其他任何操作，我们直接保存设置，然后进行一次构建看看再说。</p><p><img src="http://t.eryajf.net/imgs/2021/09/a43cfde5771284cf.jpg" alt="image"></p><p>点击进去</p><p><img src="http://t.eryajf.net/imgs/2021/09/bcc7454bcc9ad696.jpg" alt="image"></p><p>如果是第一次构建，那么这个地方会从nexus库当中下载很多需要的依赖包，但是这些并不是我想展示出来看的，真正想看到的是，Jenkins会在自己的工作目录当中创建这样一个项目，然后将所有的代码给拉取过来，随后进行编译的动作。</p><p><img src="http://t.eryajf.net/imgs/2021/09/09a11bc8c5a05262.jpg" alt="image"></p><p>这个就是刚刚创建的项目名称，进去之后就能看到源代码了。 源码当然是不能看咯，不过现在可以把目光拉到Jenkins刚才的构建界面来。</p><p><img src="http://t.eryajf.net/imgs/2021/09/2ee657e2fc13874e.jpg" alt="image"></p><p>这个构建项目需要依赖于antx.properties这个配置文件但是第一次构建还没有这个文件，因此会提示让更新一下，而Jenkins的web界面又是不提供这种交互功能的，于是来到服务器上进行编译并更新。（注意，以后如果开发人员再次对这个文件更新或者更改，部署的时候可能还会出现这样的情况，会一直提示让选择更新，却又选择不了，于是，需要告知开发人员，遇到这种情况，立马叉掉停止构建。）</p><p>到服务器上进入刚才的项目目录执行下边命令</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mvn clean <span class="token function">install</span> -Dmaven.test.skip<span class="token operator">=</span>true
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>稍等一会儿，会提示让更新：</p><p><img src="http://t.eryajf.net/imgs/2021/09/606a9120e9793b0d.jpg" alt="image"></p><p>输入y q y就行了，然后会保存在root目录下，如下图中所展示：</p><p><img src="http://t.eryajf.net/imgs/2021/09/368e557b3d84bdab.jpg" alt="image"></p><p>接着就会看到编译成功的界面</p><p><img src="http://t.eryajf.net/imgs/2021/09/1ca90777d24fa794.jpg" alt="image"></p><p>注意：现在这种操作逻辑呢，是Jenkins将代码从Git服务器拉去到Jenkins服务器上，然后在Jenkins服务器本机上进行编译的操作，比较建议这样的操作，因为Jenkins服务器相对于那些可能有四五个tomcat在跑着的服务器来说，压力会小很多很多，因此建议在Jenkins编译然后将war包同步到测试服务器。</p><p>编译完成之后，会在相应的目录下边生成一个war包，具体是什么目录，则由开发人员在代码当中定义的，不过一般规范化的话，会在web/target下</p><p><img src="http://t.eryajf.net/imgs/2021/09/f6a7954430f7a385.jpg" alt="image"></p><p>那么，再将这个包拷到测试服务器对应目录下，重启tomcat不就行了，事实上就是这样的，现在我们回到Jenkins的web界面来将这些事儿给完成了。</p><p><img src="http://t.eryajf.net/imgs/2021/09/b9b4fd7fe5b8d0ef.jpg" alt="image"></p><p>在构建界面找到Execute shell，可能上级目录略有不同，但是找到这个就对了，将构建的脚本进去。脚本内容如下：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment">#git checkout new_website_dev_20160430</span>
<span class="token comment">#git pull</span>
<span class="token comment">#mvn clean package -Dmaven.test.skip=true</span>
 
<span class="token assign-left variable">APP_DIR</span><span class="token operator">=</span>/usr/local/tomcat/WAR   <span class="token comment">#注意这个目录对方服务器（也就是test tomcat服务器）默认没有，需要创建</span>
 
<span class="token keyword">function</span> <span class="token function-name function">MVN-SCP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
chattr +i /root/antx.properties
<span class="token builtin class-name">cd</span> <span class="token variable">$WORKSPACE</span>
mvn clean <span class="token function">install</span> -Dmaven.test.skip<span class="token operator">=</span>true
chattr -i /root/antx.properties
 
<span class="token function">scp</span>  <span class="token variable">$WORKSPACE</span>/web/target/ROOT.war root@192.168.96.17:<span class="token variable">$APP_DIR</span>/
<span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> -e <span class="token string">&#39;\033[31m[ error ] Failed to scp the ROOT.war\033[0m&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token function">sleep</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">function</span> <span class="token function-name function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;MVN &amp; SCP&quot;</span>
  MVN-SCP
  <span class="token function">sleep</span> <span class="token number">3</span>
<span class="token function">ssh</span> root@192.168.96.17 <span class="token string">&quot;echo &quot;</span>调用部署<span class="token string">&quot; &amp;&amp; /usr/local/scripts/deploy.sh <span class="token variable">$mode</span>&quot;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">function</span> <span class="token function-name function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token function">ssh</span> root@192.168.96.17 <span class="token string">&quot;echo &quot;</span>调用部署<span class="token string">&quot; &amp;&amp; /usr/local/scripts/deploy.sh <span class="token variable">$mode</span>&quot;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">case</span> <span class="token variable">$mode</span> <span class="token keyword">in</span>
 deploy<span class="token punctuation">)</span>
        deploy
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
 rollback<span class="token punctuation">)</span>
        rollback
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
 *<span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> $<span class="token string">&quot;Usage: <span class="token variable">$0</span> {deploy|rollback}&quot;</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>这里的脚本主要就是完成两件事情，首先把本地拉取的代码进行编译，然后把编译好了的war包传到远程tomcat服务器，接着调用远程服务器的部署脚本（这个脚本下边会列出），这些操作都并不复杂，如果对Linux服务器所有目录结构以及shell脚本熟悉的话。更多的，则就是细心的配置了，很多时候出问题，基本上都是变量不统一或者脚本调用有误。</p><p>刚才说了部署的时候调用了一下远程的部署脚本，那么在远程服务器上的脚本是怎样的呢，是这样的：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash  </span>
<span class="token builtin class-name">source</span> /etc/profile  
<span class="token assign-left variable">tomcat_dir</span><span class="token operator">=</span>/usr/local/tomcat  
<span class="token assign-left variable">bak_dir</span><span class="token operator">=</span><span class="token variable">$tomcat_dir</span>/WAR_backup  
<span class="token assign-left variable">date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">&quot;%Y%m%d%H%M%S&quot;</span><span class="token variable">)</span></span>  
<span class="token function-name function">stop_tomcat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
   <span class="token function">ps</span> aux <span class="token operator">|</span><span class="token function">grep</span> tomcat<span class="token operator">|</span><span class="token function">grep</span> -v <span class="token function">grep</span><span class="token operator">|</span><span class="token function">awk</span> <span class="token string">&#39;{print $2}&#39;</span><span class="token operator">|</span><span class="token function">xargs</span> <span class="token function">kill</span> -9  
<span class="token punctuation">}</span>  
<span class="token function-name function">start_tomcat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
   /bin/bash  <span class="token variable">$tomcat_dir</span>/bin/startup.sh  
<span class="token punctuation">}</span>  
 
<span class="token function-name function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
<span class="token builtin class-name">echo</span> <span class="token string">&quot;stop_tomcat&quot;</span>  
   stop_tomcat  
     
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;backup_war&quot;</span>  
 <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token variable">$bak_dir</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> -p <span class="token variable">$bak_dir</span>  
   <span class="token function">cp</span> <span class="token variable">$tomcat_dir</span>/webapps/ROOT.war <span class="token variable">$bak_dir</span>/ROOT_<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">&quot;%y%m%d%H%M%S&quot;</span><span class="token variable">)</span></span>.war <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>mv <span class="token variable">$tomcat_dir</span>/webapps/ROOT.<span class="token punctuation">{</span>war,warbak<span class="token punctuation">}</span>  
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;rm -rf <span class="token variable">$tomcat_dir</span>/webapps/ROOT&quot;</span>  
   <span class="token function">rm</span> -rf <span class="token variable">$tomcat_dir</span>/webapps/ROOT <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> <span class="token variable">$tomcat_dir</span>/WAR/ROOT.war <span class="token variable">$tomcat_dir</span>/webapps/  
   <span class="token function">sleep</span> <span class="token number">2</span>  
 
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;start_tomcat&quot;</span>  
   start_tomcat  
   <span class="token function">sleep</span> <span class="token number">10</span>  
<span class="token punctuation">}</span>  
 
<span class="token function-name function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;stop_tomcat&quot;</span>  
   stop_tomcat  
   <span class="token function">sleep</span> <span class="token number">2</span>  
 
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;rollback&quot;</span>  
   <span class="token function">rm</span> -f <span class="token variable">$tomcat_dir</span>/webapps/ROOT.war <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -rf <span class="token variable">$tomcat_dir</span>/webapps/ROOT  
   <span class="token function">cp</span> <span class="token variable">$tomcat_dir</span>/webapps/ROOT.<span class="token punctuation">{</span>warbak,war<span class="token punctuation">}</span>  
 
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;start_tomcat&quot;</span>  
   start_tomcat  
   <span class="token function">sleep</span> <span class="token number">10</span>  
<span class="token punctuation">}</span>  
 
<span class="token keyword">case</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span> <span class="token keyword">in</span>  
<span class="token string">&#39;deploy&#39;</span><span class="token punctuation">)</span>  
   deploy  
   <span class="token builtin class-name">echo</span> <span class="token string">&quot;deploy success!!!&quot;</span>  
<span class="token punctuation">;</span><span class="token punctuation">;</span>  
<span class="token string">&#39;rollback&#39;</span><span class="token punctuation">)</span>  
   rollback  
   <span class="token builtin class-name">echo</span> <span class="token string">&quot;rollback success!!!&quot;</span>  
<span class="token punctuation">;</span><span class="token punctuation">;</span>  
*<span class="token punctuation">)</span>  
   <span class="token builtin class-name">echo</span> <span class="token string">&quot;Usage: <span class="token variable">$0</span> {deploy | rollback}&quot;</span>  
   <span class="token builtin class-name">exit</span> <span class="token number">1</span>  
<span class="token keyword">esac</span> 
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><p>而这个脚本的内容也是非常简单的，无论是部署还是回滚，都首先把服务停掉，然后进行war的对应操作，最后再启动服务。</p><p>如果说这个地方tomcat启动失败。那么就从前往后一步一步捋，先看Jenkins构建是否正常，然后再看tomcat启动日志，数据库连接是否正常，相关的环境配置是否妥当。</p><p><code>需要注意一点：</code>这个脚本放置的位置需要与上一个脚本里边指向的位置（<code>/usr/local/scripts</code>）以及名称（<code>deploy.sh</code>）相同。</p><p>当然，这个地方的两个小脚本，只是作为一个示例来讲解出利用脚本与Jenkins的配合，实际生产还应该结合自己环境情况进行不同的调整。</p><p>那么，整个一系列的部署就是这个样子的。</p><p>最后，摘抄一段网上看到的表述Jenkins优点的几点： 摘抄自http://blog.csdn.net/u013602835/article/details/54632843</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>关于这4点，实际使用中还是比较方便的：</p><ul><li>1，构建项目自动化打包可以省去开发人员好多时间，重要的是，Jenkins为我们维护了一套高质量可用的代码，而且保证了一个纯净的环境。我们经常会出现由于本地配置出错而导致打包失败的情况。现在Jenkins就是一个公平的评判者，它无法正确的编译出ipa，那就是有编译错误或者配置问题。开发人员没必要去争论本地是可以运行的，拉取了谁谁谁的代码以后就不能运行了。共同维护Jenkins的正常编译，因为Jenkins的编译环境比我们本地简单的多，它是最纯净无污染的编译环境。开发者就只用专注于编码。这是给开发者带来的便利。</li><li>2，这个可以用来自动化测试。在本地生成大批的测试用例。每天利用服务器不断的跑这些用例。每天每个接口都跑一遍。看上去没必要，但是实际上今天运行正常的系统，很可能由于今天的代码改动，明天就出现问题了。有了Jenkins可以以天为单位的进行回归测试，代码只要有改动，Jenkins就把所有的回归测试的用例全部都跑一遍。在项目工期紧张的情况下，很多情况测试都不是很重视回归测试，毕竟很可能测一遍之后是徒劳的“无用功”。然而由于回归测试不及时，就导致到最后发版的时候系统不可用了，这时候回头查找原因是比较耗时的，查看提交记录，看到上百条提交记录，排查起来也是头疼的事情。以天为单位的回归测试能立即发现问题。测试人员每天可以专注按单元测试，一周手动一次回归测试。这是给测试者带来的便利。</li><li>3，这个是静态代码分析，可以检测出很多代码的问题，比如潜在的内存泄露的问题。由于Jenkins所在环境的纯净，还是可以发现一些我们本地复杂环境无法发现的问题，进一步的提高代码质量。这是给质检带来的便利。</li><li>4，随时部署。Jenkins在打包完成之后可以设定之后的操作，这个时候往往就是提交app到跑测试用例的系统，或者部署到内测平台生成二维码。部署中不能安装等一些低级问题随之立即暴露。测试人员也只需要扫一下二维码即可安装，很方便。这也算是给测试带来的便利。</li></ul></div><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/eryajf/eryajf.github.io/edit/main/02.系列专题/05.Jenkins系列文章/04.Jenkins中一个项目的构建.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页"><!--[--><!--]--> 在 GitHub 上编辑此页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: fengxuechao@tal.com">fengxuechao</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="./assets/app.dbf5d933.js" defer></script>
  </body>
</html>
