---
title: 为什么有了HTTP，还需要有RPC
date: 2022-07-20 16:15
permalink: /topic/pages/202207201615/
categories:
  - 系列专题
  - 为什么系列
tags:
  - 计算机网络
  - 应用层协议
---

## 0. 概述
本文主要想把HTTP协议、RPC协议两者之间的差异和发展历史讲清楚，大家可以做为一个小故事来看，我感觉还是挺不错的。

## 1. 主题
* 为什么有了HTTP，还需要有RPC
* HTTP、RPC两者有什么差异
* 所有接口都使用HTTP可以吗？
* RPC有什么优势

## 2. 从TCP聊起
作为程序员，我们大家都懂得网络数据传输是分为七层架构，那么TCP作为传输层的一种协议，他与上层应用层之间是通过socket通用接口来相互交流的，如：我们服务A的一个进程
想要与另一台服务器B的进程进行传输数据，是需要 `fd = socket(AF_INET, SOCK_STREAM, 0)`; 其中，SOCK_STREAM是字节流数据传输，之后我们需要bind绑定ip，用connect()发起建联，
send()发送数据，recv()接收数据；
那么纯裸的TCP连接收发数据，会有什么问题？基于字节流的这种传输模式是无法知道哪个地方才算一条完整的消息(也就是粘包问题)，所以就需要传输数据时定义好消息的长度。

## 3. HTTP和RPC
HTTP协议和RPC协议，都定义了不同的消息格式。HTTP协议，又叫超文本传输协议，比如我们平时在浏览器上浏览的网页，就是使用到了HTTP协议；
而RPC是一种接口调用方式，本身并不是一种协议，它通过自身定制化的协议来提供远程方法过程调用这种模式，从而使我们程序操作上可以屏蔽掉一些网络细节，用起来方便快捷，其中常见的rpc使用的协议grpc、thrift等

## 4. 既然有了HTTP，为什么还要有RPC？
TCP是70年代出来的协议，而HTTP是90年代才开始流行的。而RPC则在80年代就出来了
其实，从互联网发展的轨迹上看就可以发现从刚开始的浏览器/服务器(B/S)时代，我们的程序接口要针对chrome/IE/firefox各种浏览器，那么各种浏览器厂商就必须统一一个通用的协议，这样服务端就只需要同一个接口
就能完全根据这种协议来使用。后来发展到应用时代自家的app客户端只会请求自家的服务器，从而可以使用RPC协议
现在其实已经没分那么清了，一般公司内部集群里，各个微服务之间的通讯都采用RPC协议，对外提供HTTP协议的接口

## 5. HTTP和RPC有什么区别
服务发现：HTTP只需要通过域名dns发现IP地址和端口，而RPC则使用中间服务，例如consul、etcd，甚至是redis去获得IP和端口信息
底层连接形式：HTTP1.1为例通过长链来减少重复连接，而RPC则使用连接池的方式来解决重复连接问题，go语言的网络库中也会给HTTP增加连接池来提升网络性能
传输的内容：HTTP是以header、body形式来传输数据和告诉传输层数据尺寸大小，RPC则是以字节位来减少不必要的字段冗余

## 6. 备注
虽然大部分rpc底层使用TCP，但实际上他们不一定非得使用TCP，改成UDP、HTTP都是可以的
HTTP2是2015年提出来，其在1.1的基础上做了很多这种冗余字段的改进，所以性能要比1.1高不少，甚至比有些RPC协议还要好，但由于很多公司内部的RPC协议都已经跑了好多年了等历史原因，一般也没必要再换了。

## 7. 总结
纯裸TCP是能收发数据，但它是个无边界的数据流，上层需要定义消息格式用于定义消息边界。于是就有了各种协议，HTTP和各类RPC协议就是在TCP之上定义的应用层协议。
RPC本质上不算是协议，而是一种调用方式，而像gRPC和thrift这样的具体实现，才是协议，它们是实现了RPC调用的协议。目的是希望程序员能像调用本地方法那样去调用远端的服务方法。同时RPC有很多种实现方式，不一定非得基于TCP协议。
从发展历史来说，HTTP主要用于b/s架构，而RPC更多用于c/s架构。但现在其实已经没分那么清了，b/s和c/s在慢慢融合。很多软件同时支持多端，所以对外一般用HTTP协议，而内部集群的微服务之间则采用RPC协议进行通讯。
RPC其实比HTTP出现的要早，且比目前主流的HTTP1.1性能要更好，所以大部分公司内部都还在使用RPC。
HTTP2.0在HTTP1.1的基础上做了优化，性能可能比很多RPC协议都要好，但由于是这几年才出来的，所以也不太可能取代掉RPC。