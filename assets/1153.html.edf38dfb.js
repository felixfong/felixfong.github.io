import{r as o,o as t,c,b as n,a as e,F as l,e as p,d as s}from"./app.dbf5d933.js";import{_ as r}from"./plugin-vue_export-helper.21dcd24c.js";const i={},u=p(`<h2 id="_1-nginx-\u662F\u4EC0\u4E48" tabindex="-1"><a class="header-anchor" href="#_1-nginx-\u662F\u4EC0\u4E48" aria-hidden="true">#</a> 1\uFF0Cnginx \u662F\u4EC0\u4E48\uFF1F</h2><p>Nginx \u662F\u4E00\u4E2A\u57FA\u4E8E c \u8BED\u8A00\u5F00\u53D1\u7684\u9AD8\u6027\u80FD http \u670D\u52A1\u5668\u53CA\u53CD\u5411\u4EE3\u7406\u670D\u52A1\u5668\u3002\u7531\u4FC4\u7F57\u65AF\u7684\u7A0B\u5E8F\u8BBE\u8BA1\u5E08 Igor Sysoev \u6240\u5F00\u53D1\uFF0C\u5B98\u65B9\u6D4B\u8BD5 nginx \u80FD\u591F\u652F\u652F\u6491 5 \u4E07\u5E76\u53D1\u94FE\u63A5\uFF0C\u5E76\u4E14 cpu\u3001\u5185\u5B58\u7B49\u8D44\u6E90\u6D88\u8017\u5374\u975E\u5E38\u4F4E\uFF0C\u8FD0\u884C\u975E\u5E38\u7A33\u5B9A\u3002</p><h2 id="_2-\u4E3A\u4EC0\u4E48\u8981\u7528-nginx" tabindex="-1"><a class="header-anchor" href="#_2-\u4E3A\u4EC0\u4E48\u8981\u7528-nginx" aria-hidden="true">#</a> 2\uFF0C\u4E3A\u4EC0\u4E48\u8981\u7528 nginx\uFF1F</h2><h3 id="\u7406\u7531\u4E00" tabindex="-1"><a class="header-anchor" href="#\u7406\u7531\u4E00" aria-hidden="true">#</a> \u7406\u7531\u4E00\uFF1A</h3><p>\u4F20\u7EDF\u7684\u5C0F\u578B\u7F51\u7AD9\u5E76\u53D1\u91CF\u5C0F\uFF0C\u7528\u6237\u4F7F\u7528\u7684\u5C11\uFF0C\u6240\u4EE5\u5728\u4F4E\u5E76\u53D1\u7684\u60C5\u51B5\u4E0B\uFF0C\u7528\u6237\u53EF\u4EE5\u76F4\u63A5\u8BBF\u95EE tomcat \u670D\u52A1\u5668\uFF0C\u7136\u540E tomcat \u670D\u52A1\u5668\u8FD4\u56DE\u6D88\u606F\u7ED9\u7528\u6237\u3002\u4E3A\u4E86\u89E3\u51B3\u5E76\u53D1\uFF0C\u53EF\u4EE5\u4F7F\u7528\u8D1F\u8F7D\u5747\u8861\uFF0C\u4E5F\u5C31\u662F\u591A\u589E\u52A0\u51E0\u4E2A tomcat \u670D\u52A1\u5668\uFF0C\u5F53\u7528\u6237\u8BBF\u95EE\u7684\u65F6\u5019\uFF0C\u8BF7\u6C42\u53EF\u4EE5\u63D0\u4EA4\u5230\u7A7A\u95F2\u7684 tomcat \u670D\u52A1\u5668\u4E0A\u3002</p><p>\u4F46\u662F\u8FD9\u79CD\u60C5\u51B5\u4E0B\u53EF\u80FD\u4F1A\u51FA\u73B0\u4E00\u79CD\u95EE\u9898\uFF1A\u5047\u8BBE\u628A\u56FE\u7247\u4E0A\u4F20\u5230\u4E86 tomcat1 \u4E0A\u4E86\uFF0C\u5F53\u8981\u8BBF\u95EE\u8FD9\u4E2A\u56FE\u7247\u7684\u65F6\u5019\uFF0Ctomcat1 \u6B63\u597D\u5728\u5DE5\u4F5C\uFF0C\u6240\u4EE5\u8BBF\u95EE\u7684\u8BF7\u6C42\u5C31\u4EA4\u7ED9\u5176\u4ED6\u7684 tomcat \u64CD\u4F5C\uFF0C\u800C tomcat \u4E4B\u95F4\u7684\u6570\u636E\u6CA1\u6709\u8FDB\u884C\u540C\u6B65\uFF0C\u6240\u4EE5\u5C31\u53D1\u751F\u4E86\u6211\u4EEC\u8981\u8BF7\u6C42\u7684\u56FE\u7247\u627E\u4E0D\u5230\u3002</p><p>\u4E3A\u4E86\u89E3\u51B3\u8FD9\u79CD\u60C5\u51B5\uFF0C\u6211\u4EEC\u4E13\u95E8\u5EFA\u7ACB\u4E00\u4E2A\u56FE\u7247\u670D\u52A1\u5668\uFF0C\u7528\u6765\u5B58\u50A8\u56FE\u7247\u3002\u8FD9\u6837\u5F53\u90FD\u628A\u56FE\u7247\u4E0A\u4F20\u7684\u65F6\u5019\uFF0C\u4E0D\u7BA1\u662F\u54EA\u4E2A\u670D\u52A1\u5668\u63A5\u6536\u5230\u56FE\u7247\uFF0C\u90FD\u628A\u56FE\u7247\u4E0A\u4F20\u5230\u56FE\u7247\u670D\u52A1\u5668\u3002\u800C\u56FE\u7247\u670D\u52A1\u5668\u4E0A\u9700\u8981\u5B89\u88C5\u4E00\u4E2A http \u670D\u52A1\uFF0C\u53EF\u4EE5\u4F7F\u7528 tomcat\u3001apache\u3001nginx\u3002</p><h3 id="\u7406\u7531\u4E8C" tabindex="-1"><a class="header-anchor" href="#\u7406\u7531\u4E8C" aria-hidden="true">#</a> \u7406\u7531\u4E8C\uFF1A</h3><p>nginx \u5E38\u7528\u505A\u9759\u6001\u5185\u5BB9\u670D\u52A1\u548C\u4EE3\u7406\u670D\u52A1\u5668\uFF0C\u76F4\u9762\u5916\u6765\u8BF7\u6C42\u8F6C\u53D1\u7ED9\u540E\u9762\u7684\u5E94\u7528\u670D\u52A1\uFF08tomcat\uFF0Cdjango \u4EC0\u4E48\u7684\uFF09\uFF0Ctomcat \u66F4\u591A\u7528\u6765\u505A\u505A\u4E00\u4E2A\u5E94\u7528\u5BB9\u5668\uFF0C\u8BA9 java web app \u8DD1\u5728\u91CC\u9762\u7684\u4E1C\u897F\u3002</p><h3 id="\u7406\u7531\u4E09" tabindex="-1"><a class="header-anchor" href="#\u7406\u7531\u4E09" aria-hidden="true">#</a> \u7406\u7531\u4E09\uFF1A</h3><p><code>nginx\u4F5C\u53CD\u5411\u4EE3\u7406\uFF1A</code></p><p>\u53CD\u5411\u4EE3\u7406\u5C31\u662F\u540E\u7AEF\u670D\u52A1\u4E0D\u76F4\u63A5\u5BF9\u5916\u66B4\u9732, \u8BF7\u6C42\u9996\u5148\u53D1\u9001\u5230 nginx, \u7136\u540E nginx \u5C06\u8BF7\u6C42\u8F6C\u53D1\u5230\u540E\u7AEF\u670D\u52A1\u5668, \u6BD4\u5982 tomcat \u7B49. \u5982\u679C\u540E\u7AEF\u670D\u52A1\u53EA\u6709\u4E00\u53F0\u670D\u52A1\u5668, nginx \u5728\u8FD9\u91CC\u53EA\u6709\u4E00\u4E2A\u4F5C\u7528\u5C31\u662F\u8D77\u5230\u4E86\u4EE3\u7406\u540E\u7AEF\u670D\u52A1\u63A5\u6536\u8BF7\u6C42\u7684\u4F5C\u7528. \u79F0\u4E4B\u4E3A\u53CD\u5411\u4EE3\u7406.</p><h3 id="\u7406\u7531\u56DB" tabindex="-1"><a class="header-anchor" href="#\u7406\u7531\u56DB" aria-hidden="true">#</a> \u7406\u7531\u56DB\uFF1A</h3><p><code>nginx\u4F5C\u8D1F\u8F7D\u5747\u8861\uFF1A</code></p><p>\u5728\u73B0\u5B9E\u7684\u5E94\u7528\u573A\u666F\u4E2D, \u4E00\u53F0\u540E\u7AEF\u670D\u52A1\u5668\u51FA\u73B0\u5355\u70B9\u6545\u969C\u7684\u6982\u7387\u5F88\u5927\u6216\u8005\u5355\u53F0\u673A\u5668\u7684\u541E\u5410\u91CF\u6709\u9650, \u65E0\u6CD5\u627F\u62C5\u8FC7\u591A\u8BF7\u6C42. \u8FD9\u65F6\u5019\u5C31\u9700\u8981\u5728 nginx \u540E\u7AEF\u914D\u7F6E\u591A\u53F0\u670D\u52A1\u5668, \u5229\u7528 nginx \u5185\u7F6E\u7684\u89C4\u5219\u8BB2\u8BF7\u6C42\u8F6C\u53D1\u5230\u540E\u7AEF\u4E0D\u540C\u7684\u673A\u5668\u4E0A. \u8FD9\u65F6\u5019\u5C31\u8D77\u5230\u4E86\u8D1F\u8F7D\u5747\u8861\u7684\u4F5C\u7528.</p><h2 id="_3-nginx-\u914D\u7F6E\u6587\u4EF6\u3002" tabindex="-1"><a class="header-anchor" href="#_3-nginx-\u914D\u7F6E\u6587\u4EF6\u3002" aria-hidden="true">#</a> 3\uFF0Cnginx \u914D\u7F6E\u6587\u4EF6\u3002</h2><p><code>\u4E3B\u8981\u7EC4\u6210\u90E8\u5206\uFF1A</code></p><p><em><strong>main\uFF08\u5168\u5C40\u8BBE\u7F6E\uFF09</strong></em></p><p>main \u90E8\u5206\u8BBE\u7F6E\u7684\u6307\u4EE4\u5C06\u5F71\u54CD\u5176\u5B83\u6240\u6709\u90E8\u5206\u7684\u8BBE\u7F6E\uFF1B</p><p><em><strong>server\uFF08\u4E3B\u673A\u8BBE\u7F6E\uFF09</strong></em></p><p>server \u90E8\u5206\u7684\u6307\u4EE4\u4E3B\u8981\u7528\u4E8E\u6307\u5B9A\u865A\u62DF\u4E3B\u673A\u57DF\u540D\u3001IP \u548C\u7AEF\u53E3\uFF1B</p><p><em><strong>upstream</strong></em></p><p>upstream \u7684\u6307\u4EE4\u7528\u4E8E\u8BBE\u7F6E\u4E00\u7CFB\u5217\u7684\u540E\u7AEF\u670D\u52A1\u5668\uFF0C\u8BBE\u7F6E\u53CD\u5411\u4EE3\u7406\u53CA\u540E\u7AEF\u670D\u52A1\u5668\u7684\u8D1F\u8F7D\u5747\u8861\uFF1B</p><p><em><strong>location</strong></em></p><p>location \u90E8\u5206\u7528\u4E8E\u5339\u914D\u7F51\u9875\u4F4D\u7F6E\uFF08\u6BD4\u5982\uFF0C\u6839\u76EE\u5F55 \u201C/\u201D,\u201C/images\u201D, \u7B49\u7B49\uFF09\uFF1B</p><p><code>\u4ED6\u4EEC\u4E4B\u95F4\u7684\u5173\u7CFB\uFF1A</code></p><p>server \u7EE7\u627F main\uFF0Clocation \u7EE7\u627F server\uFF1Bupstream \u65E2\u4E0D\u4F1A\u7EE7\u627F\u6307\u4EE4\u4E5F\u4E0D\u4F1A\u88AB\u7EE7\u627F\u3002\u5B83\u6709\u81EA\u5DF1\u7684\u7279\u6B8A\u6307\u4EE4\uFF0C\u4E0D\u9700\u8981\u5728\u5176\u4ED6\u5730\u65B9\u7684\u5E94\u7528\u3002</p><p><code>\u4E3E\u4F8B\u8BF4\u660E\uFF1A</code></p><p>\u4E0B\u9762\u7684 nginx.conf \u7B80\u5355\u7684\u5B9E\u73B0 nginx \u5728\u524D\u7AEF\u505A\u53CD\u5411\u4EE3\u7406\u670D\u52A1\u5668\u7684\u4F8B\u5B50\uFF0C\u5904\u7406 js\u3001png \u7B49\u9759\u6001\u6587\u4EF6\uFF0Cjsp \u7B49\u52A8\u6001\u8BF7\u6C42\u8F6C\u53D1\u5230\u5176\u5B83\u670D\u52A1\u5668 tomcat\uFF1A</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">user</span> www www</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">worker_processes</span> <span class="token number">2</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">error_log</span> logs/error.log</span><span class="token punctuation">;</span>
<span class="token comment">#error_log logs/error.log notice;</span>
<span class="token comment">#error_log logs/error.log info;</span>
<span class="token directive"><span class="token keyword">pid</span> logs/nginx.pid</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">use</span> epoll</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">2048</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">include</span> mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span> application/octet-stream</span><span class="token punctuation">;</span>
    <span class="token comment">#log_format main &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="token comment"># &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="token comment"># &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>
    <span class="token comment">#access_log logs/access.log main;</span>
    <span class="token directive"><span class="token keyword">sendfile</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token comment"># tcp_nopush on;</span>
    <span class="token directive"><span class="token keyword">keepalive_timeout</span> <span class="token number">65</span></span><span class="token punctuation">;</span>
    <span class="token comment"># gzip\u538B\u7F29\u529F\u80FD\u8BBE\u7F6E</span>
    <span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">1k</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">4</span> <span class="token number">16k</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_http_version</span> 1.0</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">6</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_types</span> text/html text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token comment"># http_proxy \u8BBE\u7F6E</span>
    <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">10m</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">client_body_buffer_size</span> <span class="token number">128k</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_connect_timeout</span> <span class="token number">75</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_send_timeout</span> <span class="token number">75</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_read_timeout</span> <span class="token number">75</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_buffer_size</span> <span class="token number">4k</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_buffers</span> <span class="token number">4</span> <span class="token number">32k</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_busy_buffers_size</span> <span class="token number">64k</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_temp_file_write_size</span> <span class="token number">64k</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_temp_path</span> /usr/local/nginx/proxy_temp <span class="token number">1</span> <span class="token number">2</span></span><span class="token punctuation">;</span>
    <span class="token comment"># \u8BBE\u5B9A\u8D1F\u8F7D\u5747\u8861\u540E\u53F0\u670D\u52A1\u5668\u5217\u8868</span>
    <span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
        <span class="token comment">#ip_hash;</span>
        <span class="token directive"><span class="token keyword">server</span> 192.168.10.100:8080 max_fails=2 fail_timeout=30s</span> <span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server</span> 192.168.10.101:8080 max_fails=2 fail_timeout=30s</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># \u5F88\u91CD\u8981\u7684\u865A\u62DF\u4E3B\u673A\u914D\u7F6E</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> itoatest.example.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">root</span> /apps/oaapp</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">charset</span> utf-8</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">access_log</span> logs/host.access.log main</span><span class="token punctuation">;</span>
       
        <span class="token comment">#\u5BF9 / \u6240\u6709\u505A\u8D1F\u8F7D\u5747\u8861+\u53CD\u5411\u4EE3\u7406</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span> /apps/oaapp</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">index</span> index.jsp index.html index.htm</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_redirect</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
            <span class="token comment"># \u540E\u7AEF\u7684Web\u670D\u52A1\u5668\u53EF\u4EE5\u901A\u8FC7X-Forwarded-For\u83B7\u53D6\u7528\u6237\u771F\u5B9EIP</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_next_upstream</span> error timeout invalid_header http_500 http_502 http_503 http_504</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">#\u9759\u6001\u6587\u4EF6\uFF0Cnginx\u81EA\u5DF1\u5904\u7406\uFF0C\u4E0D\u53BBbackend\u8BF7\u6C42tomcat</span>
        <span class="token directive"><span class="token keyword">location</span> ~* /download/</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span> /apps/oa/fs</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token directive"><span class="token keyword">location</span> ~ .*\\.(gif|jpg|jpeg|bmp|png|ico|txt|js|css)$</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span> /apps/oaapp</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">expires</span> <span class="token number">7d</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token directive"><span class="token keyword">location</span> /nginx_status</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">stub_status</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">allow</span> 192.168.10.0/24</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token directive"><span class="token keyword">location</span> ~ ^/(WEB-INF)/</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">#error_page 404 /404.html;</span>
        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token comment">## \u5176\u5B83\u865A\u62DF\u4E3B\u673A\uFF0Cserver \u6307\u4EE4\u5F00\u59CB</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br></div></div><p>\u8FD9\u91CC\u4EC5\u4EC5\u662F\u4F5C\u4E3A\u4E00\u4E2A\u793A\u4F8B\u3002</p><p><img src="http://t.eryajf.net/imgs/2021/09/fe10601bf923657b.jpg" alt="image"></p><h2 id="_4-\u5E38\u7528\u6307\u4EE4\u6216\u8005\u6A21\u5757\u8BF4\u660E\u3002" tabindex="-1"><a class="header-anchor" href="#_4-\u5E38\u7528\u6307\u4EE4\u6216\u8005\u6A21\u5757\u8BF4\u660E\u3002" aria-hidden="true">#</a> 4\uFF0C\u5E38\u7528\u6307\u4EE4\u6216\u8005\u6A21\u5757\u8BF4\u660E\u3002</h2><h3 id="_4-1main-\u5168\u5C40\u8BBE\u7F6E\u3002" tabindex="-1"><a class="header-anchor" href="#_4-1main-\u5168\u5C40\u8BBE\u7F6E\u3002" aria-hidden="true">#</a> 4.1main \u5168\u5C40\u8BBE\u7F6E\u3002</h3><p><code>woker_processes 2;</code></p><blockquote><p>\u5728\u914D\u7F6E\u6587\u4EF6\u7684\u9876\u7EA7 main \u90E8\u5206\uFF0Cworker \u89D2\u8272\u7684\u5DE5\u4F5C\u8FDB\u7A0B\u7684\u4E2A\u6570\uFF0Cmaster \u8FDB\u7A0B\u662F\u63A5\u6536\u5E76\u5206\u914D\u8BF7\u6C42\u7ED9 worker \u5904\u7406\u3002\u8FD9\u4E2A\u6570\u503C\u7B80\u5355\u4E00\u70B9\u53EF\u4EE5\u8BBE\u7F6E\u4E3A cpu \u7684\u6838\u6570 grep ^processor /proc/cpuinfo | wc -l\uFF0C\u4E5F\u662F auto \u503C\uFF0C\u5982\u679C\u5F00\u542F\u4E86 ssl \u548C gzip \u66F4\u5E94\u8BE5\u8BBE\u7F6E\u6210\u4E0E\u903B\u8F91 CPU \u6570\u91CF\u4E00\u6837\u751A\u81F3\u4E3A 2 \u500D\uFF0C\u53EF\u4EE5\u51CF\u5C11 I/O \u64CD\u4F5C\u3002\u5982\u679C nginx \u670D\u52A1\u5668\u8FD8\u6709\u5176\u5B83\u670D\u52A1\uFF0C\u53EF\u4EE5\u8003\u8651\u9002\u5F53\u51CF\u5C11\u3002</p></blockquote><p><code>worker_cpu_affinity;</code></p><blockquote><p>\u4E5F\u662F\u5199\u5728 main \u90E8\u5206\u3002\u5728\u9AD8\u5E76\u53D1\u60C5\u51B5\u4E0B\uFF0C\u901A\u8FC7\u8BBE\u7F6E cpu \u7C98\u6027\u6765\u964D\u4F4E\u7531\u4E8E\u591A CPU \u6838\u5207\u6362\u9020\u6210\u7684\u5BC4\u5B58\u5668\u7B49\u73B0\u573A\u91CD\u5EFA\u5E26\u6765\u7684\u6027\u80FD\u635F\u8017\u3002\u5982 worker_cpu_affinity 0001 0010 0100 1000; \uFF08\u56DB\u6838\uFF09\u3002</p></blockquote><p><code>worker_connections 2048;</code></p><blockquote><p>\u5199\u5728 events \u90E8\u5206\u3002\u6BCF\u4E00\u4E2A worker \u8FDB\u7A0B\u80FD\u5E76\u53D1\u5904\u7406\uFF08\u53D1\u8D77\uFF09\u7684\u6700\u5927\u8FDE\u63A5\u6570\uFF08\u5305\u542B\u4E0E\u5BA2\u6237\u7AEF\u6216\u540E\u7AEF\u88AB\u4EE3\u7406\u670D\u52A1\u5668\u95F4\u7B49\u6240\u6709\u8FDE\u63A5\u6570\uFF09\u3002nginx \u4F5C\u4E3A\u53CD\u5411\u4EE3\u7406\u670D\u52A1\u5668\uFF0C\u8BA1\u7B97\u516C\u5F0F \u6700\u5927\u8FDE\u63A5\u6570 = worker_processes *</p></blockquote><p><code>worker_rlimit_nofile 10240;</code></p><blockquote><p>\u5199\u5728 main \u90E8\u5206\u3002\u9ED8\u8BA4\u662F\u6CA1\u6709\u8BBE\u7F6E\uFF0C\u53EF\u4EE5\u9650\u5236\u4E3A\u64CD\u4F5C\u7CFB\u7EDF\u6700\u5927\u7684\u9650\u5236 65535\u3002</p></blockquote><p><code>use epoll;</code></p><blockquote><p>\u5199\u5728 events \u90E8\u5206\u3002\u5728 Linux \u64CD\u4F5C\u7CFB\u7EDF\u4E0B\uFF0Cnginx \u9ED8\u8BA4\u4F7F\u7528 epoll \u4E8B\u4EF6\u6A21\u578B\uFF0C\u5F97\u76CA\u4E8E\u6B64\uFF0Cnginx \u5728 Linux \u64CD\u4F5C\u7CFB\u7EDF\u4E0B\u6548\u7387\u76F8\u5F53\u9AD8\u3002\u540C\u65F6 Nginx \u5728 OpenBSD \u6216 FreeBSD \u64CD\u4F5C\u7CFB\u7EDF\u4E0A\u91C7\u7528\u7C7B\u4F3C\u4E8E epoll \u7684\u9AD8\u6548\u4E8B\u4EF6\u6A21\u578B kqueue\u3002\u5728\u64CD\u4F5C\u7CFB\u7EDF\u4E0D\u652F\u6301\u8FD9\u4E9B\u9AD8\u6548\u6A21\u578B\u65F6\u624D\u4F7F\u7528 select\u3002</p></blockquote><h3 id="_4-2http-\u670D\u52A1\u5668\u3002" tabindex="-1"><a class="header-anchor" href="#_4-2http-\u670D\u52A1\u5668\u3002" aria-hidden="true">#</a> 4.2http \u670D\u52A1\u5668\u3002</h3><p><code>sendfile on;</code></p><blockquote><p>\u5F00\u542F\u9AD8\u6548\u6587\u4EF6\u4F20\u8F93\u6A21\u5F0F\uFF0Csendfile \u6307\u4EE4\u6307\u5B9A nginx \u662F\u5426\u8C03\u7528 sendfile \u51FD\u6570\u6765\u8F93\u51FA\u6587\u4EF6\uFF0C\u51CF\u5C11\u7528\u6237\u7A7A\u95F4\u5230\u5185\u6838\u7A7A\u95F4\u7684\u4E0A\u4E0B\u6587\u5207\u6362\u3002\u5BF9\u4E8E\u666E\u901A\u5E94\u7528\u8BBE\u4E3A on\uFF0C\u5982\u679C\u7528\u6765\u8FDB\u884C\u4E0B\u8F7D\u7B49\u5E94\u7528\u78C1\u76D8 IO \u91CD\u8D1F\u8F7D\u5E94\u7528\uFF0C\u53EF\u8BBE\u7F6E\u4E3A off\uFF0C\u4EE5\u5E73\u8861\u78C1\u76D8\u4E0E\u7F51\u7EDC I/O \u5904\u7406\u901F\u5EA6\uFF0C\u964D\u4F4E\u7CFB\u7EDF\u7684\u8D1F\u8F7D\uFF1B</p></blockquote><p><code>keepalive_timeout 65;</code></p><blockquote><p>\u957F\u8FDE\u63A5\u8D85\u65F6\u65F6\u95F4\uFF0C\u5355\u4F4D\u662F\u79D2\uFF0C\u8FD9\u4E2A\u53C2\u6570\u5F88\u654F\u611F\uFF0C\u6D89\u53CA\u6D4F\u89C8\u5668\u7684\u79CD\u7C7B\u3001\u540E\u7AEF\u670D\u52A1\u5668\u7684\u8D85\u65F6\u8BBE\u7F6E\u3001\u64CD\u4F5C\u7CFB\u7EDF\u7684\u8BBE\u7F6E\uFF0C\u53EF\u4EE5\u53E6\u5916\u8D77\u4E00\u7247\u6587\u7AE0\u4E86\u3002\u957F\u8FDE\u63A5\u8BF7\u6C42\u5927\u91CF\u5C0F\u6587\u4EF6\u7684\u65F6\u5019\uFF0C\u53EF\u4EE5\u51CF\u5C11\u91CD\u5EFA\u8FDE\u63A5\u7684\u5F00\u9500\uFF0C\u4F46\u5047\u5982\u6709\u5927\u6587\u4EF6\u4E0A\u4F20\uFF0C65s \u5185\u6CA1\u4E0A\u4F20\u5B8C\u6210\u4F1A\u5BFC\u81F4\u5931\u8D25\u3002\u5982\u679C\u8BBE\u7F6E\u65F6\u95F4\u8FC7\u957F\uFF0C\u7528\u6237\u53C8\u591A\uFF0C\u957F\u65F6\u95F4\u4FDD\u6301\u8FDE\u63A5\u4F1A\u5360\u7528\u5927\u91CF\u8D44\u6E90\uFF1B</p></blockquote><p><code>send_timeout ;</code></p><blockquote><p>\u7528\u4E8E\u6307\u5B9A\u54CD\u5E94\u5BA2\u6237\u7AEF\u7684\u8D85\u65F6\u65F6\u95F4\u3002\u8FD9\u4E2A\u8D85\u65F6\u4EC5\u9650\u4E8E\u4E24\u4E2A\u8FDE\u63A5\u6D3B\u52A8\u4E4B\u95F4\u7684\u65F6\u95F4\uFF0C\u5982\u679C\u8D85\u8FC7\u8FD9\u4E2A\u65F6\u95F4\uFF0C\u5BA2\u6237\u7AEF\u6CA1\u6709\u4EFB\u4F55\u6D3B\u52A8\uFF0CNginx \u5C06\u4F1A\u5173\u95ED\u8FDE\u63A5\uFF1B</p></blockquote><p><code>client_max_body_size 10m;</code></p><blockquote><p>\u5141\u8BB8\u5BA2\u6237\u7AEF\u8BF7\u6C42\u7684\u6700\u5927\u5355\u6587\u4EF6\u5B57\u8282\u6570\u3002\u5982\u679C\u6709\u4E0A\u4F20\u8F83\u5927\u6587\u4EF6\uFF0C\u8BF7\u8BBE\u7F6E\u5B83\u7684\u9650\u5236\u503C\uFF1B</p></blockquote><p><code>client_body_buffer_size 128k;</code></p><blockquote><p>\u7F13\u51B2\u533A\u4EE3\u7406\u7F13\u51B2\u7528\u6237\u7AEF\u8BF7\u6C42\u7684\u6700\u5927\u5B57\u8282\u6570\uFF1B</p></blockquote><h3 id="_4-3-\u6A21\u5757-http-proxy" tabindex="-1"><a class="header-anchor" href="#_4-3-\u6A21\u5757-http-proxy" aria-hidden="true">#</a> 4.3 \u6A21\u5757 http_proxy</h3><p><code>proxy_read_timeout 60;</code></p><blockquote><p>\u8FDE\u63A5\u6210\u529F\u540E\uFF0C\u4E0E\u540E\u7AEF\u670D\u52A1\u5668\u4E24\u4E2A\u6210\u529F\u7684\u54CD\u5E94\u64CD\u4F5C\u4E4B\u95F4\u8D85\u65F6\u65F6\u95F4 (\u4EE3\u7406\u63A5\u6536\u8D85\u65F6)</p></blockquote><p><code>proxy_buffer_size 4k;</code></p><blockquote><p>\u8BBE\u7F6E\u4EE3\u7406\u670D\u52A1\u5668\uFF08nginx\uFF09\u4ECE\u540E\u7AEF realserver \u8BFB\u53D6\u5E76\u4FDD\u5B58\u7528\u6237\u5934\u4FE1\u606F\u7684\u7F13\u51B2\u533A\u5927\u5C0F\uFF0C\u9ED8\u8BA4\u4E0E proxy_buffers \u5927\u5C0F\u76F8\u540C\uFF0C\u5176\u5B9E\u53EF\u4EE5\u5C06\u8FD9\u4E2A\u6307\u4EE4\u503C\u8BBE\u7684\u5C0F\u4E00\u70B9</p></blockquote><p><code>proxy_buffers 4 32k;</code></p><blockquote><p>proxy_buffers \u7F13\u51B2\u533A\uFF0Cnginx \u9488\u5BF9\u5355\u4E2A\u8FDE\u63A5\u7F13\u5B58\u6765\u81EA\u540E\u7AEF realserver \u7684\u54CD\u5E94\uFF0C\u7F51\u9875\u5E73\u5747\u5728 32k \u4EE5\u4E0B\u7684\u8BDD\uFF0C\u8FD9\u6837\u8BBE\u7F6E</p></blockquote><p><code>proxy_busy_buffers_size 64k;</code></p><blockquote><p>\u9AD8\u8D1F\u8377\u4E0B\u7F13\u51B2\u5927\u5C0F\uFF08proxy_buffers*2\uFF09</p></blockquote><p><code>proxy_max_temp_file_size;</code></p><blockquote><p>\u5F53 proxy_buffers \u653E\u4E0D\u4E0B\u540E\u7AEF\u670D\u52A1\u5668\u7684\u54CD\u5E94\u5185\u5BB9\u65F6\uFF0C\u4F1A\u5C06\u4E00\u90E8\u5206\u4FDD\u5B58\u5230\u786C\u76D8\u7684\u4E34\u65F6\u6587\u4EF6\u4E2D\uFF0C\u8FD9\u4E2A\u503C\u7528\u6765\u8BBE\u7F6E\u6700\u5927\u4E34\u65F6\u6587\u4EF6\u5927\u5C0F\uFF0C\u9ED8\u8BA4 1024M\uFF0C\u5B83\u4E0E proxy_cache \u6CA1\u6709\u5173\u7CFB\u3002\u5927\u4E8E\u8FD9\u4E2A\u503C\uFF0C\u5C06\u4ECE upstream \u670D\u52A1\u5668\u4F20\u56DE\u3002\u8BBE\u7F6E\u4E3A 0 \u7981\u7528\u3002</p></blockquote><p><code>proxy_temp_file_write_size 64k;</code></p><blockquote><p>\u5F53\u7F13\u5B58\u88AB\u4EE3\u7406\u7684\u670D\u52A1\u5668\u54CD\u5E94\u5230\u4E34\u65F6\u6587\u4EF6\u65F6\uFF0C\u8FD9\u4E2A\u9009\u9879\u9650\u5236\u6BCF\u6B21\u5199\u4E34\u65F6\u6587\u4EF6\u7684\u5927\u5C0F\u3002proxy_temp_path\uFF08\u53EF\u4EE5\u5728\u7F16\u8BD1\u7684\u65F6\u5019\uFF09\u6307\u5B9A\u5199\u5230\u54EA\u90A3\u4E2A\u76EE\u5F55\u3002</p></blockquote><h3 id="_4-4-\u6A21\u5757-http-gzip" tabindex="-1"><a class="header-anchor" href="#_4-4-\u6A21\u5757-http-gzip" aria-hidden="true">#</a> 4.4 \u6A21\u5757 http_gzip\uFF1A</h3><p><code>gzip on :</code></p><blockquote><p>\u5F00\u542F gzip \u538B\u7F29\u8F93\u51FA\uFF0C\u51CF\u5C11\u7F51\u7EDC\u4F20\u8F93\u3002</p></blockquote><p><code>gzip_min_length 1k \uFF1A</code></p><blockquote><p>\u8BBE\u7F6E\u5141\u8BB8\u538B\u7F29\u7684\u9875\u9762\u6700\u5C0F\u5B57\u8282\u6570\uFF0C\u9875\u9762\u5B57\u8282\u6570\u4ECE header \u5934\u5F97 content-length \u4E2D\u8FDB\u884C\u83B7\u53D6\u3002\u9ED8\u8BA4\u503C\u662F 20\u3002\u5EFA\u8BAE\u8BBE\u7F6E\u6210\u5927\u4E8E 1k \u7684\u5B57\u8282\u6570\uFF0C\u5C0F\u4E8E 1k \u53EF\u80FD\u4F1A\u8D8A\u538B\u8D8A\u5927\u3002</p></blockquote><p><code>gzip_buffers 4 16k \uFF1A</code></p><blockquote><p>\u8BBE\u7F6E\u7CFB\u7EDF\u83B7\u53D6\u51E0\u4E2A\u5355\u4F4D\u7684\u7F13\u5B58\u7528\u4E8E\u5B58\u50A8 gzip \u7684\u538B\u7F29\u7ED3\u679C\u6570\u636E\u6D41\u30024 16k \u4EE3\u8868\u4EE5 16k \u4E3A\u5355\u4F4D\uFF0C\u5B89\u88C5\u539F\u59CB\u6570\u636E\u5927\u5C0F\u4EE5 16k \u4E3A\u5355\u4F4D\u7684 4 \u500D\u7533\u8BF7\u5185\u5B58\u3002</p></blockquote><p><code>gzip_http_version 1.0 \uFF1A</code></p><blockquote><p>\u7528\u4E8E\u8BC6\u522B http \u534F\u8BAE\u7684\u7248\u672C\uFF0C\u65E9\u671F\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301 Gzip \u538B\u7F29\uFF0C\u7528\u6237\u5C31\u4F1A\u770B\u5230\u4E71\u7801\uFF0C\u6240\u4EE5\u4E3A\u4E86\u652F\u6301\u524D\u671F\u7248\u672C\u52A0\u4E0A\u4E86\u8FD9\u4E2A\u9009\u9879\uFF0C\u5982\u679C\u4F60\u7528\u4E86 Nginx \u7684\u53CD\u5411\u4EE3\u7406\u5E76\u671F\u671B\u4E5F\u542F\u7528 Gzip \u538B\u7F29\u7684\u8BDD\uFF0C\u7531\u4E8E\u672B\u7AEF\u901A\u4FE1\u662F http/1.0\uFF0C\u6545\u8BF7\u8BBE\u7F6E\u4E3A 1.0\u3002</p></blockquote><p><code>gzip_comp_level 6 \uFF1A</code></p><blockquote><p>gzip \u538B\u7F29\u6BD4\uFF0C1 \u538B\u7F29\u6BD4\u6700\u5C0F\u5904\u7406\u901F\u5EA6\u6700\u5FEB\uFF0C9 \u538B\u7F29\u6BD4\u6700\u5927\u4F46\u5904\u7406\u901F\u5EA6\u6700\u6162 (\u4F20\u8F93\u5FEB\u4F46\u6BD4\u8F83\u6D88\u8017 cpu)</p></blockquote><p><code>gzip_types \uFF1A</code></p><blockquote><p>\u5339\u914D mime \u7C7B\u578B\u8FDB\u884C\u538B\u7F29\uFF0C\u65E0\u8BBA\u662F\u5426\u6307\u5B9A,\u201Dtext/html\u201D \u7C7B\u578B\u603B\u662F\u4F1A\u88AB\u538B\u7F29\u7684\u3002</p></blockquote><p><code>gzip_proxied any \uFF1A</code></p><blockquote><p>Nginx \u4F5C\u4E3A\u53CD\u5411\u4EE3\u7406\u7684\u65F6\u5019\u542F\u7528\uFF0C\u51B3\u5B9A\u5F00\u542F\u6216\u8005\u5173\u95ED\u540E\u7AEF\u670D\u52A1\u5668\u8FD4\u56DE\u7684\u7ED3\u679C\u662F\u5426\u538B\u7F29\uFF0C\u5339\u914D\u7684\u524D\u63D0\u662F\u540E\u7AEF\u670D\u52A1\u5668\u5FC5\u987B\u8981\u8FD4\u56DE\u5305\u542B\u201DVia\u201D \u7684 header \u5934\u3002</p></blockquote><p><code>gzip_vary on \uFF1A</code></p><blockquote><p>\u548C http \u5934\u6709\u5173\u7CFB\uFF0C\u4F1A\u5728\u54CD\u5E94\u5934\u52A0\u4E2A Vary: Accept-Encoding \uFF0C\u53EF\u4EE5\u8BA9\u524D\u7AEF\u7684\u7F13\u5B58\u670D\u52A1\u5668\u7F13\u5B58\u7ECF\u8FC7 gzip \u538B\u7F29\u7684\u9875\u9762\uFF0C\u4F8B\u5982\uFF0C\u7528 Squid \u7F13\u5B58\u7ECF\u8FC7 Nginx \u538B\u7F29\u7684\u6570\u636E\u3002</p></blockquote><h3 id="_4-5server-\u865A\u62DF\u4E3B\u673A" tabindex="-1"><a class="header-anchor" href="#_4-5server-\u865A\u62DF\u4E3B\u673A" aria-hidden="true">#</a> 4.5server \u865A\u62DF\u4E3B\u673A</h3><p><code>listen;</code></p><blockquote><p>\u76D1\u542C\u7AEF\u53E3\uFF0C\u9ED8\u8BA4 80\uFF0C\u5C0F\u4E8E 1024 \u7684\u8981\u4EE5 root \u542F\u52A8\u3002\u53EF\u4EE5\u4E3A listen *:80\u3001listen 127.0.0.1:80 \u7B49\u5F62\u5F0F\u3002</p></blockquote><p><code>server_name;</code></p><blockquote><p>\u670D\u52A1\u5668\u540D\uFF0C\u5982 localhost\u3001www.example.com\uFF0C\u53EF\u4EE5\u901A\u8FC7\u6B63\u5219\u5339\u914D\u3002</p></blockquote><h3 id="_4-6-\u6A21\u5757-http-stream" tabindex="-1"><a class="header-anchor" href="#_4-6-\u6A21\u5757-http-stream" aria-hidden="true">#</a> 4.6 \u6A21\u5757 http_stream</h3><p><code>host:port options;</code></p><blockquote><p>\u8FD9\u4E2A\u6A21\u5757\u901A\u8FC7\u4E00\u4E2A\u7B80\u5355\u7684\u8C03\u5EA6\u7B97\u6CD5\u6765\u5B9E\u73B0\u5BA2\u6237\u7AEF IP \u5230\u540E\u7AEF\u670D\u52A1\u5668\u7684\u8D1F\u8F7D\u5747\u8861\uFF0Cupstream \u540E\u63A5\u8D1F\u8F7D\u5747\u8861\u5668\u7684\u540D\u5B57\uFF0C\u540E\u7AEF realserver \u4EE5 host:port options; \u65B9\u5F0F\u7EC4\u7EC7\u5728 {} \u4E2D\u3002\u5982\u679C\u540E\u7AEF\u88AB\u4EE3\u7406\u7684\u53EA\u6709\u4E00\u53F0\uFF0C\u4E5F\u53EF\u4EE5\u76F4\u63A5\u5199\u5728 proxy_pass \u3002</p></blockquote><h3 id="_4-7location" tabindex="-1"><a class="header-anchor" href="#_4-7location" aria-hidden="true">#</a> 4.7location</h3><p><code>root /var/www/html;</code></p><blockquote><p>\u5B9A\u4E49\u670D\u52A1\u5668\u7684\u9ED8\u8BA4\u7F51\u7AD9\u6839\u76EE\u5F55\u4F4D\u7F6E\u3002\u5982\u679C locationURL \u5339\u914D\u7684\u662F\u5B50\u76EE\u5F55\u6216\u6587\u4EF6\uFF0Croot \u6CA1\u4EC0\u4E48\u4F5C\u7528\uFF0C\u4E00\u822C\u653E\u5728 server \u6307\u4EE4\u91CC\u9762\u6216 / \u4E0B\u3002</p></blockquote><p><code>index index.jsp index.html index.htm;</code></p><blockquote><p>\u5B9A\u4E49\u8DEF\u5F84\u4E0B\u9ED8\u8BA4\u8BBF\u95EE\u7684\u6587\u4EF6\u540D\uFF0C\u4E00\u822C\u8DDF\u7740 root \u653E</p></blockquote><p><code>proxy_pass http:/backend;</code></p>`,99),k=s("\u8BF7\u6C42\u8F6C\u5411 backend \u5B9A\u4E49\u7684\u670D\u52A1\u5668\u5217\u8868\uFF0C\u5373\u53CD\u5411\u4EE3\u7406\uFF0C\u5BF9\u5E94 upstream \u8D1F\u8F7D\u5747\u8861\u5668\u3002\u4E5F\u53EF\u4EE5 proxy_pass "),d={href:"http://ip:port%E3%80%82/",target:"_blank",rel:"noopener noreferrer"},b=s("http://ip:port\u3002"),m=p(`<h3 id="_4-8-\u8BBF\u95EE\u63A7\u5236-allow-deny" tabindex="-1"><a class="header-anchor" href="#_4-8-\u8BBF\u95EE\u63A7\u5236-allow-deny" aria-hidden="true">#</a> 4.8 \u8BBF\u95EE\u63A7\u5236 allow/deny</h3><p>Nginx \u7684\u8BBF\u95EE\u63A7\u5236\u6A21\u5757\u9ED8\u8BA4\u5C31\u4F1A\u5B89\u88C5\uFF0C\u800C\u4E14\u5199\u6CD5\u4E5F\u975E\u5E38\u7B80\u5355\uFF0C\u53EF\u4EE5\u5206\u522B\u6709\u591A\u4E2A<code>allow,deny</code>\uFF0C\u5141\u8BB8\u6216\u7981\u6B62\u67D0\u4E2A ip \u6216 ip \u6BB5\u8BBF\u95EE\uFF0C\u4F9D\u6B21\u6EE1\u8DB3\u4EFB\u4F55\u4E00\u4E2A\u89C4\u5219\u5C31\u505C\u6B62\u5F80\u4E0B\u5339\u914D\u3002\u5982\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>location /nginx-status <span class="token punctuation">{</span>
    stub_status on<span class="token punctuation">;</span>
    access_log off<span class="token punctuation">;</span>
    <span class="token comment"># auth_basic &quot;NginxStatus&quot;;</span>
    <span class="token comment"># auth_basic_user_file /usr/local/nginx-1.6/htpasswd;</span>
    allow <span class="token number">192.168</span>.10.100<span class="token punctuation">;</span>
    allow <span class="token number">172.29</span>.73.0/24<span class="token punctuation">;</span>
    deny all<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u4E5F\u5E38\u7528 httpd-devel \u5DE5\u5177\u7684 <code>htpasswd</code> \u6765\u4E3A\u8BBF\u95EE\u7684\u8DEF\u5F84\u8BBE\u7F6E\u767B\u5F55\u5BC6\u7801\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># htpasswd -c htpasswd admin</span>
New passwd:
Re-type new password:
Adding password <span class="token keyword">for</span> user admin
<span class="token comment"># htpasswd htpasswd admin //\u4FEE\u6539admin\u5BC6\u7801</span>
<span class="token comment"># htpasswd htpasswd sean //\u591A\u6DFB\u52A0\u4E00\u4E2A\u8BA4\u8BC1\u7528\u6237</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u8FD9\u6837\u5C31\u751F\u6210\u4E86\u9ED8\u8BA4\u4F7F\u7528 CRYPT \u52A0\u5BC6\u7684\u5BC6\u7801\u6587\u4EF6\u3002\u6253\u5F00\u4E0A\u9762 nginx-status \u7684\u4E24\u884C\u6CE8\u91CA\uFF0C\u91CD\u542F nginx \u751F\u6548\u3002</p><h3 id="_4-9-\u5217\u51FA\u76EE\u5F55-autoindex" tabindex="-1"><a class="header-anchor" href="#_4-9-\u5217\u51FA\u76EE\u5F55-autoindex" aria-hidden="true">#</a> 4.9 \u5217\u51FA\u76EE\u5F55 autoindex</h3><p>Nginx \u9ED8\u8BA4\u662F\u4E0D\u5141\u8BB8\u5217\u51FA\u6574\u4E2A\u76EE\u5F55\u7684\u3002</p><p>\u5982\u9700\u6B64\u529F\u80FD\uFF0C\u6253\u5F00 nginx.conf \u6587\u4EF6\uFF0C\u5728 location\uFF0Cserver \u6216 http \u6BB5\u4E2D\u52A0\u5165 autoindex on;\uFF0C\u53E6\u5916\u4E24\u4E2A\u53C2\u6570\u6700\u597D\u4E5F\u52A0\u4E0A\u53BB:</p><p><code>autoindex_exact_size off;</code></p><blockquote><p>\u9ED8\u8BA4\u4E3A on\uFF0C\u663E\u793A\u51FA\u6587\u4EF6\u7684\u786E\u5207\u5927\u5C0F\uFF0C\u5355\u4F4D\u662F bytes\u3002\u6539\u4E3A off \u540E\uFF0C\u663E\u793A\u51FA\u6587\u4EF6\u7684\u5927\u6982\u5927\u5C0F\uFF0C\u5355\u4F4D\u662F kB \u6216\u8005 MB \u6216\u8005 GB</p></blockquote><p><code>autoindex_localtime on;</code></p><blockquote><p>\u9ED8\u8BA4\u4E3A off\uFF0C\u663E\u793A\u7684\u6587\u4EF6\u65F6\u95F4\u4E3A GMT \u65F6\u95F4\u3002\u6539\u4E3A on \u540E\uFF0C\u663E\u793A\u7684\u6587\u4EF6\u65F6\u95F4\u4E3A\u6587\u4EF6\u7684\u670D\u52A1\u5668\u65F6\u95F4</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>location /images <span class="token punctuation">{</span>
    root /var/www/nginx-default/images<span class="token punctuation">;</span>
    autoindex on<span class="token punctuation">;</span>
    autoindex_exact_size off<span class="token punctuation">;</span>
    autoindex_localtime on<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div>`,14),_=s("\u6574\u7406\u81EA\u516C\u4F17\u53F7\u300A"),h={href:"https://mp.weixin.qq.com/s/YrC8aPZHtDlDL2Fqku2fbA",target:"_blank",rel:"noopener noreferrer"},x=s("\u6211\u7684\u8FD0\u7EF4\u4E4B\u65C5"),g=s("\u300B");function y(v,w){const a=o("ExternalLinkIcon");return t(),c(l,null,[u,n("blockquote",null,[n("p",null,[k,n("a",d,[b,e(a)])])]),m,n("p",null,[_,n("a",h,[x,e(a)]),g])],64)}var z=r(i,[["render",y]]);export{z as default};
