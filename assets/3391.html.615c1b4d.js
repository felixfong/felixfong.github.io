import{r as p,o as t,c as r,b as s,a as e,F as o,d as n,e as l}from"./app.dbf5d933.js";import{_ as c}from"./plugin-vue_export-helper.21dcd24c.js";const i={},u=s("p",null,"\u82E6\u5FC3\u4EBA\u5929\u4E0D\u8D1F\uFF0C\u6709\u5FD7\u8005\u4E8B\u7ADF\u6210\u3002",-1),b=s("p",null,"\u8FD9\u662F\u7B2C\u4E8C\u6B21\u5BF9\u8FD9\u4E2A\u4E1C\u4E1C\u53D1\u8D77\u914D\u7F6E\u51B2\u51FB\uFF0C\u5BF9\u4E8EPython\u9879\u76EE\uFF0C\u771F\u5FC3\u5730\u662F\u8FD9\u8F88\u5B50\u90FD\u4E0D\u60F3\u518D\u6CBE\u624B\uFF0C\u5C3D\u7BA1\u5B83\u641E\u51FA\u4E86\u4E0D\u5C11\u4F18\u79C0\u7684\u9879\u76EE\u6765\u3002\u7B2C\u4E00\u6B21\u51B2\u51FB\u7684\u65F6\u5019\uFF0C\u5728\u591A\u4E2A\u4E3B\u673A\u591A\u4E2A\u73AF\u5883\u53CD\u53CD\u590D\u590D\u5C1D\u8BD5\u4E86\u5341\u591A\u6B21\uFF0C\u6700\u7EC8\u5747\u4EE5\u5931\u8D25\u544A\u7EC8\uFF0C\u8981\u4E48\u662F\u5E94\u7528\u9700\u8981\u7684Python\u7248\u672C\u5DF2\u7ECF\u53D8\u66F4\uFF0C\u800C\u6CA1\u6709\u8BF4\u660E\uFF0C\u8981\u4E48\u662FPython\u73AF\u5883\u9519\u4E71\uFF0C\u65E0\u6CD5\u4F7F\u7528\uFF0C\u603B\u4E4B\uFF0C\u4E00\u8A00\u96BE\u5C3D\u3002",-1),d=s("p",null,"\u4F46\u4E5F\u4E0D\u80FD\u7B97\u5168\u65E0\u76CA\u5904\uFF0C\u81F3\u5C11\u79EF\u7D2F\u4E86\u4E00\u4E9B\u5751\u70B9\uFF0C\u80FD\u591F\u63D0\u524D\u907F\u5F00\uFF0C\u6BD4\u5982\u4E00\u4E9B\u6A21\u5757\u7684\u7248\u672C\u95EE\u9898\uFF0C\u4EE5\u53CA\u8F6F\u4EF6\u5927\u6982\u4ECE2.0\u4E4B\u540E\uFF0C\u5C31\u5DF2\u7ECF\u5B8C\u5168\u4F9D\u8D56Python3.6\u4E86\uFF0C\u51E1\u6B64\u79CD\u79CD\uFF0C\u90FD\u662F\u9700\u8981\u540E\u671F\u6CE8\u610F\u7684\uFF0C\u4ECA\u5929\u770B\u5230\u4E00\u7BC7\u4E0D\u9519\u7684\u6587\u7AE0\uFF0C\u6390\u6307\u4E00\u7B97\uFF0C\u65E5\u5B50\u4E0D\u9519\uFF0C\u4E8E\u662F\u5F00\u59CB\u914D\u7F6E\u4E4B\u8DEF\u3002",-1),m=s("p",null,"\u7834\u91DC\u6C89\u821F\uFF0C\u8FD9\u6B21\u65B0\u5F00\u673A\u5668\uFF0C\u4E0D\u641E\u5B9A\u8FD9\u4E2A\uFF0C\u8A93\u4E0D\u7F62\u4F11\u3002",-1),k=s("h2",{id:"_1-\u5B89\u88C5elastalert-0-1-37\u3002",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_1-\u5B89\u88C5elastalert-0-1-37\u3002","aria-hidden":"true"},"#"),n(" 1\uFF0C\u5B89\u88C5elastalert-0.1.37\u3002")],-1),h=s("h3",{id:"_1-\u73AF\u5883\u3002",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_1-\u73AF\u5883\u3002","aria-hidden":"true"},"#"),n(" 1\uFF0C\u73AF\u5883\u3002")],-1),g=s("li",null,"CentOS\uFF1A7.4",-1),_=s("li",null,"Python\uFF1A2.7.5(\u7CFB\u7EDF\u81EA\u5E26)",-1),y=s("li",null,"pip\uFF1A19.3",-1),f={href:"https://github.com/Yelp/elastalert",target:"_blank",rel:"noopener noreferrer"},v=n("elastalert"),x=n("\uFF1A0.1.37"),w=s("li",null,"elk\uFF1A6.5.4",-1),q=l(`<h3 id="_2-\u4F9D\u8D56\u3002" tabindex="-1"><a class="header-anchor" href="#_2-\u4F9D\u8D56\u3002" aria-hidden="true">#</a> 2\uFF0C\u4F9D\u8D56\u3002</h3><p>\u5B89\u88C5\u4F9D\u8D56\u5305\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum -y <span class="token function">install</span> gcc libffi-devel python-devel openssl-devel4 ca-certificates openssl-dev openssl python2-dev python2 py2-pip py2-yaml libffi-dev gcc musl-dev <span class="token function">wget</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u5B89\u88C5pip\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum -y <span class="token function">install</span> epel-release
yum <span class="token function">install</span> python-pip -y
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u5347\u7EA7pip\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>pip <span class="token function">install</span> --upgrade pip
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="_3-\u4E0B\u8F7D\u5305\u3002" tabindex="-1"><a class="header-anchor" href="#_3-\u4E0B\u8F7D\u5305\u3002" aria-hidden="true">#</a> 3\uFF0C\u4E0B\u8F7D\u5305\u3002</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">wget</span> https://github.com/Yelp/elastalert/archive/v0.1.37.zip
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="_4-\u5F00\u59CB\u914D\u7F6E\u3002" tabindex="-1"><a class="header-anchor" href="#_4-\u5F00\u59CB\u914D\u7F6E\u3002" aria-hidden="true">#</a> 4\uFF0C\u5F00\u59CB\u914D\u7F6E\u3002</h3><p>\u5165\u5751\u5F00\u59CB\u3002</p><p>\u5176\u5B9E\u6700\u539F\u59CB\u7684\u64CD\u4F5C\uFF0C\u5C31\u662F\u4E24\u6761\u547D\u4EE4\u5373\u53EF\uFF0C\u4F46\u662F\u7531\u4E8E\u7248\u672C\u53E4\u8001\uFF0C\u53EF\u80FD\u4F1A\u6709\u8BB8\u591A\u4F9D\u8D56\u5305\u7248\u672C\u4E0D\u7B26\u5408\u8981\u6C42\u7684\u60C5\u51B5\uFF0C\u6240\u4EE5\u9700\u8981\u5728\u5B89\u88C5\u8FC7\u7A0B\u4E2D\u8FDB\u884C\u4E00\u6CE2\u53C8\u4E00\u6CE2\u89E3\u51B3\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">unzip</span> v0.1.37.zip
<span class="token builtin class-name">cd</span> elastalert-0.1.37
python setup.py <span class="token function">install</span>
pip <span class="token function">install</span> -r requirements.txt
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u89E3\u51B3\u62A5\u9519\u6240\u9700\u8981\u64CD\u4F5C\u7684\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>pip2 <span class="token function">install</span> <span class="token string">&quot;thehive4py&gt;=1.4.4&quot;</span>
pip2 <span class="token function">install</span> <span class="token string">&quot;mock&gt;=2.0.0&quot;</span>
pip2 <span class="token function">install</span> <span class="token string">&quot;jsonschema&gt;=2.6.0,&lt;3.0.0&quot;</span>
pip <span class="token function">install</span> --upgrade setuptools
<span class="token function">sed</span> -i <span class="token string">&#39;s/jira&gt;=1.0.10/jira&gt;=1.0.10,&lt;1.0.15/g&#39;</span> setup.py
pip <span class="token function">install</span> <span class="token string">&quot;idna==2.7&quot;</span>
pip <span class="token function">install</span> --ignore-installed six
pip <span class="token function">install</span> --ignore-installed cryptography
pip <span class="token function">install</span> <span class="token string">&quot;elasticsearch&lt;7,&gt;6&quot;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u5230\u8FD9\u91CC\u5E94\u8BE5\u624D\u628A\u9700\u8981\u7684\u4F9D\u8D56\u90FD\u89E3\u51B3\u5B8C\uFF0C\u7136\u540E\u518D\u6B21\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>python setup.py <span class="token function">install</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u63A5\u7740\u624D\u80FD\u8FDB\u884C\u4E0B\u4E00\u6B65\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>pip <span class="token function">install</span> -r requirements.txt
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u62A5\u9519\u7EE7\u7EED\uFF0C\u89E3\u51B3\u7EE7\u7EED\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>pip <span class="token function">install</span> --ignore-installed requests
pip <span class="token function">install</span> PyYAML --ignore-installed  PyYAML
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u7136\u540E\u518D\u6B21\u6267\u884C\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>pip <span class="token function">install</span> -r requirements.txt
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u8981\u786E\u4FDD\u8FC7\u7A0B\u6CA1\u6709\u62A5\u9519\uFF0C\u6240\u6709\u6B65\u9AA4\uFF0C\u5747\u4EE5 <code>echo $?</code>\u7684\u5224\u65AD\u4E3A\u4F9D\u636E\uFF0C\u6709\u65F6\u5019\u53EF\u80FD\u770B\u89C1\u7EA2\u8272\u7684\u9519\u8BEF\uFF0C\u4ECD\u65E7\u53EF\u4EE5\u5FFD\u7565\uFF0C \u7136\u540E\u5C31\u5B89\u88C5\u914D\u7F6E\u5B8C\u6210\u4E86\u3002</p><h2 id="_1-\u5B89\u88C5elastalert-0-2-1\u3002" tabindex="-1"><a class="header-anchor" href="#_1-\u5B89\u88C5elastalert-0-2-1\u3002" aria-hidden="true">#</a> 1\uFF0C\u5B89\u88C5elastalert-0.2.1\u3002</h2><p>\u5F53\u6211\u771F\u6B63\u719F\u6089\u4E86\u8FD9\u4E9B\u6B65\u9AA4\u4E4B\u540E\uFF0C\u53D1\u73B0\u6700\u65B0\u7248\u672C\u7684\u5B89\u88C5\u4E5F\u5E76\u4E0D\u590D\u6742\u4E86\uFF0C\u73B0\u5728\u60F3\u60F3\u4E4B\u6240\u4EE5\u4E4B\u524D\u6CA1\u6709\u6210\u529F\uFF0C\u5C31\u662F\u56E0\u4E3A\u592A\u591A\u7F51\u4E0A\u7684\u6587\u7AE0\u90FD\u662F\u4E03\u4E03\u516B\u516B\u8BF4\u4E86\u4E00\u5806\uFF0C\u8DDF\u7740\u4ED6\u505A\u7684\u65F6\u5019\u5C31\u5931\u8D25\u63A5\u7740\u5931\u8D25\uFF0C\u4E0B\u8FB9\u5C31\u518D\u8BB0\u5F55\u4E00\u4E0B\u6700\u65B0\u7248\u672C\u5B89\u88C5\u7684\u8FC7\u7A0B\u3002</p><h3 id="_1-\u73AF\u5883\u3002-1" tabindex="-1"><a class="header-anchor" href="#_1-\u73AF\u5883\u3002-1" aria-hidden="true">#</a> 1\uFF0C\u73AF\u5883\u3002</h3>`,27),N=s("li",null,"CentOS\uFF1A7.4",-1),j=s("li",null,"Python\uFF1A3.6.9",-1),P=s("li",null,"pip\uFF1A19.3",-1),L={href:"https://github.com/Yelp/elastalert",target:"_blank",rel:"noopener noreferrer"},S=n("elastalert"),z=n("\uFF1A0.2.1"),Y=s("li",null,"elk\uFF1A6.5.4",-1),T=l(`<h3 id="_2-\u914D\u7F6Epython3-6-9\u73AF\u5883\u3002" tabindex="-1"><a class="header-anchor" href="#_2-\u914D\u7F6Epython3-6-9\u73AF\u5883\u3002" aria-hidden="true">#</a> 2\uFF0C\u914D\u7F6EPython3.6.9\u73AF\u5883\u3002</h3><p>\u5B89\u88C5\u4F9D\u8D56\u5305\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum -y <span class="token function">install</span> <span class="token function">wget</span> openssl openssl-devel gcc gcc-c++
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4E0B\u8F7D\u5305\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">wget</span> -c https://www.python.org/ftp/python/3.6.9/Python-3.6.9.tgz
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u5B89\u88C5\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">tar</span> xf Python-3.6.9.tgz
<span class="token builtin class-name">cd</span> Python-3.6.9
./configure --prefix<span class="token operator">=</span>/usr/local/python --with-openssl
<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u914D\u7F6E\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mv</span> /usr/bin/python /usr/bin/python_old
<span class="token function">ln</span> -s /usr/local/python/bin/python3 /usr/bin/python
<span class="token function">ln</span> -s /usr/local/python/bin/pip3 /usr/bin/pip
pip <span class="token function">install</span> --upgrade pip
<span class="token function">sed</span> -i <span class="token string">&#39;1s/python/python2.7/g&#39;</span> /usr/bin/yum
<span class="token function">sed</span> -i <span class="token string">&#39;1s/python/python2.7/g&#39;</span> /usr/libexec/urlgrabber-ext-down
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u9A8C\u8BC1\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ python -V
Python <span class="token number">3.6</span>.9
$ pip -V
pip <span class="token number">19.3</span> from /usr/local/python/lib/python3.6/site-packages/pip <span class="token punctuation">(</span>python <span class="token number">3.6</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_3-\u5B89\u88C5elastalert\u3002" tabindex="-1"><a class="header-anchor" href="#_3-\u5B89\u88C5elastalert\u3002" aria-hidden="true">#</a> 3\uFF0C\u5B89\u88C5elastalert\u3002</h3><p>\u4E0B\u8F7D\u5305\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">wget</span> https://github.com/Yelp/elastalert/archive/v0.2.1.tar.gz
<span class="token function">tar</span> xf v0.2.1.tar.gz
<span class="token builtin class-name">cd</span> elastalert-0.2.1
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u5B89\u88C5\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>pip <span class="token function">install</span> <span class="token string">&quot;elasticsearch&lt;7,&gt;6&quot;</span>
pip <span class="token function">install</span> -r requirements.txt
python setup.py <span class="token function">install</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u5982\u679C\u5982\u4E0A\u4E24\u6B65\u90FD\u6CA1\u6709\u62A5\u9519\uFF0C\u5219\u8BF4\u660E\u5B89\u88C5\u6210\u529F\uFF0C\u5982\u679C\u73AF\u5883\u4E0E\u6211\u4E00\u81F4\uFF0C\u7F51\u7EDC\u901A\u7545\uFF0C\u90A3\u4E48\u57FA\u672C\u4E0A\u5E94\u8BE5\u4E0D\u4F1A\u62A5\u9519\u3002</p><p>\u914D\u7F6E\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>ll /usr/local/python/bin/elastalert*  \u53EF\u4EE5\u770B\u5230\u751F\u6210\u7684\u51E0\u4E2A\u547D\u4EE4\u3002
<span class="token function">ln</span> -s /usr/local/python/bin/elastalert* /usr/bin
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u7136\u540E\u5C31\u5B89\u88C5\u6210\u529F\u4E86\uFF0C\u63A5\u4E0B\u6765\u7684\u64CD\u4F5C\uFF0C\u4E24\u4E2A\u7248\u672C\u91CC\u8FB9\u5C31\u662F\u4E00\u6837\u7684\u4E86\u3002</p><h2 id="_3-\u4F7F\u7528\u3002" tabindex="-1"><a class="header-anchor" href="#_3-\u4F7F\u7528\u3002" aria-hidden="true">#</a> 3\uFF0C\u4F7F\u7528\u3002</h2>`,21),E=n("\u5B98\u65B9\u6587\u6863\uFF1A"),C={href:"https://elastalert.readthedocs.io/",target:"_blank",rel:"noopener noreferrer"},I=n("https://elastalert.readthedocs.io"),M=l(`<p>\u89C4\u5219\u6587\u6863\uFF1Ahttps://elastalert.readthedocs.io/en/latest/ruletypes.html#include</p><p>\u4EE5\u4E0B\u7684\u914D\u7F6E\uFF0C\u5C31\u5728elastalert-0.1.37\u7248\u672C\u4E0B\u8FDB\u884C\u4E86\u3002</p><h3 id="_1-\u4E3B\u914D\u7F6E\u6587\u4EF6\u3002" tabindex="-1"><a class="header-anchor" href="#_1-\u4E3B\u914D\u7F6E\u6587\u4EF6\u3002" aria-hidden="true">#</a> 1\uFF0C\u4E3B\u914D\u7F6E\u6587\u4EF6\u3002</h3><p>\u9996\u5148\u662F\u4E3B\u914D\u7F6E\u6587\u4EF6\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">egrep</span> -v <span class="token string">&quot;^$|^#&quot;</span> config.yaml
<span class="token comment"># \u7528\u6765\u52A0\u8F7Drule\u7684\u76EE\u5F55\uFF0C\u9ED8\u8BA4\u662Fexample_rules</span>
rules_folder: rules
<span class="token comment"># \u7528\u6765\u8BBE\u7F6E\u5B9A\u65F6\u5411elasticsearch\u53D1\u9001\u8BF7\u6C42\uFF0C\u4E5F\u5C31\u662F\u544A\u8B66\u6267\u884C\u7684\u9891\u7387</span>
run_every:
  minutes: <span class="token number">1</span>
<span class="token comment"># \u7528\u6765\u8BBE\u7F6E\u8BF7\u6C42\u91CC\u65F6\u95F4\u5B57\u6BB5\u7684\u8303\u56F4</span>
buffer_time:
  minutes: <span class="token number">15</span>
<span class="token comment"># elasticsearch\u7684host\u5730\u5740</span>
es_host: <span class="token number">10.3</span>.0.41
<span class="token comment"># elasticsearch\u7684\u7AEF\u53E3</span>
es_port: <span class="token number">9200</span>
<span class="token comment"># elastalert\u4EA7\u751F\u7684\u65E5\u5FD7\u5728elasticsearch\u4E2D\u7684\u521B\u5EFA\u7684\u7D22\u5F15</span>
writeback_index: elastalert_status
<span class="token comment"># \u5931\u8D25\u91CD\u8BD5\u7684\u65F6\u95F4\u9650\u5236</span>
alert_time_limit:
  <span class="token comment">#days: 2</span>
  minutes: <span class="token number">15</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_2-\u521B\u5EFA\u544A\u8B66\u6240\u7528\u7D22\u5F15\u3002" tabindex="-1"><a class="header-anchor" href="#_2-\u521B\u5EFA\u544A\u8B66\u6240\u7528\u7D22\u5F15\u3002" aria-hidden="true">#</a> 2\uFF0C\u521B\u5EFA\u544A\u8B66\u6240\u7528\u7D22\u5F15\u3002</h3><p>\u53EF\u4EE5\u5728<code>/usr/bin/</code>\u76EE\u5F55\u4E0B\u770B\u5230\u4EE5\u4E0B\u56DB\u4E2A\u547D\u4EE4\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ elastalert-create-index
/usr/lib/python2.7/site-packages/elastalert-0.1.37-py2.7.egg/elastalert/create_index.py:65: YAMLLoadWarning: calling yaml.load<span class="token punctuation">(</span><span class="token punctuation">)</span> without <span class="token assign-left variable">Loader</span><span class="token operator">=</span><span class="token punctuation">..</span>. is deprecated, as the default Loader is unsafe. Please <span class="token builtin class-name">read</span> https://msg.pyyaml.org/load <span class="token keyword">for</span> full details.
  data <span class="token operator">=</span> yaml.load<span class="token punctuation">(</span>config_file<span class="token punctuation">)</span>
Elastic Version:6
Mapping used <span class="token keyword">for</span> string:<span class="token punctuation">{</span><span class="token string">&#39;type&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;keyword&#39;</span><span class="token punctuation">}</span>
New index elastalert_status created
Done<span class="token operator">!</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><code>elastalert-create-index</code>\u4F1A\u521B\u5EFA\u4E00\u4E2A\u7D22\u5F15\uFF0C<code>ElastAlert</code> \u4F1A\u628A\u6267\u884C\u8BB0\u5F55\u5B58\u653E\u5230\u8FD9\u4E2A\u7D22\u5F15\u4E2D\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u7D22\u5F15\u540D\u53EB <code>elastalert_status</code>\u3002\u5176\u4E2D\u6709<code>4</code>\u4E2A<code>_type</code>\uFF0C\u90FD\u6709\u81EA\u5DF1\u7684<code>@timestamp</code> \u5B57\u6BB5\uFF0C\u6240\u4EE5\u540C\u6837\u4E5F\u53EF\u4EE5\u7528<code>kibana</code>\u6765\u67E5\u770B\u8FD9\u4E2A\u7D22\u5F15\u7684\u65E5\u5FD7\u8BB0\u5F55\u60C5\u51B5\u3002</li><li><code>elastalert-rule-from-kibana</code>\u4ECE<code>Kibana3</code>\u5DF2\u4FDD\u5B58\u7684\u4EEA\u8868\u76D8\u4E2D\u8BFB\u53D6<code>Filtering</code> \u8BBE\u7F6E\uFF0C\u5E2E\u52A9\u751F\u6210<code>config.yaml</code>\u91CC\u7684\u914D\u7F6E\u3002\u4E0D\u8FC7\u6CE8\u610F\uFF0C\u5B83\u53EA\u4F1A\u8BFB\u53D6 <code>filtering</code>\uFF0C\u4E0D\u5305\u62EC<code>queries</code>\u3002</li><li><code>elastalert-test-rule</code>\u6D4B\u8BD5\u81EA\u5B9A\u4E49\u914D\u7F6E\u4E2D\u7684<code>rule</code>\u8BBE\u7F6E\u3002</li></ul><p>\u6267\u884C<code>elastalert-create-index</code>\u547D\u4EE4\u5728<code>ES</code>\u521B\u5EFA\u7D22\u5F15\uFF0C\u8FD9\u4E0D\u662F\u5FC5\u987B\u7684\u6B65\u9AA4\uFF0C\u4F46\u662F\u5F3A\u70C8\u5EFA\u8BAE\u521B\u5EFA\u3002\u56E0\u4E3A\u5BF9\u4E8E\u5BA1\u8BA1\u548C\u6D4B\u8BD5\u5F88\u6709\u7528\uFF0C\u5E76\u4E14\u91CD\u542F<code>ES</code>\u4E0D\u5F71\u54CD\u8BA1\u6570\u548C\u53D1\u9001<code>alert</code>.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ elastalert-create-index
/usr/lib/python2.7/site-packages/elastalert-0.1.37-py2.7.egg/elastalert/create_index.py:65: YAMLLoadWarning: calling yaml.load<span class="token punctuation">(</span><span class="token punctuation">)</span> without <span class="token assign-left variable">Loader</span><span class="token operator">=</span><span class="token punctuation">..</span>. is deprecated, as the default Loader is unsafe. Please <span class="token builtin class-name">read</span> https://msg.pyyaml.org/load <span class="token keyword">for</span> full details.
  data <span class="token operator">=</span> yaml.load<span class="token punctuation">(</span>config_file<span class="token punctuation">)</span>
Elastic Version:6
Mapping used <span class="token keyword">for</span> string:<span class="token punctuation">{</span><span class="token string">&#39;type&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;keyword&#39;</span><span class="token punctuation">}</span>
New index elastalert_status created
Done<span class="token operator">!</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u770B\u5230\u8FD9\u4E2A\u8F93\u51FA\uFF0C\u5C31\u8BF4\u660E\u521B\u5EFA\u6210\u529F\u4E86\uFF0C\u4E5F\u53EF\u4EE5\u8BF7\u6C42\u4E00\u4E0B\u770B\u770B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token variable">$curl</span> <span class="token number">127.0</span>.0.1:9200/_cat/indices?v
health status index                     uuid                   pri rep docs.count docs.deleted store.size pri.store.size
yellow <span class="token function">open</span>   elastalert_status         Xo0DIGytQVGNSMU0jUVw7A   <span class="token number">5</span>   <span class="token number">1</span>          <span class="token number">0</span>            <span class="token number">0</span>      <span class="token number">1</span>.1kb          <span class="token number">1</span>.1kb
yellow <span class="token function">open</span>   elastalert_status_silence iMUPdsQIQX2OwTmyWB01DQ   <span class="token number">5</span>   <span class="token number">1</span>          <span class="token number">0</span>            <span class="token number">0</span>      <span class="token number">1</span>.1kb          <span class="token number">1</span>.1kb
yellow <span class="token function">open</span>   elastalert_status_status  ydUfZk1NRYy1OWPxIoFsOQ   <span class="token number">5</span>   <span class="token number">1</span>          <span class="token number">0</span>            <span class="token number">0</span>      <span class="token number">1</span>.1kb          <span class="token number">1</span>.1kb
yellow <span class="token function">open</span>   elastalert_status_past    chY98B7-QfmTMPC9R5RfvQ   <span class="token number">5</span>   <span class="token number">1</span>          <span class="token number">0</span>            <span class="token number">0</span>      <span class="token number">1</span>.1kb          <span class="token number">1</span>.1kb
yellow <span class="token function">open</span>   elastalert_status_error   zXu-UaTJSmyCemkl6hz5uQ   <span class="token number">5</span>   <span class="token number">1</span>          <span class="token number">0</span>            <span class="token number">0</span>      <span class="token number">1</span>.1kb          <span class="token number">1</span>.1kb
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_3-rule\u914D\u7F6E\u3002" tabindex="-1"><a class="header-anchor" href="#_3-rule\u914D\u7F6E\u3002" aria-hidden="true">#</a> 3\uFF0CRule\u914D\u7F6E\u3002</h3><p>\u6240\u6709\u7684\u544A\u8B66\u89C4\u5219\uFF0C\u901A\u8FC7\u5728rule\u76EE\u4E0B\u521B\u5EFA\u914D\u7F6E\u6587\u4EF6\u8FDB\u884C\u5B9A\u4E49\uFF0C\u8FD9\u91CC\u7B80\u5355\u521B\u5EFA\u4E00\u4E2A\u6765\u4F5C\u4E3A\u6F14\u793A\u3002</p><p>\u9996\u5148\u6211\u5DF2\u7ECF\u5728elk\u96C6\u7FA4\u4E2D\u914D\u7F6E\u4E86\u4E00\u4E2ANGINX\u65E5\u5FD7\u91C7\u96C6\u7684\u6D41\u6C34\u7EBF\uFF0C\u73B0\u5728\u53BBkibana\u4E2D\u5229\u7528\u68C0\u7D22\u89C4\u5219\uFF0C\u8FC7\u6EE4\u51FA\u6211\u60F3\u8981\u7684\u544A\u8B66\u5185\u5BB9\uFF0C\u6BD4\u5982\u6211\u60F3\u8BA9\u72B6\u6001\u7801\u662F404\u7684\u8BF7\u6C42\uFF0C\u89E6\u53D1\u544A\u8B66\u901A\u77E5\uFF0C\u5C31\u7528\u5982\u4E0B\u8BED\u53E5\u8FDB\u884C\u67E5\u8BE2\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>groups: nginx AND response: 404
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u5176\u4E2Dgroup\u662Fkafka\u91CC\u8FB9\u5B9A\u4E49\u7684\u7EC4\uFF0C\u540E\u8FB9\u662F\u72B6\u6001\u7801\uFF0C\u8FD8\u53EF\u4EE5\u5199\u66F4\u591A\u6761\u4EF6\u8FDB\u884C\u5339\u914D\u3002</p><p><img src="http://t.eryajf.net/imgs/2021/09/d63e8411b48d787f.jpg" alt="20191018172445"></p><p>\u7136\u540E\u6765\u5230\u670D\u52A1\u5668\u6DFB\u52A0\u4E00\u6761\u89C4\u5219\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>$ cat nginx.yaml
<span class="token key atrule">es_host</span><span class="token punctuation">:</span> 10.3.0.41
<span class="token key atrule">es_port</span><span class="token punctuation">:</span> <span class="token number">9200</span>
<span class="token key atrule">use_ssl</span><span class="token punctuation">:</span> <span class="token boolean important">False</span>
<span class="token key atrule">name</span><span class="token punctuation">:</span> Nginx.
<span class="token key atrule">use_strftine_index</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">index</span><span class="token punctuation">:</span> logstash<span class="token punctuation">-</span>nginx*
<span class="token key atrule">type</span><span class="token punctuation">:</span> any
<span class="token key atrule">aggregation</span><span class="token punctuation">:</span>
 <span class="token key atrule">seconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
<span class="token key atrule">run_every</span><span class="token punctuation">:</span>
  <span class="token key atrule">minutes</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token key atrule">buffer_time</span><span class="token punctuation">:</span>
  <span class="token key atrule">minutes</span><span class="token punctuation">:</span> <span class="token number">10</span>
<span class="token key atrule">filter</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">query</span><span class="token punctuation">:</span>
    <span class="token key atrule">query_string</span><span class="token punctuation">:</span>
      <span class="token key atrule">query</span><span class="token punctuation">:</span> <span class="token string">&quot;groups: nginx AND response: 404&quot;</span>
<span class="token key atrule">alert</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token string">&quot;email&quot;</span>
<span class="token key atrule">email</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;liql@eryajf.net&quot;</span>
<span class="token key atrule">smtp_host</span><span class="token punctuation">:</span> smtp.163.com
<span class="token key atrule">smtp_port</span><span class="token punctuation">:</span> <span class="token number">25</span>
<span class="token key atrule">smtp_auth_file</span><span class="token punctuation">:</span> /data/elastalert<span class="token punctuation">-</span>0.1.37/smtp_auth_file.yaml
<span class="token key atrule">from_addr</span><span class="token punctuation">:</span> Linuxlql@163.com
<span class="token key atrule">email_reply_to</span><span class="token punctuation">:</span> Linuxlql@163.com
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>\u6CE8\u610F\u91CC\u8FB9\u5728\u914D\u7F6E\u90AE\u4EF6\u901A\u77E5\u7684\u65F6\u5019\uFF0C\u8FD8\u9700\u8981\u5F15\u7528\u5916\u90E8\u7684\u4E00\u4E2A\u6587\u4EF6\uFF0C\u8FD9\u4E2A\u6587\u4EF6\u91CC\u7528\u4E8E\u5B58\u653E\u5BF9\u5E94\u90AE\u7BB1\u7684\u7528\u6237\u540D\u5BC6\u7801\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>$cat /data/elastalert<span class="token punctuation">-</span>0.1.37/smtp_auth_file.yaml
<span class="token key atrule">user</span><span class="token punctuation">:</span> <span class="token string">&quot;Linuxlql@163.com&quot;</span>
<span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">&quot;xxxxxxx&quot;</span> <span class="token comment"># \u6CE8\u610F\u8FD9\u4E2A\u5730\u65B9\u662F\u6388\u6743\u7801\uFF0C\u800C\u975E\u90AE\u7BB1\u5BC6\u7801\uFF0C\u5982\u679C\u662F\u8FD0\u7EF4\u8001\u53F8\u673A\uFF0C\u80AF\u5B9A\u80FD\u660E\u767D\u6211\u8BF4\u7684\u610F\u601D</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_4-\u89C4\u5219\u6D4B\u8BD5\u3002" tabindex="-1"><a class="header-anchor" href="#_4-\u89C4\u5219\u6D4B\u8BD5\u3002" aria-hidden="true">#</a> 4\uFF0C\u89C4\u5219\u6D4B\u8BD5\u3002</h3><p>\u521A\u521A\u5DF2\u7ECF\u6DFB\u52A0\u4E86\u4E00\u6761\u89C4\u5219\uFF0C\u73B0\u5728\u53EF\u4EE5\u7528\u81EA\u8EAB\u7684\u547D\u4EE4\u6D4B\u8BD5\u4E00\u4E0B\u521A\u521A\u6DFB\u52A0\u7684\u89C4\u5219\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ elastalert-test-rule nginx.yaml
/usr/lib/python2.7/site-packages/elastalert-0.1.37-py2.7.egg/elastalert/config.py:29: YAMLLoadWarning: calling yaml.load<span class="token punctuation">(</span><span class="token punctuation">)</span> without <span class="token assign-left variable">Loader</span><span class="token operator">=</span><span class="token punctuation">..</span>. is deprecated, as the default Loader is unsafe. Please <span class="token builtin class-name">read</span> https://msg.pyyaml.org/load <span class="token keyword">for</span> full details.
  rule_schema <span class="token operator">=</span> jsonschema.Draft4Validator<span class="token punctuation">(</span>yaml.load<span class="token punctuation">(</span>open<span class="token punctuation">(</span>os.path.join<span class="token punctuation">(</span>os.path.dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span>, <span class="token string">&#39;schema.yaml&#39;</span><span class="token punctuation">))</span><span class="token punctuation">))</span>
Successfully loaded Nginx.
INFO:elastalert:Note: In debug mode, alerts will be logged to console but NOT actually sent.
                To send them but remain verbose, use --verbose instead.
INFO:elastalert:Queried rule Nginx. from <span class="token number">2019</span>-10-14 <span class="token number">20</span>:40 CST to <span class="token number">2019</span>-10-14 <span class="token number">20</span>:50 CST: <span class="token number">0</span> / <span class="token number">0</span> hits
INFO:elastalert:Queried rule Nginx. from <span class="token number">2019</span>-10-14 <span class="token number">20</span>:50 CST to <span class="token number">2019</span>-10-14 <span class="token number">21</span>:00 CST: <span class="token number">0</span> / <span class="token number">0</span> hits
INFO:elastalert:Queried rule Nginx. from <span class="token number">2019</span>-10-14 <span class="token number">21</span>:00 CST to <span class="token number">2019</span>-10-14 <span class="token number">21</span>:10 CST: <span class="token number">0</span> / <span class="token number">0</span> hits
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
\u4E2D\u95F4\u8F93\u51FA\u7701\u7565
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
INFO:elastalert:Queried rule Nginx. from <span class="token number">2019</span>-10-15 <span class="token number">20</span>:30 CST to <span class="token number">2019</span>-10-15 <span class="token number">20</span>:40 CST: <span class="token number">0</span> / <span class="token number">0</span> hits
Would have written the following documents to writeback index <span class="token punctuation">(</span>default is elastalert_status<span class="token punctuation">)</span>:
elastalert_status - <span class="token punctuation">{</span><span class="token string">&#39;hits&#39;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">&#39;matches&#39;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">&#39;@timestamp&#39;</span><span class="token builtin class-name">:</span> datetime.datetime<span class="token punctuation">(</span><span class="token number">2019</span>, <span class="token number">10</span>, <span class="token number">15</span>, <span class="token number">12</span>, <span class="token number">40</span>, <span class="token number">36</span>, <span class="token number">145240</span>, <span class="token assign-left variable">tzinfo</span><span class="token operator">=</span>tzutc<span class="token punctuation">(</span><span class="token punctuation">))</span>, <span class="token string">&#39;rule_name&#39;</span><span class="token builtin class-name">:</span> <span class="token string">&#39;Nginx.&#39;</span>, <span class="token string">&#39;starttime&#39;</span><span class="token builtin class-name">:</span> datetime.datetime<span class="token punctuation">(</span><span class="token number">2019</span>, <span class="token number">10</span>, <span class="token number">14</span>, <span class="token number">12</span>, <span class="token number">40</span>, <span class="token number">33</span>, <span class="token number">228045</span>, <span class="token assign-left variable">tzinfo</span><span class="token operator">=</span>tzutc<span class="token punctuation">(</span><span class="token punctuation">))</span>, <span class="token string">&#39;endtime&#39;</span><span class="token builtin class-name">:</span> datetime.datetime<span class="token punctuation">(</span><span class="token number">2019</span>, <span class="token number">10</span>, <span class="token number">15</span>, <span class="token number">12</span>, <span class="token number">40</span>, <span class="token number">33</span>, <span class="token number">228045</span>, <span class="token assign-left variable">tzinfo</span><span class="token operator">=</span>tzutc<span class="token punctuation">(</span><span class="token punctuation">))</span>, <span class="token string">&#39;time_taken&#39;</span><span class="token builtin class-name">:</span> <span class="token number">2.9058749675750732</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>\u5982\u679C\u6CA1\u6709\u62A5\u9519\uFF0C\u5219\u8BF4\u660E\u53EF\u7528\u3002</p><h3 id="_5-\u542F\u52A8\u3002" tabindex="-1"><a class="header-anchor" href="#_5-\u542F\u52A8\u3002" aria-hidden="true">#</a> 5\uFF0C\u542F\u52A8\u3002</h3><p>\u4F7F\u7528\u5982\u4E0B\u547D\u4EE4\u53EF\u4EE5\u76F4\u63A5\u542F\u52A8\u5E94\u7528\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>python -m elastalert.elastalert --verbose --config /data/elastalert-0.1.37/config.yaml
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u5982\u679C\u524D\u8FB9\u90FD\u6CA1\u6BDB\u75C5\uFF0C\u90A3\u4E48\u8FD9\u91CC\u542F\u52A8\u5E94\u8BE5\u4E5F\u4E0D\u4F1A\u62A5\u9519\uFF0C\u800C\u662F\u5904\u4E8E\u524D\u53F0\u76D1\u542C\u72B6\u6001\u3002</p><h3 id="_6-\u9A8C\u8BC1\u3002" tabindex="-1"><a class="header-anchor" href="#_6-\u9A8C\u8BC1\u3002" aria-hidden="true">#</a> 6\uFF0C\u9A8C\u8BC1\u3002</h3><p>\u670D\u52A1\u542F\u52A8\u4E4B\u540E\uFF0C\u65E5\u5FD7\u80FD\u591F\u5F88\u6E05\u6670\u770B\u5230\u6574\u4E2A\u8FC7\u7A0B\uFF0C\u6B64\u65F6\u53EF\u4EE5\u5728\u521A\u521A\u7684\u7D22\u5F15\u539F\u70B9\u8BF7\u6C42\u51E0\u4E2A\u4E0D\u5B58\u5728\u7684\u63A5\u53E3\uFF0C\u9020\u4E00\u4E9B404\u72B6\u6001\uFF0C\u8FC7\u4E00\u4F1A\u513F\u5E94\u8BE5\u53EF\u4EE5\u770B\u5230\u65E5\u5FD7\u4E2D\u7684\u8BF4\u660E\uFF0C\u6709\u544A\u8B66\u53D1\u51FA\uFF0C\u90AE\u7BB1\u5E94\u8BE5\u4E5F\u80FD\u6536\u5230\u4E86\u3002</p><p><img src="http://t.eryajf.net/imgs/2021/09/d3eb338e3906e380.jpg" alt="20191018172523"></p><h2 id="_4-\u4F18\u5316\u3002" tabindex="-1"><a class="header-anchor" href="#_4-\u4F18\u5316\u3002" aria-hidden="true">#</a> 4\uFF0C\u4F18\u5316\u3002</h2><h3 id="_1-\u542F\u52A8\u65B9\u5F0F\u3002" tabindex="-1"><a class="header-anchor" href="#_1-\u542F\u52A8\u65B9\u5F0F\u3002" aria-hidden="true">#</a> 1\uFF0C\u542F\u52A8\u65B9\u5F0F\u3002</h3><p>\u4E0A\u8FB9\u7684\u542F\u52A8\u547D\u4EE4\u53EA\u662F\u5728\u524D\u53F0\u542F\u52A8\uFF0C\u5E76\u4E0D\u7ED9\u529B\uFF0C\u73B0\u5728\u5C06\u5E94\u7528\u52A0\u5165\u5230supervisord\u7BA1\u7406\uFF0C\u4F1A\u66F4\u52A0\u65B9\u4FBF\u3002</p>`,37),A=n("supervisord\u5982\u4F55\u5B89\u88C5\u5C31\u4E0D\u8BF4\u4E86\uFF0C\u53EF\u4EE5"),Q={href:"https://wiki.eryajf.net/pages/1903.html",target:"_blank",rel:"noopener noreferrer"},$=n("\u53C2\u8003\u8FD9\u91CC\u3002"),O=l(`<p>\u521B\u5EFA\u914D\u7F6E\u6587\u4EF6\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token variable">$cat</span> /etc/supervisord.d/elastalert1.ini
<span class="token punctuation">[</span>program:elastalert1<span class="token punctuation">]</span>
<span class="token assign-left variable">directory</span><span class="token operator">=</span>/data/elastalert1/
<span class="token assign-left variable">command</span><span class="token operator">=</span>python -m elastalert.elastalert --verbose --config /data/elastalert1/config.yaml
<span class="token assign-left variable">process_name</span><span class="token operator">=</span>elastalert1
<span class="token assign-left variable">autorestart</span><span class="token operator">=</span>true
<span class="token assign-left variable">startsecs</span><span class="token operator">=</span><span class="token number">15</span>
<span class="token assign-left variable">stopsignal</span><span class="token operator">=</span>INT
<span class="token assign-left variable">stopasgroup</span><span class="token operator">=</span>true
<span class="token assign-left variable">killasgroup</span><span class="token operator">=</span>true
<span class="token assign-left variable">redirect_stderr</span><span class="token operator">=</span>true
<span class="token assign-left variable">stdout_logfile</span><span class="token operator">=</span>/data/log/elastalert1.log
<span class="token assign-left variable">stdout_logfile_maxbytes</span><span class="token operator">=</span>5MB
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>\u7136\u540E\u542F\u52A8\u5373\u53EF\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>supervisorctl update
supervisorctl start elastalert1
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-\u907F\u514D\u91CD\u590D\u544A\u8B66" tabindex="-1"><a class="header-anchor" href="#_2-\u907F\u514D\u91CD\u590D\u544A\u8B66" aria-hidden="true">#</a> 2\uFF0C\u907F\u514D\u91CD\u590D\u544A\u8B66</h3><p>\u907F\u514D\u4E00\u5B9A\u65F6\u95F4\u6BB5\u4E2D\u91CD\u590D\u544A\u8B66\uFF0C\u53EF\u4EE5\u914D\u7F6E<code>realert</code>\u548C<code>exponential_realert</code>\u8FD9\u4E24\u4E2A\u9009\u9879\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># 5\u5206\u949F\u5185\u76F8\u540C\u7684\u62A5\u8B66\u4E0D\u4F1A\u91CD\u590D\u53D1\u9001</span>
<span class="token key atrule">realert</span><span class="token punctuation">:</span>
  <span class="token key atrule">minutes</span><span class="token punctuation">:</span> <span class="token number">5</span>
<span class="token comment"># \u6307\u6570\u7EA7\u6269\u5927 realert \u65F6\u95F4\uFF0C\u4E2D\u95F4\u5982\u679C\u6709\u62A5\u8B66\uFF0C</span>
<span class="token comment"># \u5219\u6309\u71675-&gt;10-&gt;20-&gt;40-&gt;60\u4E0D\u65AD\u589E\u5927\u62A5\u8B66\u65F6\u95F4\u5230\u5236\u5B9A\u7684\u6700\u5927\u65F6\u95F4\uFF0C</span>
<span class="token comment"># \u5982\u679C\u4E4B\u540E\u62A5\u8B66\u51CF\u5C11\uFF0C\u5219\u4F1A\u6162\u6162\u6062\u590D\u539F\u59CBrealert\u65F6\u95F4</span>
<span class="token key atrule">exponential_realert</span><span class="token punctuation">:</span>
  <span class="token key atrule">hours</span><span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-\u805A\u5408\u76F8\u540C\u544A\u8B66" tabindex="-1"><a class="header-anchor" href="#_3-\u805A\u5408\u76F8\u540C\u544A\u8B66" aria-hidden="true">#</a> 3\uFF0C\u805A\u5408\u76F8\u540C\u544A\u8B66</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># \u6839\u636E\u62A5\u8B66\u7684\u5185\u5BB9\u5C06\u76F8\u540C\u7684\u62A5\u8B66\u6309\u7167 name \u6765\u805A\u5408</span>
<span class="token key atrule">aggregation_key</span><span class="token punctuation">:</span> name
<span class="token comment"># \u805A\u5408\u62A5\u8B66\u7684\u5185\u5BB9\uFF0C\u53EA\u5C55\u793A name \u4E0E message</span>
<span class="token key atrule">summary_table_fields</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> name
  <span class="token punctuation">-</span> message
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_4-\u544A\u8B66\u5185\u5BB9\u683C\u5F0F\u5316" tabindex="-1"><a class="header-anchor" href="#_4-\u544A\u8B66\u5185\u5BB9\u683C\u5F0F\u5316" aria-hidden="true">#</a> 4\uFF0C\u544A\u8B66\u5185\u5BB9\u683C\u5F0F\u5316</h3><p>\u53EF\u4EE5\u81EA\u5B9A\u4E49\u544A\u8B66\u5185\u5BB9\uFF0C\u5185\u90E8\u662F\u4F7F\u7528<code>Python</code>\u7684<code>format</code>\u6765\u5B9E\u73B0\u7684\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">alert_subject</span><span class="token punctuation">:</span> <span class="token string">&quot;Error {} @{}&quot;</span>
<span class="token key atrule">alert_subject_args</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> name
  <span class="token punctuation">-</span> <span class="token string">&quot;@timestamp&quot;</span>
<span class="token key atrule">alert_text_type</span><span class="token punctuation">:</span> alert_text_only
<span class="token key atrule">alert_text</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
  ### Error frequency exceeds
  &gt; Name: {}
  &gt; Message: {}
  &gt; Host: {} ({})</span>
<span class="token key atrule">alert_text_args</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> name
  <span class="token punctuation">-</span> message
  <span class="token punctuation">-</span> hostname
  <span class="token punctuation">-</span> host
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>\u62A5\u9519\u53C2\u8003\uFF1A</p>`,13),V=n("\u5173\u4E8Esetuptools\u62A5\u9519 "),F={href:"https://github.com/s3tools/s3cmd/issues/979",target:"_blank",rel:"noopener noreferrer"},D=n("https://github.com/s3tools/s3cmd/issues/979"),B=n("\u5173\u4E8Eidna\u62A5\u9519 "),W={href:"https://github.com/Yelp/elastalert/issues/2019",target:"_blank",rel:"noopener noreferrer"},U=n("https://github.com/Yelp/elastalert/issues/2019"),R=n("\u5173\u4E8E\u542F\u52A8\u62A5\u9519 "),X={href:"https://github.com/Yelp/elastalert/issues/2314",target:"_blank",rel:"noopener noreferrer"},G=n("https://github.com/Yelp/elastalert/issues/2314"),H=n("\u5173\u4E8Esix\u62A5\u9519 "),J={href:"https://github.com/pypa/pip/issues/3165",target:"_blank",rel:"noopener noreferrer"},K=n("https://github.com/pypa/pip/issues/3165"),Z=n("\u5173\u4E8EPyYAML\u62A5\u9519 "),ss={href:"https://blog.csdn.net/jiangjiang_jian/article/details/80286220",target:"_blank",rel:"noopener noreferrer"},ns=n("https://blog.csdn.net/jiangjiang_jian/article/details/80286220"),as=s("p",null,"\u53EF\u80FD\u62A5\u9519\u8FDC\u4E0D\u6B62\u5982\u4E0A\u6240\u793A\u7684\u51E0\u4E2A\uFF0C\u4F46\u662F\u8FD9\u91CC\u8BB0\u5F55\u4E0B\u6765\uFF0C\u7B97\u662F\u63D0\u4F9B\u4E00\u4E2A\u65B9\u6CD5\u3002",-1),es=s("p",null,"\u6587\u7AE0\u53C2\u8003\uFF1A",-1),ls={href:"https://www.tony-yin.site/2018/11/15/ES-ElastAlert/#",target:"_blank",rel:"noopener noreferrer"},ps=n("https://www.tony-yin.site/2018/11/15/ES-ElastAlert/#"),ts={href:"https://www.jianshu.com/p/7507da419230",target:"_blank",rel:"noopener noreferrer"},rs=n("https://www.jianshu.com/p/7507da419230"),os={href:"https://www.codetd.com/article/7308084",target:"_blank",rel:"noopener noreferrer"},cs=n("https://www.codetd.com/article/7308084");function is(us,bs){const a=p("ExternalLinkIcon");return t(),r(o,null,[u,b,d,m,k,h,s("ul",null,[g,_,y,s("li",null,[s("a",f,[v,e(a)]),x]),w]),q,s("ul",null,[N,j,P,s("li",null,[s("a",L,[S,e(a)]),z]),Y]),T,s("p",null,[E,s("a",C,[I,e(a)])]),M,s("p",null,[A,s("a",Q,[$,e(a)])]),O,s("ul",null,[s("li",null,[V,s("ul",null,[s("li",null,[s("a",F,[D,e(a)])])])]),s("li",null,[B,s("ul",null,[s("li",null,[s("a",W,[U,e(a)])])])]),s("li",null,[R,s("ul",null,[s("li",null,[s("a",X,[G,e(a)])])])]),s("li",null,[H,s("ul",null,[s("li",null,[s("a",J,[K,e(a)])])])]),s("li",null,[Z,s("ul",null,[s("li",null,[s("a",ss,[ns,e(a)])])])])]),as,es,s("ul",null,[s("li",null,[s("a",ls,[ps,e(a)])]),s("li",null,[s("a",ts,[rs,e(a)])]),s("li",null,[s("a",os,[cs,e(a)])])])],64)}var ks=c(i,[["render",is]]);export{ks as default};
