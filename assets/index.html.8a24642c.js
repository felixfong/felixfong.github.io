import{r as e,o,c,b as n,a as p,F as u,d as s,e as t}from"./app.dbf5d933.js";import{_ as l}from"./plugin-vue_export-helper.21dcd24c.js";const i={},r=n("p",null,"gorm\u662F\u4E00\u4E2A\u4F7F\u7528Go\u8BED\u8A00\u7F16\u5199\u7684ORM\u6846\u67B6\u3002\u5B83\u6587\u6863\u9F50\u5168\uFF0C\u5BF9\u5F00\u53D1\u8005\u53CB\u597D\uFF0C\u652F\u6301\u4E3B\u6D41\u6570\u636E\u5E93\u3002",-1),k=n("h2",{id:"_1-gorm\u4ECB\u7ECD",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_1-gorm\u4ECB\u7ECD","aria-hidden":"true"},"#"),s(" 1\uFF0Cgorm\u4ECB\u7ECD")],-1),b={href:"https://github.com/jinzhu/gorm",target:"_blank",rel:"noopener noreferrer"},m=s("Github GORM"),d={href:"https://gorm.io/zh_CN/",target:"_blank",rel:"noopener noreferrer"},g=s("\u4E2D\u6587\u5B98\u65B9\u7F51\u7AD9"),q=s("\u5185\u542B\u5341\u5206\u9F50\u5168\u7684\u4E2D\u6587\u6587\u6863\uFF0C\u6709\u4E86\u5B83\u4F60\u751A\u81F3\u4E0D\u9700\u8981\u518D\u7EE7\u7EED\u5411\u4E0B\u9605\u8BFB\u672C\u6587\u3002"),f=t(`<h2 id="_2-\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#_2-\u5B89\u88C5" aria-hidden="true">#</a> 2\uFF0C\u5B89\u88C5</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>go get -u github.com/jinzhu/gorm
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="_3-\u8FDE\u63A5\u6570\u636E\u5E93" tabindex="-1"><a class="header-anchor" href="#_3-\u8FDE\u63A5\u6570\u636E\u5E93" aria-hidden="true">#</a> 3\uFF0C\u8FDE\u63A5\u6570\u636E\u5E93</h2><p>\u8FDE\u63A5\u4E0D\u540C\u7684\u6570\u636E\u5E93\u90FD\u9700\u8981\u5BFC\u5165\u5BF9\u5E94\u6570\u636E\u7684\u9A71\u52A8\u7A0B\u5E8F\uFF0C<code>GORM</code>\u5DF2\u7ECF\u8D34\u5FC3\u7684\u4E3A\u6211\u4EEC\u5305\u88C5\u4E86\u4E00\u4E9B\u9A71\u52A8\u7A0B\u5E8F\uFF0C\u53EA\u9700\u8981\u6309\u5982\u4E0B\u65B9\u5F0F\u5BFC\u5165\u9700\u8981\u7684\u6570\u636E\u5E93\u9A71\u52A8\u5373\u53EF\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token comment">// import _ &quot;github.com/jinzhu/gorm/dialects/postgres&quot;</span>
<span class="token comment">// import _ &quot;github.com/jinzhu/gorm/dialects/sqlite&quot;</span>
<span class="token comment">// import _ &quot;github.com/jinzhu/gorm/dialects/mssql&quot;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_1-\u8FDE\u63A5mysql" tabindex="-1"><a class="header-anchor" href="#_1-\u8FDE\u63A5mysql" aria-hidden="true">#</a> 1\uFF0C\u8FDE\u63A5MySQL</h3><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
  <span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user:password@(localhost)/dbname?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_2-\u8FDE\u63A5postgresql" tabindex="-1"><a class="header-anchor" href="#_2-\u8FDE\u63A5postgresql" aria-hidden="true">#</a> 2\uFF0C\u8FDE\u63A5PostgreSQL</h3><p>\u57FA\u672C\u4EE3\u7801\u540C\u4E0A\uFF0C\u6CE8\u610F\u5F15\u5165\u5BF9\u5E94<code>postgres</code>\u9A71\u52A8\u5E76\u6B63\u786E\u6307\u5B9A<code>gorm.Open()</code>\u53C2\u6570\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
  <span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/postgres&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;postgres&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;host=myhost port=myport user=gorm dbname=gorm password=mypassword&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-\u8FDE\u63A5sqlite3" tabindex="-1"><a class="header-anchor" href="#_3-\u8FDE\u63A5sqlite3" aria-hidden="true">#</a> 3\uFF0C\u8FDE\u63A5Sqlite3</h3><p>\u57FA\u672C\u4EE3\u7801\u540C\u4E0A\uFF0C\u6CE8\u610F\u5F15\u5165\u5BF9\u5E94<code>sqlite</code>\u9A71\u52A8\u5E76\u6B63\u786E\u6307\u5B9A<code>gorm.Open()</code>\u53C2\u6570\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
  <span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/sqlite&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;sqlite3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/tmp/gorm.db&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-\u8FDE\u63A5sql-server" tabindex="-1"><a class="header-anchor" href="#_4-\u8FDE\u63A5sql-server" aria-hidden="true">#</a> 4\uFF0C\u8FDE\u63A5SQL Server</h3><p>\u57FA\u672C\u4EE3\u7801\u540C\u4E0A\uFF0C\u6CE8\u610F\u5F15\u5165\u5BF9\u5E94<code>mssql</code>\u9A71\u52A8\u5E76\u6B63\u786E\u6307\u5B9A<code>gorm.Open()</code>\u53C2\u6570\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
  <span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mssql&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mssql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sqlserver://username:password@localhost:1433?database=dbname&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="_4-gorm\u57FA\u672C\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_4-gorm\u57FA\u672C\u793A\u4F8B" aria-hidden="true">#</a> 4\uFF0CGORM\u57FA\u672C\u793A\u4F8B</h2><p><strong>\u6CE8\u610F:</strong></p><ol><li>\u672C\u6587\u4EE5MySQL\u6570\u636E\u5E93\u4E3A\u4F8B\uFF0C\u8BB2\u89E3GORM\u5404\u9879\u529F\u80FD\u7684\u4E3B\u8981\u4F7F\u7528\u65B9\u6CD5\u3002</li><li>\u5F80\u4E0B\u9605\u8BFB\u672C\u6587\u524D\uFF0C\u4F60\u9700\u8981\u6709\u4E00\u4E2A\u80FD\u591F\u6210\u529F\u8FDE\u63A5\u4E0A\u7684MySQL\u6570\u636E\u5E93\u5B9E\u4F8B\u3002</li></ol><h3 id="_1-docker\u5FEB\u901F\u521B\u5EFAmysql\u5B9E\u4F8B" tabindex="-1"><a class="header-anchor" href="#_1-docker\u5FEB\u901F\u521B\u5EFAmysql\u5B9E\u4F8B" aria-hidden="true">#</a> 1\uFF0CDocker\u5FEB\u901F\u521B\u5EFAMySQL\u5B9E\u4F8B</h3><p>\u5F88\u591A\u540C\u5B66\u5982\u679C\u4E0D\u4F1A\u5B89\u88C5MySQL\u6216\u8005\u61D2\u5F97\u5B89\u88C5MySQL\uFF0C\u53EF\u4EE5\u4F7F\u7528\u4E00\u4E0B\u547D\u4EE4\u5FEB\u901F\u8FD0\u884C\u4E00\u4E2AMySQL8.0.19\u5B9E\u4F8B\uFF0C\u5F53\u7136\u524D\u63D0\u662F\u4F60\u8981\u6709docker\u73AF\u5883\u2026</p><p>\u5728\u672C\u5730\u7684<code>13306</code>\u7AEF\u53E3\u8FD0\u884C\u4E00\u4E2A\u540D\u4E3A<code>mysql8019</code>\uFF0Croot\u7528\u6237\u540D\u5BC6\u7801\u4E3A<code>root1234</code>\u7684MySQL\u5BB9\u5668\u73AF\u5883:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run --name mysql8019 -p <span class="token number">13306</span>:3306 -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root1234 -d mysql:8.0.19
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u5728\u53E6\u5916\u542F\u52A8\u4E00\u4E2A<code>MySQL Client</code>\u8FDE\u63A5\u4E0A\u9762\u7684MySQL\u73AF\u5883\uFF0C\u5BC6\u7801\u4E3A\u4E0A\u4E00\u6B65\u6307\u5B9A\u7684\u5BC6\u7801<code>root1234</code>:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run -it --network <span class="token function">host</span> --rm mysql mysql -h127.0.0.1 -P13306 --default-character-set<span class="token operator">=</span>utf8mb4 -uroot -p
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="_2-\u521B\u5EFA\u6570\u636E\u5E93" tabindex="-1"><a class="header-anchor" href="#_2-\u521B\u5EFA\u6570\u636E\u5E93" aria-hidden="true">#</a> 2\uFF0C\u521B\u5EFA\u6570\u636E\u5E93</h3><p>\u5728\u4F7F\u7528GORM\u524D\u624B\u52A8\u521B\u5EFA\u6570\u636E\u5E93<code>db1</code>\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>CREATE DATABASE db1<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="_3-gorm\u64CD\u4F5Cmysql" tabindex="-1"><a class="header-anchor" href="#_3-gorm\u64CD\u4F5Cmysql" aria-hidden="true">#</a> 3\uFF0CGORM\u64CD\u4F5CMySQL</h3><p>\u4F7F\u7528GORM\u8FDE\u63A5\u4E0A\u9762\u7684<code>db1</code>\u8FDB\u884C\u521B\u5EFA\u3001\u67E5\u8BE2\u3001\u66F4\u65B0\u3001\u5220\u9664\u64CD\u4F5C\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> UserInfo <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Id     <span class="token builtin">uint</span>
	Name   <span class="token builtin">string</span>
	Gender <span class="token builtin">string</span>
	Hobby  <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u521B\u5EFA\u8868\uFF0C\u81EA\u52A8\u8FC1\u79FB\uFF08\u628A\u7ED3\u6784\u4F53\u548C\u6570\u636E\u8868\u8FDB\u884C\u5BF9\u5E94\uFF09</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>UserInfo<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token comment">// \u521B\u5EFA\u6570\u636E\u884C</span>
	<span class="token comment">//u1 := UserInfo{1, &quot;eryajf&quot;, &quot;\u7537&quot;, &quot;\u7BEE\u7403&quot;}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>

	<span class="token comment">// \u67E5\u8BE2\u6570\u636E</span>
	<span class="token keyword">var</span> u UserInfo
	db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>u<span class="token punctuation">)</span> <span class="token comment">//\u67E5\u8BE2\u8868\u4E2D\u7B2C\u4E00\u6761\u6570\u636E\u4FDD\u5B58\u5230u\u4E2D</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;u:%#v\\n&quot;</span><span class="token punctuation">,</span> u<span class="token punctuation">)</span>

	<span class="token comment">// \u66F4\u65B0\u6570\u636E</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>u<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;hobby&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\u53CC\u8272\u7403&quot;</span><span class="token punctuation">)</span>

	<span class="token comment">// \u5220\u9664\u6570\u636E</span>
	db<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>u<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h2 id="_5-gorm-model\u5B9A\u4E49" tabindex="-1"><a class="header-anchor" href="#_5-gorm-model\u5B9A\u4E49" aria-hidden="true">#</a> 5\uFF0CGORM Model\u5B9A\u4E49</h2><p>\u5728\u4F7F\u7528ORM\u5DE5\u5177\u65F6\uFF0C\u901A\u5E38\u6211\u4EEC\u9700\u8981\u5728\u4EE3\u7801\u4E2D\u5B9A\u4E49\u6A21\u578B\uFF08Models\uFF09\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u6570\u636E\u8868\u8FDB\u884C\u6620\u5C04\uFF0C\u5728GORM\u4E2D\u6A21\u578B\uFF08Models\uFF09\u901A\u5E38\u662F\u6B63\u5E38\u5B9A\u4E49\u7684\u7ED3\u6784\u4F53\u3001\u57FA\u672C\u7684go\u7C7B\u578B\u6216\u5B83\u4EEC\u7684\u6307\u9488\u3002 \u540C\u65F6\u4E5F\u652F\u6301<code>sql.Scanner</code>\u53CA<code>driver.Valuer</code>\u63A5\u53E3\uFF08interfaces\uFF09\u3002</p><h3 id="_1-gorm-model" tabindex="-1"><a class="header-anchor" href="#_1-gorm-model" aria-hidden="true">#</a> 1\uFF0Cgorm.Model</h3><p>\u4E3A\u4E86\u65B9\u4FBF\u6A21\u578B\u5B9A\u4E49\uFF0CGORM\u5185\u7F6E\u4E86\u4E00\u4E2A<code>gorm.Model</code>\u7ED3\u6784\u4F53\u3002<code>gorm.Model</code>\u662F\u4E00\u4E2A\u5305\u542B\u4E86<code>ID</code>, <code>CreatedAt</code>, <code>UpdatedAt</code>, <code>DeletedAt</code>\u56DB\u4E2A\u5B57\u6BB5\u7684Golang\u7ED3\u6784\u4F53\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// gorm.Model \u5B9A\u4E49</span>
<span class="token keyword">type</span> Model <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  ID        <span class="token builtin">uint</span> <span class="token string">\`gorm:&quot;primary_key&quot;\`</span>
  CreatedAt time<span class="token punctuation">.</span>Time
  UpdatedAt time<span class="token punctuation">.</span>Time
  DeletedAt <span class="token operator">*</span>time<span class="token punctuation">.</span>Time
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u4F60\u53EF\u4EE5\u5C06\u5B83\u5D4C\u5165\u5230\u4F60\u81EA\u5DF1\u7684\u6A21\u578B\u4E2D\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// \u5C06 \`ID\`, \`CreatedAt\`, \`UpdatedAt\`, \`DeletedAt\`\u5B57\u6BB5\u6CE8\u5165\u5230\`User\`\u6A21\u578B\u4E2D</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Name <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u5F53\u7136\u4F60\u4E5F\u53EF\u4EE5\u5B8C\u5168\u81EA\u5DF1\u5B9A\u4E49\u6A21\u578B\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// \u4E0D\u4F7F\u7528gorm.Model\uFF0C\u81EA\u884C\u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  ID   <span class="token builtin">int</span>
  Name <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-\u6A21\u578B\u5B9A\u4E49\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_2-\u6A21\u578B\u5B9A\u4E49\u793A\u4F8B" aria-hidden="true">#</a> 2\uFF0C\u6A21\u578B\u5B9A\u4E49\u793A\u4F8B</h3><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Name         <span class="token builtin">string</span>
  Age          sql<span class="token punctuation">.</span>NullInt64
  Birthday     <span class="token operator">*</span>time<span class="token punctuation">.</span>Time
  Email        <span class="token builtin">string</span>  <span class="token string">\`gorm:&quot;type:varchar(100);unique_index&quot;\`</span>
  Role         <span class="token builtin">string</span>  <span class="token string">\`gorm:&quot;size:255&quot;\`</span> <span class="token comment">// \u8BBE\u7F6E\u5B57\u6BB5\u5927\u5C0F\u4E3A255</span>
  MemberNumber <span class="token operator">*</span><span class="token builtin">string</span> <span class="token string">\`gorm:&quot;unique;not null&quot;\`</span> <span class="token comment">// \u8BBE\u7F6E\u4F1A\u5458\u53F7\uFF08member number\uFF09\u552F\u4E00\u5E76\u4E14\u4E0D\u4E3A\u7A7A</span>
  Num          <span class="token builtin">int</span>     <span class="token string">\`gorm:&quot;AUTO_INCREMENT&quot;\`</span> <span class="token comment">// \u8BBE\u7F6E num \u4E3A\u81EA\u589E\u7C7B\u578B</span>
  Address      <span class="token builtin">string</span>  <span class="token string">\`gorm:&quot;index:addr&quot;\`</span> <span class="token comment">// \u7ED9address\u5B57\u6BB5\u521B\u5EFA\u540D\u4E3Aaddr\u7684\u7D22\u5F15</span>
  IgnoreMe     <span class="token builtin">int</span>     <span class="token string">\`gorm:&quot;-&quot;\`</span> <span class="token comment">// \u5FFD\u7565\u672C\u5B57\u6BB5</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_3-\u7ED3\u6784\u4F53\u6807\u8BB0-tags" tabindex="-1"><a class="header-anchor" href="#_3-\u7ED3\u6784\u4F53\u6807\u8BB0-tags" aria-hidden="true">#</a> 3\uFF0C\u7ED3\u6784\u4F53\u6807\u8BB0\uFF08tags\uFF09</h3><p>\u4F7F\u7528\u7ED3\u6784\u4F53\u58F0\u660E\u6A21\u578B\u65F6\uFF0C\u6807\u8BB0\uFF08tags\uFF09\u662F\u53EF\u9009\u9879\u3002gorm\u652F\u6301\u4EE5\u4E0B\u6807\u8BB0:</p><h4 id="_1-\u652F\u6301\u7684\u7ED3\u6784\u4F53\u6807\u8BB0-struct-tags" tabindex="-1"><a class="header-anchor" href="#_1-\u652F\u6301\u7684\u7ED3\u6784\u4F53\u6807\u8BB0-struct-tags" aria-hidden="true">#</a> 1\uFF0C\u652F\u6301\u7684\u7ED3\u6784\u4F53\u6807\u8BB0\uFF08Struct tags\uFF09</h4><table><thead><tr><th style="text-align:right;">\u7ED3\u6784\u4F53\u6807\u8BB0\uFF08Tag\uFF09</th><th style="text-align:left;">\u63CF\u8FF0</th></tr></thead><tbody><tr><td style="text-align:right;">Column</td><td style="text-align:left;">\u6307\u5B9A\u5217\u540D</td></tr><tr><td style="text-align:right;">Type</td><td style="text-align:left;">\u6307\u5B9A\u5217\u6570\u636E\u7C7B\u578B</td></tr><tr><td style="text-align:right;">Size</td><td style="text-align:left;">\u6307\u5B9A\u5217\u5927\u5C0F, \u9ED8\u8BA4\u503C255</td></tr><tr><td style="text-align:right;">PRIMARY_KEY</td><td style="text-align:left;">\u5C06\u5217\u6307\u5B9A\u4E3A\u4E3B\u952E</td></tr><tr><td style="text-align:right;">UNIQUE</td><td style="text-align:left;">\u5C06\u5217\u6307\u5B9A\u4E3A\u552F\u4E00</td></tr><tr><td style="text-align:right;">DEFAULT</td><td style="text-align:left;">\u6307\u5B9A\u5217\u9ED8\u8BA4\u503C</td></tr><tr><td style="text-align:right;">PRECISION</td><td style="text-align:left;">\u6307\u5B9A\u5217\u7CBE\u5EA6</td></tr><tr><td style="text-align:right;">NOT NULL</td><td style="text-align:left;">\u5C06\u5217\u6307\u5B9A\u4E3A\u975E NULL</td></tr><tr><td style="text-align:right;">AUTO_INCREMENT</td><td style="text-align:left;">\u6307\u5B9A\u5217\u662F\u5426\u4E3A\u81EA\u589E\u7C7B\u578B</td></tr><tr><td style="text-align:right;">INDEX</td><td style="text-align:left;">\u521B\u5EFA\u5177\u6709\u6216\u4E0D\u5E26\u540D\u79F0\u7684\u7D22\u5F15, \u5982\u679C\u591A\u4E2A\u7D22\u5F15\u540C\u540D\u5219\u521B\u5EFA\u590D\u5408\u7D22\u5F15</td></tr><tr><td style="text-align:right;">UNIQUE_INDEX</td><td style="text-align:left;">\u548C <code>INDEX</code> \u7C7B\u4F3C\uFF0C\u53EA\u4E0D\u8FC7\u521B\u5EFA\u7684\u662F\u552F\u4E00\u7D22\u5F15</td></tr><tr><td style="text-align:right;">EMBEDDED</td><td style="text-align:left;">\u5C06\u7ED3\u6784\u8BBE\u7F6E\u4E3A\u5D4C\u5165</td></tr><tr><td style="text-align:right;">EMBEDDED_PREFIX</td><td style="text-align:left;">\u8BBE\u7F6E\u5D4C\u5165\u7ED3\u6784\u7684\u524D\u7F00</td></tr><tr><td style="text-align:right;">-</td><td style="text-align:left;">\u5FFD\u7565\u6B64\u5B57\u6BB5</td></tr></tbody></table><h4 id="_2-\u5173\u8054\u76F8\u5173\u6807\u8BB0-tags" tabindex="-1"><a class="header-anchor" href="#_2-\u5173\u8054\u76F8\u5173\u6807\u8BB0-tags" aria-hidden="true">#</a> 2\uFF0C\u5173\u8054\u76F8\u5173\u6807\u8BB0\uFF08tags\uFF09</h4><table><thead><tr><th style="text-align:right;">\u7ED3\u6784\u4F53\u6807\u8BB0\uFF08Tag\uFF09</th><th style="text-align:left;">\u63CF\u8FF0</th></tr></thead><tbody><tr><td style="text-align:right;">MANY2MANY</td><td style="text-align:left;">\u6307\u5B9A\u8FDE\u63A5\u8868</td></tr><tr><td style="text-align:right;">FOREIGNKEY</td><td style="text-align:left;">\u8BBE\u7F6E\u5916\u952E</td></tr><tr><td style="text-align:right;">ASSOCIATION_FOREIGNKEY</td><td style="text-align:left;">\u8BBE\u7F6E\u5173\u8054\u5916\u952E</td></tr><tr><td style="text-align:right;">POLYMORPHIC</td><td style="text-align:left;">\u6307\u5B9A\u591A\u6001\u7C7B\u578B</td></tr><tr><td style="text-align:right;">POLYMORPHIC_VALUE</td><td style="text-align:left;">\u6307\u5B9A\u591A\u6001\u503C</td></tr><tr><td style="text-align:right;">JOINTABLE_FOREIGNKEY</td><td style="text-align:left;">\u6307\u5B9A\u8FDE\u63A5\u8868\u7684\u5916\u952E</td></tr><tr><td style="text-align:right;">ASSOCIATION_JOINTABLE_FOREIGNKEY</td><td style="text-align:left;">\u6307\u5B9A\u8FDE\u63A5\u8868\u7684\u5173\u8054\u5916\u952E</td></tr><tr><td style="text-align:right;">SAVE_ASSOCIATIONS</td><td style="text-align:left;">\u662F\u5426\u81EA\u52A8\u5B8C\u6210 save \u7684\u76F8\u5173\u64CD\u4F5C</td></tr><tr><td style="text-align:right;">ASSOCIATION_AUTOUPDATE</td><td style="text-align:left;">\u662F\u5426\u81EA\u52A8\u5B8C\u6210 update \u7684\u76F8\u5173\u64CD\u4F5C</td></tr><tr><td style="text-align:right;">ASSOCIATION_AUTOCREATE</td><td style="text-align:left;">\u662F\u5426\u81EA\u52A8\u5B8C\u6210 create \u7684\u76F8\u5173\u64CD\u4F5C</td></tr><tr><td style="text-align:right;">ASSOCIATION_SAVE_REFERENCE</td><td style="text-align:left;">\u662F\u5426\u81EA\u52A8\u5B8C\u6210\u5F15\u7528\u7684 save \u7684\u76F8\u5173\u64CD\u4F5C</td></tr><tr><td style="text-align:right;">PRELOAD</td><td style="text-align:left;">\u662F\u5426\u81EA\u52A8\u5B8C\u6210\u9884\u52A0\u8F7D\u7684\u76F8\u5173\u64CD\u4F5C</td></tr></tbody></table><h2 id="_6-\u4E3B\u952E\u3001\u8868\u540D\u3001\u5217\u540D\u7684\u7EA6\u5B9A" tabindex="-1"><a class="header-anchor" href="#_6-\u4E3B\u952E\u3001\u8868\u540D\u3001\u5217\u540D\u7684\u7EA6\u5B9A" aria-hidden="true">#</a> 6\uFF0C\u4E3B\u952E\u3001\u8868\u540D\u3001\u5217\u540D\u7684\u7EA6\u5B9A</h2><h3 id="_1-\u4E3B\u952E-primary-key" tabindex="-1"><a class="header-anchor" href="#_1-\u4E3B\u952E-primary-key" aria-hidden="true">#</a> 1\uFF0C\u4E3B\u952E\uFF08Primary Key\uFF09</h3><p>GORM \u9ED8\u8BA4\u4F1A\u4F7F\u7528\u540D\u4E3AID\u7684\u5B57\u6BB5\u4F5C\u4E3A\u8868\u7684\u4E3B\u952E\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  ID   <span class="token builtin">string</span> <span class="token comment">// \u540D\u4E3A\`ID\`\u7684\u5B57\u6BB5\u4F1A\u9ED8\u8BA4\u4F5C\u4E3A\u8868\u7684\u4E3B\u952E</span>
  Name <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u4F7F\u7528\`AnimalID\`\u4F5C\u4E3A\u4E3B\u952E</span>
<span class="token keyword">type</span> Animal <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  AnimalID <span class="token builtin">int64</span> <span class="token string">\`gorm:&quot;primary_key&quot;\`</span>
  Name     <span class="token builtin">string</span>
  Age      <span class="token builtin">int64</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_2-\u8868\u540D-table-name" tabindex="-1"><a class="header-anchor" href="#_2-\u8868\u540D-table-name" aria-hidden="true">#</a> 2\uFF0C\u8868\u540D\uFF08Table Name\uFF09</h3><p>\u8868\u540D\u9ED8\u8BA4\u5C31\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\uFF0C\u4F8B\u5982\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// \u9ED8\u8BA4\u8868\u540D\u662F \`users\`</span>

<span class="token comment">// \u65B9\u6CD5\u4E00\uFF1A\u5C06 User \u7684\u8868\u540D\u8BBE\u7F6E\u4E3A \`profiles\`</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>User<span class="token punctuation">)</span> <span class="token function">TableName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&quot;profiles&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>u User<span class="token punctuation">)</span> <span class="token function">TableName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> u<span class="token punctuation">.</span>Role <span class="token operator">==</span> <span class="token string">&quot;admin&quot;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;admin_users&quot;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;users&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u65B9\u6CD5\u4E8C\uFF1A\u7981\u7528\u9ED8\u8BA4\u8868\u540D\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u7F6E\u4E3A true\uFF0C\u5219 \`User\` \u7684\u9ED8\u8BA4\u8868\u540D\u662F \`user\`</span>
db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>\u4E5F\u53EF\u4EE5\u901A\u8FC7<code>Table()</code>\u6307\u5B9A\u8868\u540D\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// \u65B9\u6CD5\u4E09\uFF1A\u4F7F\u7528User\u7ED3\u6784\u4F53\u521B\u5EFA\u540D\u4E3A\`deleted_users\`\u7684\u8868</span>
db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;deleted_users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">CreateTable</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> deleted_users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;deleted_users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>deleted_users<span class="token punctuation">)</span>
<span class="token comment">//// SELECT * FROM deleted_users;</span>

db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;deleted_users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//// DELETE FROM deleted_users WHERE name = &#39;jinzhu&#39;;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>GORM\u8FD8\u652F\u6301\u66F4\u6539\u9ED8\u8BA4\u8868\u540D\u79F0\u89C4\u5219\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>gorm<span class="token punctuation">.</span>DefaultTableNameHandler <span class="token operator">=</span> <span class="token keyword">func</span> <span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> defaultTableName <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span>  <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&quot;prefix_&quot;</span> <span class="token operator">+</span> defaultTableName<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-\u5217\u540D-column-name" tabindex="-1"><a class="header-anchor" href="#_3-\u5217\u540D-column-name" aria-hidden="true">#</a> 3\uFF0C\u5217\u540D\uFF08Column Name\uFF09</h3><p>\u5217\u540D\u7531\u5B57\u6BB5\u540D\u79F0\u8FDB\u884C\u4E0B\u5212\u7EBF\u5206\u5272\u6765\u751F\u6210</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  ID        <span class="token builtin">uint</span>      <span class="token comment">// column name is \`id\`</span>
  Name      <span class="token builtin">string</span>    <span class="token comment">// column name is \`name\`</span>
  Birthday  time<span class="token punctuation">.</span>Time <span class="token comment">// column name is \`birthday\`</span>
  CreatedAt time<span class="token punctuation">.</span>Time <span class="token comment">// column name is \`created_at\`</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u53EF\u4EE5\u4F7F\u7528\u7ED3\u6784\u4F53tag\u6307\u5B9A\u5217\u540D\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Animal <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  AnimalId    <span class="token builtin">int64</span>     <span class="token string">\`gorm:&quot;column:beast_id&quot;\`</span>         <span class="token comment">// set column name to \`beast_id\`</span>
  Birthday    time<span class="token punctuation">.</span>Time <span class="token string">\`gorm:&quot;column:day_of_the_beast&quot;\`</span> <span class="token comment">// set column name to \`day_of_the_beast\`</span>
  Age         <span class="token builtin">int64</span>     <span class="token string">\`gorm:&quot;column:age_of_the_beast&quot;\`</span> <span class="token comment">// set column name to \`age_of_the_beast\`</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_4-\u65F6\u95F4\u6233\u8DDF\u8E2A" tabindex="-1"><a class="header-anchor" href="#_4-\u65F6\u95F4\u6233\u8DDF\u8E2A" aria-hidden="true">#</a> 4\uFF0C\u65F6\u95F4\u6233\u8DDF\u8E2A</h3><h4 id="_1-createdat" tabindex="-1"><a class="header-anchor" href="#_1-createdat" aria-hidden="true">#</a> 1\uFF0CCreatedAt</h4><p>\u5982\u679C\u6A21\u578B\u6709 <code>CreatedAt</code>\u5B57\u6BB5\uFF0C\u8BE5\u5B57\u6BB5\u7684\u503C\u5C06\u4F1A\u662F\u521D\u6B21\u521B\u5EFA\u8BB0\u5F55\u7684\u65F6\u95F4\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">// \`CreatedAt\`\u5C06\u4F1A\u662F\u5F53\u524D\u65F6\u95F4</span>

<span class="token comment">// \u53EF\u4EE5\u4F7F\u7528\`Update\`\u65B9\u6CD5\u6765\u6539\u53D8\`CreateAt\`\u7684\u503C</span>
db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;CreatedAt&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_2-updatedat" tabindex="-1"><a class="header-anchor" href="#_2-updatedat" aria-hidden="true">#</a> 2\uFF0CUpdatedAt</h4><p>\u5982\u679C\u6A21\u578B\u6709<code>UpdatedAt</code>\u5B57\u6BB5\uFF0C\u8BE5\u5B57\u6BB5\u7684\u503C\u5C06\u4F1A\u662F\u6BCF\u6B21\u66F4\u65B0\u8BB0\u5F55\u7684\u65F6\u95F4\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">// \`UpdatedAt\`\u5C06\u4F1A\u662F\u5F53\u524D\u65F6\u95F4</span>

db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span> <span class="token comment">// \`UpdatedAt\`\u5C06\u4F1A\u662F\u5F53\u524D\u65F6\u95F4</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_3-deletedat" tabindex="-1"><a class="header-anchor" href="#_3-deletedat" aria-hidden="true">#</a> 3\uFF0CDeletedAt</h4><p>\u5982\u679C\u6A21\u578B\u6709<code>DeletedAt</code>\u5B57\u6BB5\uFF0C\u8C03\u7528<code>Delete</code>\u5220\u9664\u8BE5\u8BB0\u5F55\u65F6\uFF0C\u5C06\u4F1A\u8BBE\u7F6E<code>DeletedAt</code>\u5B57\u6BB5\u4E3A\u5F53\u524D\u65F6\u95F4\uFF0C\u800C\u4E0D\u662F\u76F4\u63A5\u5C06\u8BB0\u5F55\u4ECE\u6570\u636E\u5E93\u4E2D\u5220\u9664\u3002</p><p>CRUD\u901A\u5E38\u6307\u6570\u636E\u5E93\u7684\u589E\u5220\u6539\u67E5\u64CD\u4F5C\uFF0C\u672C\u6587\u8BE6\u7EC6\u4ECB\u7ECD\u4E86\u5982\u4F55\u4F7F\u7528GORM\u5B9E\u73B0\u521B\u5EFA\u3001\u67E5\u8BE2\u3001\u66F4\u65B0\u548C\u5220\u9664\u64CD\u4F5C\u3002</p><h2 id="_7-\u521B\u5EFA" tabindex="-1"><a class="header-anchor" href="#_7-\u521B\u5EFA" aria-hidden="true">#</a> 7\uFF0C\u521B\u5EFA</h2><h3 id="_1-\u521B\u5EFA\u8BB0\u5F55" tabindex="-1"><a class="header-anchor" href="#_1-\u521B\u5EFA\u8BB0\u5F55" aria-hidden="true">#</a> 1\uFF0C\u521B\u5EFA\u8BB0\u5F55</h3><p>\u9996\u5148\u5B9A\u4E49\u6A21\u578B\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID           <span class="token builtin">int64</span>
	Name         <span class="token builtin">string</span>
	Age          <span class="token builtin">int64</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u4F7F\u7528\u4F7F\u7528<code>NewRecord()</code>\u67E5\u8BE2\u4E3B\u952E\u662F\u5426\u5B58\u5728\uFF0C\u4E3B\u952E\u4E3A\u7A7A\u4F7F\u7528<code>Create()</code>\u521B\u5EFA\u8BB0\u5F55\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>u <span class="token operator">:=</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;eryajf&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span> <span class="token comment">//\u7ED3\u6784\u4F53\u7684\u521D\u59CB\u5316\uFF0C\u76F8\u5F53\u4E8E\u521B\u5EFA\u4E86\u4E00\u6761\u7528\u6237\u6570\u636E</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span><span class="token function">NewRecord</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment">//\u5224\u65AD\u4E3B\u952E\u662F\u5426\u4E3A\u7A7A true</span>
db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>u<span class="token punctuation">)</span>                      <span class="token comment">//\u5C06\u4E0A\u8FB9\u5B9A\u4E49\u7684\u7528\u6237\u6570\u636E\u5199\u5165\u5230\u6570\u636E\u5E93user\u8868\u4E2D</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span><span class="token function">NewRecord</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment">//\u5224\u65AD\u4E3B\u952E\u662F\u5426\u4E3A\u7A7A false</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-\u9ED8\u8BA4\u503C" tabindex="-1"><a class="header-anchor" href="#_2-\u9ED8\u8BA4\u503C" aria-hidden="true">#</a> 2\uFF0C\u9ED8\u8BA4\u503C</h3><p>\u53EF\u4EE5\u901A\u8FC7 tag \u5B9A\u4E49\u5B57\u6BB5\u7684\u9ED8\u8BA4\u503C\uFF0C\u6BD4\u5982\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID   <span class="token builtin">int64</span>
	Name sql<span class="token punctuation">.</span>NullString <span class="token string">\`gorm:&quot;default:&#39;eryajf&#39;&quot;\`</span>
	Age  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>**\u6CE8\u610F\uFF1A**\u901A\u8FC7tag\u5B9A\u4E49\u5B57\u6BB5\u7684\u9ED8\u8BA4\u503C\uFF0C\u5728\u521B\u5EFA\u8BB0\u5F55\u65F6\u5019\u751F\u6210\u7684 SQL \u8BED\u53E5\u4F1A\u6392\u9664\u6CA1\u6709\u503C\u6216\u503C\u4E3A \u96F6\u503C \u7684\u5B57\u6BB5\u3002 \u5728\u5C06\u8BB0\u5F55\u63D2\u5165\u5230\u6570\u636E\u5E93\u540E\uFF0CGorm\u4F1A\u4ECE\u6570\u636E\u5E93\u52A0\u8F7D\u90A3\u4E9B\u5B57\u6BB5\u7684\u9ED8\u8BA4\u503C\u3002</p><p>\u4E3E\u4E2A\u4F8B\u5B50\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">var</span> user <span class="token operator">=</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">99</span><span class="token punctuation">}</span>
db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u4E0A\u9762\u4EE3\u7801\u5B9E\u9645\u6267\u884C\u7684SQL\u8BED\u53E5\u662F<code>INSERT INTO users(&quot;age&quot;) values(&#39;99&#39;);</code>\uFF0C\u6392\u9664\u4E86\u96F6\u503C\u5B57\u6BB5<code>Name</code>\uFF0C\u800C\u5728\u6570\u636E\u5E93\u4E2D\u8FD9\u4E00\u6761\u6570\u636E\u4F1A\u4F7F\u7528\u8BBE\u7F6E\u7684\u9ED8\u8BA4\u503C<code>eryajf</code>\u4F5C\u4E3AName\u5B57\u6BB5\u7684\u503C\u3002</p><blockquote><p>**\u6CE8\u610F\uFF1A**\u6240\u6709\u5B57\u6BB5\u7684\u96F6\u503C, \u6BD4\u5982<code>0</code>, <code>&quot;&quot;</code>,<code>false</code>\u6216\u8005\u5176\u5B83<code>\u96F6\u503C</code>\uFF0C\u90FD\u4E0D\u4F1A\u4FDD\u5B58\u5230\u6570\u636E\u5E93\u5185\uFF0C\u4F46\u4F1A\u4F7F\u7528\u4ED6\u4EEC\u7684\u9ED8\u8BA4\u503C\u3002 \u5982\u679C\u4F60\u60F3\u907F\u514D\u8FD9\u79CD\u60C5\u51B5\uFF0C\u53EF\u4EE5\u8003\u8651\u4F7F\u7528\u6307\u9488\u6216\u5B9E\u73B0 <code>Scanner/Valuer</code>\u63A5\u53E3</p></blockquote><h4 id="_1-\u4F7F\u7528\u6307\u9488\u65B9\u5F0F\u5B9E\u73B0\u96F6\u503C\u5B58\u5165\u6570\u636E\u5E93" tabindex="-1"><a class="header-anchor" href="#_1-\u4F7F\u7528\u6307\u9488\u65B9\u5F0F\u5B9E\u73B0\u96F6\u503C\u5B58\u5165\u6570\u636E\u5E93" aria-hidden="true">#</a> 1\uFF0C\u4F7F\u7528\u6307\u9488\u65B9\u5F0F\u5B9E\u73B0\u96F6\u503C\u5B58\u5165\u6570\u636E\u5E93</h4><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// \u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID   <span class="token builtin">int64</span>
	Name <span class="token operator">*</span><span class="token builtin">string</span> <span class="token string">\`gorm:&quot;default:&#39;eryajf&#39;&quot;\`</span>
	Age  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

	<span class="token comment">// 2, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	u4 <span class="token operator">:=</span> User<span class="token punctuation">{</span>Age<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span> Name<span class="token punctuation">:</span> <span class="token function">new</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span><span class="token function">NewRecord</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>u4<span class="token punctuation">)</span><span class="token punctuation">)</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>u4<span class="token punctuation">)</span> <span class="token comment">// INSERT INTO \`user\` (\`name\`,\`age\`) VALUES (&#39;&#39;,24)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span><span class="token function">NewRecord</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>u4<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="_2-\u4F7F\u7528scanner-valuer\u63A5\u53E3\u65B9\u5F0F\u5B9E\u73B0\u96F6\u503C\u5B58\u5165\u6570\u636E\u5E93" tabindex="-1"><a class="header-anchor" href="#_2-\u4F7F\u7528scanner-valuer\u63A5\u53E3\u65B9\u5F0F\u5B9E\u73B0\u96F6\u503C\u5B58\u5165\u6570\u636E\u5E93" aria-hidden="true">#</a> 2\uFF0C\u4F7F\u7528Scanner/Valuer\u63A5\u53E3\u65B9\u5F0F\u5B9E\u73B0\u96F6\u503C\u5B58\u5165\u6570\u636E\u5E93</h4><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;database/sql&quot;</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// \u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID   <span class="token builtin">int64</span>
	Name sql<span class="token punctuation">.</span>NullString <span class="token string">\`gorm:&quot;default:&#39;eryajf&#39;&quot;\`</span>
	Age  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

	<span class="token comment">// 2, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	u4 <span class="token operator">:=</span> User<span class="token punctuation">{</span>Age<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span> Name<span class="token punctuation">:</span> sql<span class="token punctuation">.</span>NullString<span class="token punctuation">{</span>String<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> Valid<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span><span class="token function">NewRecord</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>u4<span class="token punctuation">)</span><span class="token punctuation">)</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>u4<span class="token punctuation">)</span> <span class="token comment">// INSERT INTO \`user\` (\`name\`,\`age\`) VALUES (&#39;&#39;,24)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span><span class="token function">NewRecord</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>u4<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="_3-\u6269\u5C55\u521B\u5EFA\u9009\u9879" tabindex="-1"><a class="header-anchor" href="#_3-\u6269\u5C55\u521B\u5EFA\u9009\u9879" aria-hidden="true">#</a> 3\uFF0C\u6269\u5C55\u521B\u5EFA\u9009\u9879</h3><p>\u4F8B\u5982<code>PostgreSQL</code>\u6570\u636E\u5E93\u4E2D\u53EF\u4EE5\u4F7F\u7528\u4E0B\u9762\u7684\u65B9\u5F0F\u5B9E\u73B0\u5408\u5E76\u63D2\u5165, \u6709\u5219\u66F4\u65B0, \u65E0\u5219\u63D2\u5165\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// \u4E3AInstert\u8BED\u53E5\u6DFB\u52A0\u6269\u5C55SQL\u9009\u9879</span>
db<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;gorm:insert_option&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ON CONFLICT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>product<span class="token punctuation">)</span>
<span class="token comment">// INSERT INTO products (name, code) VALUES (&quot;name&quot;, &quot;code&quot;) ON CONFLICT;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_8-\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_8-\u67E5\u8BE2" aria-hidden="true">#</a> 8\uFF0C\u67E5\u8BE2</h2><h3 id="_1-\u666E\u901A\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_1-\u666E\u901A\u67E5\u8BE2" aria-hidden="true">#</a> 1\uFF0C\u666E\u901A\u67E5\u8BE2</h3><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// \u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token comment">// 2, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 3, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 4,\u67E5\u8BE2</span>
	<span class="token keyword">var</span> user <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">// SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6839\u636E\u4E3B\u952E\u67E5\u8BE2\u7B2C\u4E00\u6761\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u968F\u673A\u83B7\u53D6\u4E00\u6761\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Last</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL ORDER BY \`user\`.\`id\` DESC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6839\u636E\u4E3B\u952E\u67E5\u8BE2\u6700\u540E\u4E00\u6761\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u6240\u6709\u7684\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>      <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`id\` = 2)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u6307\u5B9A\u7684\u67D0\u6761\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token comment">//\u4EC5\u5F53\u4E3B\u952E\u4E3A\u6574\u578B\u65F6\u53EF\u7528</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><h3 id="_2-where-\u6761\u4EF6" tabindex="-1"><a class="header-anchor" href="#_2-where-\u6761\u4EF6" aria-hidden="true">#</a> 2\uFF0CWhere \u6761\u4EF6</h3><h4 id="_2-\u666E\u901Asql\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_2-\u666E\u901Asql\u67E5\u8BE2" aria-hidden="true">#</a> 2\uFF0C\u666E\u901ASQL\u67E5\u8BE2</h4><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// \u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token comment">// 2, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 3, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 4,\u67E5\u8BE2	// Where</span>
	<span class="token keyword">var</span> user <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((name = &#39;jinzhu&#39;)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u7B2C\u4E00\u6761\u5339\u914D\u6761\u4EF6\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((name = &#39;jinzhu&#39;))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u6240\u6709\u5339\u914D\u6761\u4EF6\u7684\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name &lt;&gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((name &lt;&gt; &#39;jinzhu&#39;))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2name\u4E0D\u7B49\u4E8Ejinzhu\u7684\u6240\u6709\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name IN (?)&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu 2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((name IN (&#39;jinzhu&#39;,&#39;jinzhu 2&#39;)))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2name\u5728jinzhu\u548Cjinzhu 2\u7684\u6240\u6709\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name LIKE ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;%jin%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((name LIKE &#39;%jin%&#39;))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2name\u5305\u542Bjin\u7684\u6240\u6709\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ? AND age &gt;= ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;20&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((name = &#39;jinzhu&#39; AND age &gt;= &#39;20&#39;))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u4E24\u4E2A\u6761\u4EF6\u90FD\u7B26\u5408\u7684\u6240\u6709\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	oneDay<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">ParseDuration</span><span class="token punctuation">(</span><span class="token string">&quot;-24h&quot;</span><span class="token punctuation">)</span>
	lastWeek <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>oneDay <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">)</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;updated_at &gt; ?&quot;</span><span class="token punctuation">,</span> lastWeek<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((updated_at &gt; &#39;2020-03-01 19:45:11&#39;))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u4E00\u5468\u5185\u66F4\u65B0\u7684\u7528\u6237\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	today <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;created_at BETWEEN ? AND ?&quot;</span><span class="token punctuation">,</span> lastWeek<span class="token punctuation">,</span> today<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((created_at BETWEEN &#39;2020-03-01 19:52:51&#39; AND &#39;2020-03-08 19:52:51&#39;))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u4E00\u5468\u5185\u521B\u5EFA\u7684\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><h4 id="_2-struct-map\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_2-struct-map\u67E5\u8BE2" aria-hidden="true">#</a> 2\uFF0CStruct &amp; Map\u67E5\u8BE2</h4><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// \u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token comment">// 2, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 3, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 4,\u67E5\u8BE2</span>
	<span class="token keyword">var</span> user <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">22</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`name\` = &#39;jinzhu&#39;) AND (\`user\`.\`age\` = 22)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u901A\u8FC7\u7ED3\u6784\u4F53\u67E5\u8BE2\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">22</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`name\` = &#39;jinzhu&#39;) AND (\`user\`.\`age\` = 22))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u901A\u8FC7map\u67E5\u8BE2\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int64</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`id\` IN (1,2)))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u901A\u8FC7\u4E3B\u952E\u7684\u5207\u7247\u67E5\u8BE2\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>**\u63D0\u793A\uFF1A**\u5F53\u901A\u8FC7\u7ED3\u6784\u4F53\u8FDB\u884C\u67E5\u8BE2\u65F6\uFF0CGORM\u5C06\u4F1A\u53EA\u901A\u8FC7\u975E\u96F6\u503C\u5B57\u6BB5\u67E5\u8BE2\uFF0C\u8FD9\u610F\u5473\u7740\u5982\u679C\u4F60\u7684\u5B57\u6BB5\u503C\u4E3A<code>0</code>\uFF0C<code>&#39;&#39;</code>\uFF0C<code>false</code>\u6216\u8005\u5176\u4ED6<code>\u96F6\u503C</code>\u65F6\uFF0C\u5C06\u4E0D\u4F1A\u88AB\u7528\u4E8E\u6784\u5EFA\u67E5\u8BE2\u6761\u4EF6\uFF0C\u4F8B\u5982\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>  <span class="token comment">// SELECT * FROM users WHERE name = &quot;jinzhu&quot;;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u6B64\u65F6\uFF0C\u5C31\u50CF\u521B\u5EFA\u4E00\u6837\uFF0C\u4F60\u53EF\u4EE5\u4F7F\u7528\u6307\u9488\u6216\u5B9E\u73B0 Scanner/Valuer \u63A5\u53E3\u6765\u907F\u514D\u8FD9\u4E2A\u95EE\u9898.</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// \u4F7F\u7528\u6307\u9488</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Name <span class="token builtin">string</span>
  Age  <span class="token operator">*</span><span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u4F7F\u7528 Scanner/Valuer</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Name <span class="token builtin">string</span>
  Age  sql<span class="token punctuation">.</span>NullInt64  <span class="token comment">// sql.NullInt64 \u5B9E\u73B0\u4E86 Scanner/Valuer \u63A5\u53E3</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_3-not-\u6761\u4EF6" tabindex="-1"><a class="header-anchor" href="#_3-not-\u6761\u4EF6" aria-hidden="true">#</a> 3\uFF0CNot \u6761\u4EF6</h3><p>\u4F5C\u7528\u4E0E Where \u7C7B\u4F3C\u7684\u60C5\u5F62\u5982\u4E0B\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// \u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token comment">// 2, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 3, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 4,\u67E5\u8BE2</span>
	<span class="token keyword">var</span> user <span class="token punctuation">[</span><span class="token punctuation">]</span>User

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Not</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`name\` NOT IN (&#39;jinzhu&#39;))) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2name\u4E0D\u662Fjinzhu\u7684\u7B2C\u4E00\u6761\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Not</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu 2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`name\` NOT IN (&#39;jinzhu&#39;,&#39;jinzhu 2&#39;)))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2name\u4E0D\u5728jinzhu\u6216jinzhu2\u7684\u6240\u6709\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Not</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int64</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`id\` NOT IN (1,2,3)))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u4E3B\u952E\u4E0D\u662F1\uFF0C2\uFF0C3\u7684\u6240\u6709\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Not</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int64</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u6240\u6709\u7528\u6237\u4E2D\u7684\u7B2C\u4E00\u4E2A\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Not</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND (NOT (name = &#39;jinzhu&#39;)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2name\u4E0D\u662Fjinzhu\u7684\u7B2C\u4E00\u4E2A\u7528\u6237\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Not</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`name\` &lt;&gt; &#39;jinzhu&#39;)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u901A\u8FC7\u7ED3\u6784\u4F53\u67E5\u8BE2name\u4E0D\u662Fjinzhu\u7684\u7B2C\u4E00\u4E2A\u7528\u6237\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h3 id="_4-or\u6761\u4EF6" tabindex="-1"><a class="header-anchor" href="#_4-or\u6761\u4EF6" aria-hidden="true">#</a> 4\uFF0COr\u6761\u4EF6</h3><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// \u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token comment">// 2, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 3, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 4,\u67E5\u8BE2</span>
	<span class="token keyword">var</span> user <span class="token punctuation">[</span><span class="token punctuation">]</span>User

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age &gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Or</span><span class="token punctuation">(</span><span class="token string">&quot;age &lt; ?&quot;</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((age &gt; 25) OR (age &lt; 23))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u5E74\u9F84\u5C0F\u4E8E23\u7684\u6216\u8005\u5927\u4E8E25\u7684\u6240\u6709\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	<span class="token comment">// struct</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = &#39;jinzhu&#39;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Or</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;jinzhu 2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((name = &#39;jinzhu&#39;) OR (\`user\`.\`name\` = &#39;jinzhu 2&#39;))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u7ED3\u6784\u4F53\uFF1A\u67E5\u8BE2\u540D\u5B57\u662Fjinzhu\u7684\u6216\u8005\u662Fjinzhu 2\u7684\u6240\u6709\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	<span class="token comment">// map</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = &#39;jinzhu&#39;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Or</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;jinzhu 2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((name = &#39;jinzhu&#39;) OR (\`user\`.\`name\` = &#39;jinzhu 2&#39;))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;map\uFF1A\u67E5\u8BE2\u540D\u5B57\u662Fjinzhu\u7684\u6216\u8005\u662Fjinzhu 2\u7684\u6240\u6709\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h3 id="_5-\u5185\u8054\u6761\u4EF6" tabindex="-1"><a class="header-anchor" href="#_5-\u5185\u8054\u6761\u4EF6" aria-hidden="true">#</a> 5\uFF0C\u5185\u8054\u6761\u4EF6</h3>`,113),h=s("\u4F5C\u7528\u4E0E"),y=n("code",null,"Where",-1),E=s("\u67E5\u8BE2\u7C7B\u4F3C\uFF0C\u5F53\u5185\u8054\u6761\u4EF6\u4E0E\u591A\u4E2A"),_={href:"https://www.liwenzhou.com/posts/Go/gorm_crud/#autoid-1-3-1",target:"_blank",rel:"noopener noreferrer"},v=s("\u7ACB\u5373\u6267\u884C\u65B9\u6CD5"),A=s("\u4E00\u8D77\u4F7F\u7528\u65F6, \u5185\u8054\u6761\u4EF6\u4E0D\u4F1A\u4F20\u9012\u7ED9\u540E\u9762\u7684\u7ACB\u5373\u6267\u884C\u65B9\u6CD5\u3002"),N=t(`<div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// \u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token comment">// 2, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 3, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 4,\u67E5\u8BE2</span>
	<span class="token keyword">var</span> user <span class="token punctuation">[</span><span class="token punctuation">]</span>User

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>          <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`id\` = 3)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6839\u636E\u4E3B\u952E\u67E5\u8BE2\u6307\u5B9A\u7684\u67D0\u6761\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token comment">//\u4EC5\u5F53\u4E3B\u952E\u4E3A\u6574\u578B\u65F6\u53EF\u7528</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;string_primary_key&quot;</span><span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((id = &#39;string_primary_key&#39;)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6839\u636E\u4E3B\u952E\u662F\u975E\u6574\u5F62\u4E3B\u952E\u83B7\u53D6\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((name = &#39;jinzhu&#39;))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2name\u4E3Ajinzhu\u7684\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token string">&quot;name &lt;&gt; ? AND age &gt; ? &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;20&quot;</span><span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((name &lt;&gt; &#39;jinzhu&#39; AND age &gt; &#39;20&#39; ))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2name\u4E0D\u662Fjinzhu\u4E14\u5E74\u9F84\u5927\u4E8E20\u7684\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> User<span class="token punctuation">{</span>Age<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`age\` = 20))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u901A\u8FC7\u7ED3\u6784\u4F53\u67E5\u8BE2\u5E74\u9F84\u662F20\u7684\u6240\u6709\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`age\` = 20))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u901A\u8FC7map\u67E5\u8BE2\u5E74\u9F84\u662F20\u7684\u6240\u6709\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h3 id="_6-\u989D\u5916\u67E5\u8BE2\u9009\u9879" tabindex="-1"><a class="header-anchor" href="#_6-\u989D\u5916\u67E5\u8BE2\u9009\u9879" aria-hidden="true">#</a> 6\uFF0C\u989D\u5916\u67E5\u8BE2\u9009\u9879</h3><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// \u4E3A\u67E5\u8BE2 SQL \u6DFB\u52A0\u989D\u5916\u7684 SQL \u64CD\u4F5C</span>
db<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;gorm:query_option&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;FOR UPDATE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment">//// SELECT * FROM users WHERE id = 10 FOR UPDATE;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_7-firstorinit" tabindex="-1"><a class="header-anchor" href="#_7-firstorinit" aria-hidden="true">#</a> 7\uFF0CFirstOrInit</h3><p>\u83B7\u53D6\u5339\u914D\u7684\u7B2C\u4E00\u6761\u8BB0\u5F55\uFF0C\u5426\u5219\u6839\u636E\u7ED9\u5B9A\u7684\u6761\u4EF6\u521D\u59CB\u5316\u4E00\u4E2A\u65B0\u7684\u5BF9\u8C61 (\u4EC5\u652F\u6301 struct \u548C map \u6761\u4EF6)</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// \u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token comment">// 2, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 3, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 4,\u67E5\u8BE2</span>
	<span class="token keyword">var</span> user <span class="token punctuation">[</span><span class="token punctuation">]</span>User

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;non_existing&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`name\` = &#39;non_existing&#39;)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2name\u4E3Anon_existing\u7684\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`name\` = &#39;jinzhu&#39;)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u901A\u8FC7\u7ED3\u6784\u4F53\u67E5\u8BE2name\u4E3Ajinzhu\u7684\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`name\` = &#39;jinzhu&#39;)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u901A\u8FC7map\u67E5\u8BE2name\u4E3Ajinzhu\u7684\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h4 id="_1-attrs" tabindex="-1"><a class="header-anchor" href="#_1-attrs" aria-hidden="true">#</a> 1\uFF0CAttrs</h4><p>\u5982\u679C\u8BB0\u5F55\u672A\u627E\u5230\uFF0C\u5C06\u4F7F\u7528\u53C2\u6570\u521D\u59CB\u5316 struct.</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// \u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token comment">// 2, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 3, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 4,\u67E5\u8BE2</span>
	<span class="token keyword">var</span> user <span class="token punctuation">[</span><span class="token punctuation">]</span>User

	<span class="token comment">// \u672A\u627E\u5230</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;non_existing&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Attrs</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Age<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`name\` = &#39;non_existing&#39;)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;non_existing&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Attrs</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`name\` = &#39;non_existing&#39;)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

	<span class="token comment">// \u627E\u5230</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Attrs</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Age<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`name\` = &#39;jinzhu&#39;)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h4 id="_2-assign" tabindex="-1"><a class="header-anchor" href="#_2-assign" aria-hidden="true">#</a> 2\uFF0CAssign</h4><p>\u4E0D\u7BA1\u8BB0\u5F55\u662F\u5426\u627E\u5230\uFF0C\u90FD\u5C06\u53C2\u6570\u8D4B\u503C\u7ED9 struct.</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// \u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token comment">// 2, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 3, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 4,\u67E5\u8BE2</span>
	<span class="token keyword">var</span> user <span class="token punctuation">[</span><span class="token punctuation">]</span>User

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;non_existing&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Assign</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Age<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`name\` = &#39;non_existing&#39;)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

	<span class="token comment">// \u627E\u5230</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Assign</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Age<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`name\` = &#39;jinzhu&#39;)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="_8-firstorcreate" tabindex="-1"><a class="header-anchor" href="#_8-firstorcreate" aria-hidden="true">#</a> 8\uFF0CFirstOrCreate</h3><p>\u83B7\u53D6\u5339\u914D\u7684\u7B2C\u4E00\u6761\u8BB0\u5F55, \u5426\u5219\u6839\u636E\u7ED9\u5B9A\u7684\u6761\u4EF6\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684\u8BB0\u5F55 (\u4EC5\u652F\u6301 struct \u548C map \u6761\u4EF6)</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// \u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token comment">// 2, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 3, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 4,\u67E5\u8BE2</span>
	<span class="token keyword">var</span> user <span class="token punctuation">[</span><span class="token punctuation">]</span>User

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrCreate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;non_existing&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`name\` = &#39;non_existing&#39;)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrCreate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`name\` = &#39;jinzhu&#39;)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h4 id="_1-attrs-1" tabindex="-1"><a class="header-anchor" href="#_1-attrs-1" aria-hidden="true">#</a> 1\uFF0CAttrs</h4><p>\u5982\u679C\u8BB0\u5F55\u672A\u627E\u5230\uFF0C\u5C06\u4F7F\u7528\u53C2\u6570\u521B\u5EFA struct \u548C\u8BB0\u5F55.</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// \u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token comment">// 2, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 3, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 4,\u67E5\u8BE2</span>
	<span class="token keyword">var</span> user <span class="token punctuation">[</span><span class="token punctuation">]</span>User

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;non_existing&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Attrs</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Age<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrCreate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`name\` = &#39;non_existing&#39;)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Attrs</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Age<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrCreate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((\`user\`.\`name\` = &#39;jinzhu&#39;)) ORDER BY \`user\`.\`id\` ASC LIMIT 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h4 id="_2-assign-1" tabindex="-1"><a class="header-anchor" href="#_2-assign-1" aria-hidden="true">#</a> 2\uFF0CAssign</h4><p>\u4E0D\u7BA1\u8BB0\u5F55\u662F\u5426\u627E\u5230\uFF0C\u90FD\u5C06\u53C2\u6570\u8D4B\u503C\u7ED9 struct \u5E76\u4FDD\u5B58\u81F3\u6570\u636E\u5E93.</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// \u672A\u627E\u5230</span>
db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;non_existing&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Assign</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Age<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrCreate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
<span class="token comment">//// SELECT * FROM users WHERE name = &#39;non_existing&#39;;</span>
<span class="token comment">//// INSERT INTO &quot;users&quot; (name, age) VALUES (&quot;non_existing&quot;, 20);</span>
<span class="token comment">//// user -&gt; User{Id: 112, Name: &quot;non_existing&quot;, Age: 20}</span>

<span class="token comment">// \u627E\u5230</span>
db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Assign</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Age<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrCreate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
<span class="token comment">//// SELECT * FROM users WHERE name = &#39;jinzhu&#39;;</span>
<span class="token comment">//// UPDATE users SET age=30 WHERE id = 111;</span>
<span class="token comment">//// user -&gt; User{Id: 111, Name: &quot;jinzhu&quot;, Age: 30}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_9-\u9AD8\u7EA7\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_9-\u9AD8\u7EA7\u67E5\u8BE2" aria-hidden="true">#</a> 9\uFF0C\u9AD8\u7EA7\u67E5\u8BE2</h3><h4 id="_1-\u5B50\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_1-\u5B50\u67E5\u8BE2" aria-hidden="true">#</a> 1\uFF0C\u5B50\u67E5\u8BE2</h4><p>\u57FA\u4E8E <code>*gorm.expr</code> \u7684\u5B50\u67E5\u8BE2</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;amount &gt; ?&quot;</span><span class="token punctuation">,</span> DB<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;orders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;AVG(amount)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;state = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;paid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">QueryExpr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>orders<span class="token punctuation">)</span>
<span class="token comment">// SELECT * FROM &quot;orders&quot;  WHERE &quot;orders&quot;.&quot;deleted_at&quot; IS NULL AND (amount &gt; (SELECT AVG(amount) FROM &quot;orders&quot;  WHERE (state = &#39;paid&#39;)));</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_2-\u9009\u62E9\u5B57\u6BB5" tabindex="-1"><a class="header-anchor" href="#_2-\u9009\u62E9\u5B57\u6BB5" aria-hidden="true">#</a> 2\uFF0C\u9009\u62E9\u5B57\u6BB5</h4><p>Select\uFF0C\u6307\u5B9A\u4F60\u60F3\u4ECE\u6570\u636E\u5E93\u4E2D\u68C0\u7D22\u51FA\u7684\u5B57\u6BB5\uFF0C\u9ED8\u8BA4\u4F1A\u9009\u62E9\u5168\u90E8\u5B57\u6BB5\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// \u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token comment">// 2, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 3, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 4,\u67E5\u8BE2</span>
	<span class="token keyword">var</span> user <span class="token punctuation">[</span><span class="token punctuation">]</span>User

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT name FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL&#39;age&#39;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u8868\u4E2Dname\u5B57\u6BB5\u53C2\u6570\u4E3Aage\u7684\u8BB0\u5F55\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT name, age FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5217\u51FA\u8868\u4E2Dname\u4E0Eage\u5B57\u6BB5\uFF1A&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h4 id="_3-\u6392\u5E8F" tabindex="-1"><a class="header-anchor" href="#_3-\u6392\u5E8F" aria-hidden="true">#</a> 3\uFF0C\u6392\u5E8F</h4><p>Order\uFF0C\u6307\u5B9A\u4ECE\u6570\u636E\u5E93\u4E2D\u68C0\u7D22\u51FA\u8BB0\u5F55\u7684\u987A\u5E8F\u3002\u8BBE\u7F6E\u7B2C\u4E8C\u4E2A\u53C2\u6570 reorder \u4E3A <code>true</code> \uFF0C\u53EF\u4EE5\u8986\u76D6\u524D\u9762\u5B9A\u4E49\u7684\u6392\u5E8F\u6761\u4EF6\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Order</span><span class="token punctuation">(</span><span class="token string">&quot;age desc, name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">//// SELECT * FROM users ORDER BY age desc, name;</span>

<span class="token comment">// \u591A\u5B57\u6BB5\u6392\u5E8F</span>
db<span class="token punctuation">.</span><span class="token function">Order</span><span class="token punctuation">(</span><span class="token string">&quot;age desc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Order</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">//// SELECT * FROM users ORDER BY age desc, name;</span>

<span class="token comment">// \u8986\u76D6\u6392\u5E8F</span>
db<span class="token punctuation">.</span><span class="token function">Order</span><span class="token punctuation">(</span><span class="token string">&quot;age desc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Order</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users2<span class="token punctuation">)</span>
<span class="token comment">//// SELECT * FROM users ORDER BY age desc; (users1)</span>
<span class="token comment">//// SELECT * FROM users ORDER BY age; (users2)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_4-\u6570\u91CF" tabindex="-1"><a class="header-anchor" href="#_4-\u6570\u91CF" aria-hidden="true">#</a> 4\uFF0C\u6570\u91CF</h4><p>Limit\uFF0C\u6307\u5B9A\u4ECE\u6570\u636E\u5E93\u68C0\u7D22\u51FA\u7684\u6700\u5927\u8BB0\u5F55\u6570\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Limit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">//// SELECT * FROM users LIMIT 3;</span>

<span class="token comment">// -1 \u53D6\u6D88 Limit \u6761\u4EF6</span>
db<span class="token punctuation">.</span><span class="token function">Limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Limit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users2<span class="token punctuation">)</span>
<span class="token comment">//// SELECT * FROM users LIMIT 10; (users1)</span>
<span class="token comment">//// SELECT * FROM users; (users2)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_5-\u504F\u79FB" tabindex="-1"><a class="header-anchor" href="#_5-\u504F\u79FB" aria-hidden="true">#</a> 5\uFF0C\u504F\u79FB</h4><p>Offset\uFF0C\u6307\u5B9A\u5F00\u59CB\u8FD4\u56DE\u8BB0\u5F55\u524D\u8981\u8DF3\u8FC7\u7684\u8BB0\u5F55\u6570\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Offset</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">//// SELECT * FROM users OFFSET 3;</span>

<span class="token comment">// -1 \u53D6\u6D88 Offset \u6761\u4EF6</span>
db<span class="token punctuation">.</span><span class="token function">Offset</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Offset</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users2<span class="token punctuation">)</span>
<span class="token comment">//// SELECT * FROM users OFFSET 10; (users1)</span>
<span class="token comment">//// SELECT * FROM users; (users2)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_6-\u603B\u6570" tabindex="-1"><a class="header-anchor" href="#_6-\u603B\u6570" aria-hidden="true">#</a> 6\uFF0C\u603B\u6570</h4><p>Count\uFF0C\u8BE5 model \u80FD\u83B7\u53D6\u7684\u8BB0\u5F55\u603B\u6570\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Or</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>count<span class="token punctuation">)</span>
<span class="token comment">//// SELECT * from USERS WHERE name = &#39;jinzhu&#39; OR name = &#39;jinzhu 2&#39;; (users)</span>
<span class="token comment">//// SELECT count(*) FROM users WHERE name = &#39;jinzhu&#39; OR name = &#39;jinzhu 2&#39;; (count)</span>

db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>count<span class="token punctuation">)</span>
<span class="token comment">//// SELECT count(*) FROM users WHERE name = &#39;jinzhu&#39;; (count)</span>

db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;deleted_users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>count<span class="token punctuation">)</span>
<span class="token comment">//// SELECT count(*) FROM deleted_users;</span>

db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;deleted_users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;count(distinct(name))&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>count<span class="token punctuation">)</span>
<span class="token comment">//// SELECT count( distinct(name) ) FROM deleted_users; (count)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>\u6CE8\u610F</strong> <code>Count</code> \u5FC5\u987B\u662F\u94FE\u5F0F\u67E5\u8BE2\u7684\u6700\u540E\u4E00\u4E2A\u64CD\u4F5C \uFF0C\u56E0\u4E3A\u5B83\u4F1A\u8986\u76D6\u524D\u9762\u7684 <code>SELECT</code>\uFF0C\u4F46\u5982\u679C\u91CC\u9762\u4F7F\u7528\u4E86 <code>count</code> \u65F6\u4E0D\u4F1A\u8986\u76D6</p><h4 id="_7-group-having" tabindex="-1"><a class="header-anchor" href="#_7-group-having" aria-hidden="true">#</a> 7\uFF0CGroup &amp; Having</h4><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>rows<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;orders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;date(created_at) as date, sum(amount) as total&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;date(created_at)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Rows</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> rows<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u4F7F\u7528Scan\u5C06\u591A\u6761\u7ED3\u679C\u626B\u63CF\u8FDB\u4E8B\u5148\u51C6\u5907\u597D\u7684\u7ED3\u6784\u4F53\u5207\u7247\u4E2D</span>
<span class="token keyword">type</span> Result <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Date time<span class="token punctuation">.</span>Time
	Total <span class="token builtin">int</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> rets <span class="token punctuation">[</span><span class="token punctuation">]</span>Result
db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;date(created_at) as date, sum(age) as total&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;date(created_at)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rets<span class="token punctuation">)</span>

rows<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;orders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;date(created_at) as date, sum(amount) as total&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;date(created_at)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Having</span><span class="token punctuation">(</span><span class="token string">&quot;sum(amount) &gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Rows</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> rows<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Result <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Date  time<span class="token punctuation">.</span>Time
  Total <span class="token builtin">int64</span>
<span class="token punctuation">}</span>
db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;orders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;date(created_at) as date, sum(amount) as total&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;date(created_at)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Having</span><span class="token punctuation">(</span><span class="token string">&quot;sum(amount) &gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="_8-\u8FDE\u63A5" tabindex="-1"><a class="header-anchor" href="#_8-\u8FDE\u63A5" aria-hidden="true">#</a> 8\uFF0C\u8FDE\u63A5</h4><p>Joins\uFF0C\u6307\u5B9A\u8FDE\u63A5\u6761\u4EF6</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>rows<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;users.name, emails.email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Joins</span><span class="token punctuation">(</span><span class="token string">&quot;left join emails on emails.user_id = users.id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Rows</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> rows<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;users.name, emails.email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Joins</span><span class="token punctuation">(</span><span class="token string">&quot;left join emails on emails.user_id = users.id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results<span class="token punctuation">)</span>

<span class="token comment">// \u591A\u8FDE\u63A5\u53CA\u53C2\u6570</span>
db<span class="token punctuation">.</span><span class="token function">Joins</span><span class="token punctuation">(</span><span class="token string">&quot;JOIN emails ON emails.user_id = users.id AND emails.email = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu@example.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Joins</span><span class="token punctuation">(</span><span class="token string">&quot;JOIN credit_cards ON credit_cards.user_id = users.id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;credit_cards.number = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;411111111111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_9-pluck" tabindex="-1"><a class="header-anchor" href="#_9-pluck" aria-hidden="true">#</a> 9\uFF0CPluck</h4>`,47),w=s("Pluck\uFF0C\u67E5\u8BE2 model \u4E2D\u7684\u4E00\u4E2A\u5217\u4F5C\u4E3A\u5207\u7247\uFF0C\u5982\u679C\u60A8\u60F3\u8981\u67E5\u8BE2\u591A\u4E2A\u5217\uFF0C\u60A8\u5E94\u8BE5\u4F7F\u7528 "),S={href:"https://www.liwenzhou.com/posts/Go/gorm_crud/#Scan",target:"_blank",rel:"noopener noreferrer"},T=n("code",null,"Scan",-1),U=t(`<div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">var</span> ages <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int64</span>
db<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Pluck</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ages<span class="token punctuation">)</span>

<span class="token keyword">var</span> names <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Pluck</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>names<span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;deleted_users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Pluck</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>names<span class="token punctuation">)</span>

<span class="token comment">// \u60F3\u67E5\u8BE2\u591A\u4E2A\u5B57\u6BB5\uFF1F \u8FD9\u6837\u505A\uFF1A</span>
db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;name, age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_10-\u626B\u63CF" tabindex="-1"><a class="header-anchor" href="#_10-\u626B\u63CF" aria-hidden="true">#</a> 10\uFF0C\u626B\u63CF</h4><p>Scan\uFF0C\u626B\u63CF\u7ED3\u679C\u81F3\u4E00\u4E2A struct.</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Result <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Name <span class="token builtin">string</span>
  Age  <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> result Result
db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;name, age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Antonio&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result<span class="token punctuation">)</span>

<span class="token keyword">var</span> results <span class="token punctuation">[</span><span class="token punctuation">]</span>Result
db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;name, age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id &gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results<span class="token punctuation">)</span>

<span class="token comment">// \u539F\u751F SQL</span>
db<span class="token punctuation">.</span><span class="token function">Raw</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT name, age FROM users WHERE name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Antonio&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="_9-\u66F4\u65B0" tabindex="-1"><a class="header-anchor" href="#_9-\u66F4\u65B0" aria-hidden="true">#</a> 9\uFF0C\u66F4\u65B0</h2><h3 id="_1-\u66F4\u65B0\u6240\u6709\u5B57\u6BB5" tabindex="-1"><a class="header-anchor" href="#_1-\u66F4\u65B0\u6240\u6709\u5B57\u6BB5" aria-hidden="true">#</a> 1\uFF0C\u66F4\u65B0\u6240\u6709\u5B57\u6BB5</h3><p><code>Save()</code>\u9ED8\u8BA4\u4F1A\u66F4\u65B0\u8BE5\u5BF9\u8C61\u7684\u6240\u6709\u5B57\u6BB5\uFF0C\u5373\u4F7F\u4F60\u6CA1\u6709\u8D4B\u503C\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// 1,\u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID     <span class="token builtin">int64</span>
	Name   <span class="token builtin">string</span>
	Age    <span class="token builtin">int64</span>
	Active <span class="token builtin">bool</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 2, \u8FDE\u63A5\u6570\u636E\u5E93</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

	<span class="token comment">// 3, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token comment">// 4, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20, Active: true}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22, Active: false}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 5, \u67E5\u8BE2</span>
	<span class="token keyword">var</span> user User
	db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

	<span class="token comment">// 6, \u66F4\u65B0</span>
	user<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;\u4E8C\u4E2B\u8BB2\u68B5&quot;</span>
	user<span class="token punctuation">.</span>Age <span class="token operator">=</span> <span class="token number">20</span>
	<span class="token comment">// save \u9ED8\u8BA4\u4F1A\u66F4\u65B0\u8BE5\u5BF9\u8C61\u7684\u6240\u6709\u5B57\u6BB5\uFF0C\u5373\u4F7F\u6CA1\u6709\u8D4B\u503C</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`name\` = &#39;\u4E8C\u4E2B\u8BB2\u68B5&#39;, \`age\` = 20, \`active\` = true  WHERE \`user\`.\`id\` = 1</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><h3 id="_2-\u66F4\u65B0\u4FEE\u6539\u5B57\u6BB5" tabindex="-1"><a class="header-anchor" href="#_2-\u66F4\u65B0\u4FEE\u6539\u5B57\u6BB5" aria-hidden="true">#</a> 2\uFF0C\u66F4\u65B0\u4FEE\u6539\u5B57\u6BB5</h3><p>\u5982\u679C\u4F60\u53EA\u5E0C\u671B\u66F4\u65B0\u6307\u5B9A\u5B57\u6BB5\uFF0C\u53EF\u4EE5\u4F7F\u7528<code>Update</code>\u6216\u8005<code>Updates</code></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// 1,\u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID     <span class="token builtin">int64</span>
	Name   <span class="token builtin">string</span>
	Age    <span class="token builtin">int64</span>
	Active <span class="token builtin">bool</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 2, \u8FDE\u63A5\u6570\u636E\u5E93</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

	<span class="token comment">// 3, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token comment">// 4, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20, Active: true}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22, Active: false}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 5, \u67E5\u8BE2</span>
	<span class="token keyword">var</span> user User
	db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

	<span class="token comment">// 6, \u66F4\u65B0</span>
	<span class="token comment">// \u66F4\u65B0\u5355\u4E2A\u5C5E\u6027\uFF0C\u5982\u679C\u4ED6\u6709\u53D8\u5316</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`name\` = &#39;hello&#39;  WHERE \`user\`.\`id\` = 1</span>

	<span class="token comment">// \u6839\u636E\u7ED9\u5B9A\u7684\u6761\u4EF6\u66F4\u65B0\u5355\u4E2A\u5C5E\u6027</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;active = ?&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`name\` = &#39;hello&#39;  WHERE \`user\`.\`id\` = 1 AND ((active = true))</span>

	<span class="token comment">// \u4F7F\u7528map \u66F4\u65B0\u591A\u4E2A\u5C5E\u6027\uFF0C\u53EA\u4F1A\u66F4\u65B0\u5176\u4E2D\u6709\u53D8\u5316\u7684\u5C5E\u6027</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">&quot;active&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`active\` = true, \`age\` = 18, \`name\` = &#39;hello&#39;  WHERE \`user\`.\`id\` = 1</span>

	<span class="token comment">// \u4F7F\u7528struct \u66F4\u65B0\u591A\u4E2A\u5C5E\u6027\uFF0C\u53EA\u4F1A\u66F4\u65B0\u5176\u4E2D\u6709\u53D8\u5316\u4E14\u4E3A\u975E\u96F6\u503C\u7684\u5B57\u6BB5</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">23</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`age\` = 23, \`name\` = &#39;hello&#39;  WHERE \`user\`.\`id\` = 1</span>

	<span class="token comment">// \u8B66\u544A\uFF1A\u5F53\u4F7F\u7528struct\u66F4\u65B0\u65F6\uFF0CGORM\u53EA\u4F1A\u66F4\u65B0\u90A3\u4E9B\u975E\u96F6\u503C\u7684\u5B57\u6BB5</span>
	<span class="token comment">// \u5BF9\u4E8E\u4E0B\u9762\u7684\u64CD\u4F5C\uFF0C\u4E0D\u4F1A\u53D1\u751F\u4EFB\u4F55\u66F4\u65B0</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> Active<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">//db.Debug().Model(&amp;user)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><h3 id="_3-\u66F4\u65B0\u9009\u5B9A\u5B57\u6BB5" tabindex="-1"><a class="header-anchor" href="#_3-\u66F4\u65B0\u9009\u5B9A\u5B57\u6BB5" aria-hidden="true">#</a> 3\uFF0C\u66F4\u65B0\u9009\u5B9A\u5B57\u6BB5</h3><p>\u5982\u679C\u4F60\u60F3\u66F4\u65B0\u6216\u5FFD\u7565\u67D0\u4E9B\u5B57\u6BB5\uFF0C\u4F60\u53EF\u4EE5\u4F7F\u7528 <code>Select</code>\uFF0C<code>Omit</code></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// 1,\u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID     <span class="token builtin">int64</span>
	Name   <span class="token builtin">string</span>
	Age    <span class="token builtin">int64</span>
	Active <span class="token builtin">bool</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 2, \u8FDE\u63A5\u6570\u636E\u5E93</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

	<span class="token comment">// 3, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token comment">// 4, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20, Active: true}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22, Active: false}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 5, \u67E5\u8BE2</span>
	<span class="token keyword">var</span> user User
	db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

	<span class="token comment">// 6, \u66F4\u65B0</span>
	m1 <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
		<span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span>   <span class="token string">&quot;liqilong&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span>    <span class="token number">20</span><span class="token punctuation">,</span>
		<span class="token string">&quot;active&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// \u9009\u62E9 m1 \u4E2D\u67D0\u4E2A\u5B57\u6BB5\u8FDB\u884C\u66F4\u65B0</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`name\` = &#39;liqilong&#39;  WHERE \`user\`.\`id\` = 1</span>

	<span class="token comment">// \u5FFD\u7565 m1 \u4E2Dactive\u5B57\u6BB5\u66F4\u65B0\u5176\u4ED6\u5B57\u6BB5</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Omit</span><span class="token punctuation">(</span><span class="token string">&quot;active&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`age\` = 20, \`name\` = &#39;liqilong&#39;  WHERE \`user\`.\`id\` = 1</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h3 id="_4-\u65E0hooks\u66F4\u65B0" tabindex="-1"><a class="header-anchor" href="#_4-\u65E0hooks\u66F4\u65B0" aria-hidden="true">#</a> 4\uFF0C\u65E0Hooks\u66F4\u65B0</h3><p>\u4E0A\u9762\u7684\u66F4\u65B0\u64CD\u4F5C\u4F1A\u81EA\u52A8\u8FD0\u884C model \u7684 <code>BeforeUpdate</code>, <code>AfterUpdate</code> \u65B9\u6CD5\uFF0C\u66F4\u65B0 <code>UpdatedAt</code> \u65F6\u95F4\u6233, \u5728\u66F4\u65B0\u65F6\u4FDD\u5B58\u5176 <code>Associations</code>, \u5982\u679C\u4F60\u4E0D\u60F3\u8C03\u7528\u8FD9\u4E9B\u65B9\u6CD5\uFF0C\u4F60\u53EF\u4EE5\u4F7F\u7528 <code>UpdateColumn</code>\uFF0C <code>UpdateColumns</code></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// 1,\u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID     <span class="token builtin">int64</span>
	Name   <span class="token builtin">string</span>
	Age    <span class="token builtin">int64</span>
	Active <span class="token builtin">bool</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 2, \u8FDE\u63A5\u6570\u636E\u5E93</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

	<span class="token comment">// 3, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token comment">// 4, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20, Active: true}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22, Active: false}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 5, \u67E5\u8BE2</span>
	<span class="token keyword">var</span> user User
	db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

	<span class="token comment">// 6, \u66F4\u65B0</span>

	<span class="token comment">// \u66F4\u65B0\u5355\u4E2A\u5C5E\u6027\uFF0C\u7C7B\u4F3C\u4E8E update</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UpdateColumn</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`name\` = &#39;hello&#39;  WHERE \`user\`.\`id\` = 1</span>
	<span class="token comment">// \u66F4\u65B0\u591A\u4E2A\u5C5E\u6027\uFF0C\u7C7B\u4F3C\u4E8E updates</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UpdateColumns</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`age\` = 18, \`name\` = &#39;hello&#39;  WHERE \`user\`.\`id\` = 1</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="_5-\u6279\u91CF\u66F4\u65B0" tabindex="-1"><a class="header-anchor" href="#_5-\u6279\u91CF\u66F4\u65B0" aria-hidden="true">#</a> 5\uFF0C\u6279\u91CF\u66F4\u65B0</h3><p>\u6279\u91CF\u66F4\u65B0\u65F6<code>Hooks\uFF08\u94A9\u5B50\u51FD\u6570\uFF09</code>\u4E0D\u4F1A\u8FD0\u884C\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// 1,\u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID     <span class="token builtin">int64</span>
	Name   <span class="token builtin">string</span>
	Age    <span class="token builtin">int64</span>
	Active <span class="token builtin">bool</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 2, \u8FDE\u63A5\u6570\u636E\u5E93</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

	<span class="token comment">// 3, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token comment">// 4, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20, Active: true}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22, Active: false}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 5, \u67E5\u8BE2</span>
	<span class="token keyword">var</span> user User
	db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

	<span class="token comment">// 6, \u66F4\u65B0</span>

	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id IN (?)&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`age\` = 20, \`name\` = &#39;hello&#39;  WHERE (id IN (10,11))</span>
	<span class="token comment">// \u4F7F\u7528struct\u66F4\u65B0\u65F6\uFF0C\u53EA\u4F1A\u66F4\u65B0\u975E\u96F6\u503C\u5B57\u6BB5\uFF0C\u82E5\u60F3\u66F4\u65B0\u6240\u6709\u5B57\u6BB5\uFF0C\u5E94\u4F7F\u7528\u5982\u4E0Amap\u65B9\u5F0F</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">23</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`age\` = 23, \`name\` = &#39;hello&#39;</span>

	<span class="token comment">// \u4F7F\u7528 RowsAffected \u83B7\u53D6\u66F4\u65B0\u8BB0\u5F55\u603B\u6570</span>
	chageNum <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">23</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>RowsAffected <span class="token comment">//UPDATE \`user\` SET \`age\` = 23, \`name\` = &#39;hello&#39;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>chageNum<span class="token punctuation">)</span>

	<span class="token comment">//db.Debug().Model(&amp;user)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h3 id="_6-\u4F7F\u7528sql\u8868\u8FBE\u5F0F\u66F4\u65B0" tabindex="-1"><a class="header-anchor" href="#_6-\u4F7F\u7528sql\u8868\u8FBE\u5F0F\u66F4\u65B0" aria-hidden="true">#</a> 6\uFF0C\u4F7F\u7528SQL\u8868\u8FBE\u5F0F\u66F4\u65B0</h3><p>\u5148\u67E5\u8BE2\u8868\u4E2D\u7684\u7B2C\u4E00\u6761\u6570\u636E\u4FDD\u5B58\u81F3user\u53D8\u91CF\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// 1,\u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID     <span class="token builtin">int64</span>
	Name   <span class="token builtin">string</span>
	Age    <span class="token builtin">int64</span>
	Active <span class="token builtin">bool</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 2, \u8FDE\u63A5\u6570\u636E\u5E93</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

	<span class="token comment">// 3, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token comment">// 4, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20, Active: true}</span>
	<span class="token comment">//db.Create(&amp;u1)</span>
	<span class="token comment">//u2 := User{Name: &quot;jinzhu&quot;, Age: 22, Active: false}</span>
	<span class="token comment">//db.Create(&amp;u2)</span>

	<span class="token comment">// 5, \u67E5\u8BE2</span>
	<span class="token keyword">var</span> user User
	db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

	<span class="token comment">// 6, \u66F4\u65B0</span>

	<span class="token comment">// \u7ED9\u5339\u914D\u5230\u7684\u7528\u6237\u589E\u52A03\u5C81</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> gorm<span class="token punctuation">.</span><span class="token function">Expr</span><span class="token punctuation">(</span><span class="token string">&quot;age + ?&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`age\` = age + 3  WHERE \`user\`.\`id\` = 1</span>
	<span class="token comment">// \u4EE5map\u7684\u65B9\u5F0F\u8FDB\u884C\u5E74\u9F84\u8FD0\u7B97</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> gorm<span class="token punctuation">.</span><span class="token function">Expr</span><span class="token punctuation">(</span><span class="token string">&quot;age * ? + ?&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`age\` = age * 2 + 100  WHERE \`user\`.\`id\` = 1</span>
	<span class="token comment">// \u5E74\u9F84\u51CF\u6CD5</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UpdateColumn</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> gorm<span class="token punctuation">.</span><span class="token function">Expr</span><span class="token punctuation">(</span><span class="token string">&quot;age - ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`age\` = age - &#39;2&#39;  WHERE \`user\`.\`id\` = 1</span>
	<span class="token comment">// \u7ED9\u7B26\u5408\u67E5\u8BE2\u6761\u4EF6\u7684\u7528\u6237\u5E74\u9F84-1</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age &gt; 10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UpdateColumn</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> gorm<span class="token punctuation">.</span><span class="token function">Expr</span><span class="token punctuation">(</span><span class="token string">&quot;age - ?&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`age\` = age - 1  WHERE \`user\`.\`id\` = 1 AND ((age &gt; 10))</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h3 id="_7-\u4FEE\u6539hooks\u4E2D\u7684\u503C" tabindex="-1"><a class="header-anchor" href="#_7-\u4FEE\u6539hooks\u4E2D\u7684\u503C" aria-hidden="true">#</a> 7\uFF0C\u4FEE\u6539Hooks\u4E2D\u7684\u503C</h3><p>\u5982\u679C\u4F60\u60F3\u4FEE\u6539 <code>BeforeUpdate</code>, <code>BeforeSave</code> \u7B49 Hooks \u4E2D\u66F4\u65B0\u7684\u503C\uFF0C\u4F60\u53EF\u4EE5\u4F7F\u7528 <code>scope.SetColumn</code>, \u4F8B\u5982\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>user <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token function">BeforeSave</span><span class="token punctuation">(</span>scope <span class="token operator">*</span>gorm<span class="token punctuation">.</span>Scope<span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> pw<span class="token punctuation">,</span> err <span class="token operator">:=</span> bcrypt<span class="token punctuation">.</span><span class="token function">GenerateFromPassword</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Password<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    scope<span class="token punctuation">.</span><span class="token function">SetColumn</span><span class="token punctuation">(</span><span class="token string">&quot;EncryptedPassword&quot;</span><span class="token punctuation">,</span> pw<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_8-\u5176\u5B83\u66F4\u65B0\u9009\u9879" tabindex="-1"><a class="header-anchor" href="#_8-\u5176\u5B83\u66F4\u65B0\u9009\u9879" aria-hidden="true">#</a> 8\uFF0C\u5176\u5B83\u66F4\u65B0\u9009\u9879</h3><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// \u4E3A update SQL \u6DFB\u52A0\u5176\u5B83\u7684 SQL</span>
db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;gorm:update_option&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OPTION (OPTIMIZE FOR UNKNOWN)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//// UPDATE users SET name=&#39;hello&#39;, updated_at = &#39;2013-11-17 21:34:10&#39; WHERE id=111 OPTION (OPTIMIZE FOR UNKNOWN);</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_10-\u5220\u9664" tabindex="-1"><a class="header-anchor" href="#_10-\u5220\u9664" aria-hidden="true">#</a> 10\uFF0C\u5220\u9664</h2><h3 id="_1-\u5220\u9664\u8BB0\u5F55" tabindex="-1"><a class="header-anchor" href="#_1-\u5220\u9664\u8BB0\u5F55" aria-hidden="true">#</a> 1\uFF0C\u5220\u9664\u8BB0\u5F55</h3><p><strong>\u8B66\u544A</strong> \u5220\u9664\u8BB0\u5F55\u65F6\uFF0C\u8BF7\u786E\u4FDD\u4E3B\u952E\u5B57\u6BB5\u6709\u503C\uFF0CGORM \u4F1A\u901A\u8FC7\u4E3B\u952E\u53BB\u5220\u9664\u8BB0\u5F55\uFF0C\u5982\u679C\u4E3B\u952E\u4E3A\u7A7A\uFF0CGORM \u4F1A\u5220\u9664\u8BE5 model \u7684\u6240\u6709\u8BB0\u5F55\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// \u5220\u9664\u73B0\u6709\u8BB0\u5F55</span>
db<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>email<span class="token punctuation">)</span>
<span class="token comment">//// DELETE from emails where id=10;</span>

<span class="token comment">// \u4E3A\u5220\u9664 SQL \u6DFB\u52A0\u989D\u5916\u7684 SQL \u64CD\u4F5C</span>
db<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;gorm:delete_option&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OPTION (OPTIMIZE FOR UNKNOWN)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>email<span class="token punctuation">)</span>
<span class="token comment">//// DELETE from emails where id=10 OPTION (OPTIMIZE FOR UNKNOWN);</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_2-\u6279\u91CF\u5220\u9664" tabindex="-1"><a class="header-anchor" href="#_2-\u6279\u91CF\u5220\u9664" aria-hidden="true">#</a> 2\uFF0C\u6279\u91CF\u5220\u9664</h3><p>\u5220\u9664\u5168\u90E8\u5339\u914D\u7684\u8BB0\u5F55</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// \u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Name   <span class="token builtin">string</span>
	Age    <span class="token builtin">int64</span>
	Active <span class="token builtin">bool</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

	<span class="token comment">// 2, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token comment">// 3, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20, Active: true}</span>
	<span class="token comment">//	//db.Create(&amp;u1)</span>
	<span class="token comment">//	//u2 := User{Name: &quot;jinzhu&quot;, Age: 22, Active: false}</span>
	<span class="token comment">//	//db.Create(&amp;u2)</span>
	<span class="token comment">//	//u3 := User{Name: &quot;eryajf2&quot;, Age: 20, Active: true}</span>
	<span class="token comment">//	//db.Create(&amp;u3)</span>
	<span class="token comment">//	//u4 := User{Name: &quot;jinzhu2&quot;, Age: 22, Active: false}</span>
	<span class="token comment">//	//db.Create(&amp;u4)</span>

	<span class="token comment">// \u5220\u9664\u7B26\u5408\u6761\u4EF6\u7684\u8BB0\u5F55</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name LIKE ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;%jinzhu%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`deleted_at\`=&#39;2020-03-08 23:48:05&#39;  WHERE \`user\`.\`deleted_at\` IS NULL AND ((name LIKE &#39;jinzhu&#39;))</span>
	<span class="token comment">// \u4E0E\u4E0A\u8FB9\u6548\u679C\u4E00\u6837</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;name LIKE ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;%jinzhu%&quot;</span><span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`deleted_at\`=&#39;2020-03-08 23:49:34&#39;  WHERE \`user\`.\`deleted_at\` IS NULL AND ((name LIKE &#39;%jinzhu%&#39;))</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h3 id="_3-\u8F6F\u5220\u9664" tabindex="-1"><a class="header-anchor" href="#_3-\u8F6F\u5220\u9664" aria-hidden="true">#</a> 3\uFF0C\u8F6F\u5220\u9664</h3><p>\u5982\u679C\u4E00\u4E2A model \u6709 <code>DeletedAt</code> \u5B57\u6BB5\uFF0C\u4ED6\u5C06\u81EA\u52A8\u83B7\u5F97\u8F6F\u5220\u9664\u7684\u529F\u80FD\uFF01 \u5F53\u8C03\u7528 <code>Delete</code> \u65B9\u6CD5\u65F6\uFF0C \u8BB0\u5F55\u4E0D\u4F1A\u771F\u6B63\u7684\u4ECE\u6570\u636E\u5E93\u4E2D\u88AB\u5220\u9664\uFF0C \u53EA\u4F1A\u5C06<code>DeletedAt</code> \u5B57\u6BB5\u7684\u503C\u4F1A\u88AB\u8BBE\u7F6E\u4E3A\u5F53\u524D\u65F6\u95F4</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
<span class="token comment">//// UPDATE users SET deleted_at=&quot;2013-10-29 10:23&quot; WHERE id = 111;</span>

<span class="token comment">// \u6279\u91CF\u5220\u9664</span>
db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//// UPDATE users SET deleted_at=&quot;2013-10-29 10:23&quot; WHERE age = 20;</span>

<span class="token comment">// \u67E5\u8BE2\u8BB0\u5F55\u65F6\u4F1A\u5FFD\u7565\u88AB\u8F6F\u5220\u9664\u7684\u8BB0\u5F55</span>
db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age = 20&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
<span class="token comment">//// SELECT * FROM users WHERE age = 20 AND deleted_at IS NULL;</span>

<span class="token comment">// Unscoped \u65B9\u6CD5\u53EF\u4EE5\u67E5\u8BE2\u88AB\u8F6F\u5220\u9664\u7684\u8BB0\u5F55</span>
db<span class="token punctuation">.</span><span class="token function">Unscoped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age = 20&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">//// SELECT * FROM users WHERE age = 20;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_4-\u7269\u7406\u5220\u9664" tabindex="-1"><a class="header-anchor" href="#_4-\u7269\u7406\u5220\u9664" aria-hidden="true">#</a> 4\uFF0C\u7269\u7406\u5220\u9664</h3><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Unscoped \u65B9\u6CD5\u53EF\u4EE5\u7269\u7406\u5220\u9664\u8BB0\u5F55</span>
db<span class="token punctuation">.</span><span class="token function">Unscoped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>order<span class="token punctuation">)</span>
<span class="token comment">//// DELETE FROM orders WHERE id=10;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u4EE3\u7801\u793A\u4F8B\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/jinzhu/gorm&quot;</span>
	<span class="token boolean">_</span> <span class="token string">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// \u5B9A\u4E49\u6A21\u578B</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Name   <span class="token builtin">string</span>
	Age    <span class="token builtin">int64</span>
	Active <span class="token builtin">bool</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cgorm\u521B\u5EFA\u7684\u8868\u5C06\u4F1A\u662F\u7ED3\u6784\u4F53\u540D\u79F0\u7684\u590D\u6570\u5F62\u5F0F\uFF0C\u5982\u679C\u4E0D\u60F3\u8BA9\u5B83\u81EA\u52A8\u590D\u6570\uFF0C\u53EF\u4EE5\u52A0\u4E00\u4E0B\u7981\u7528</span>
	db<span class="token punctuation">.</span><span class="token function">SingularTable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

	<span class="token comment">// 2, \u628A\u6A21\u578B\u4E0E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u5BF9\u5E94\u8D77\u6765</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token comment">// 3, \u521B\u5EFA</span>
	<span class="token comment">//u1 := User{Name: &quot;eryajf&quot;, Age: 20, Active: true}</span>
	<span class="token comment">//	//db.Create(&amp;u1)</span>
	<span class="token comment">//	//u2 := User{Name: &quot;jinzhu&quot;, Age: 22, Active: false}</span>
	<span class="token comment">//	//db.Create(&amp;u2)</span>
	<span class="token comment">//	//u3 := User{Name: &quot;eryajf2&quot;, Age: 20, Active: true}</span>
	<span class="token comment">//	//db.Create(&amp;u3)</span>
	<span class="token comment">//	//u4 := User{Name: &quot;jinzhu2&quot;, Age: 22, Active: false}</span>
	<span class="token comment">//	//db.Create(&amp;u4)</span>

	<span class="token comment">// \u6279\u91CF\u5220\u9664</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//UPDATE \`user\` SET \`deleted_at\`=&#39;2020-03-08 23:53:03&#39;  WHERE \`user\`.\`deleted_at\` IS NULL AND ((age = 20))</span>

	<span class="token comment">// \u67E5\u8BE2\u8BB0\u5F55\u65F6\u4F1A\u5FFD\u7565\u88AB\u8F6F\u5220\u9664\u7684\u8BB0\u5F55</span>
	<span class="token keyword">var</span> user User
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age = 20&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE \`user\`.\`deleted_at\` IS NULL AND ((age = 20))</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

	<span class="token comment">// Unscoped \u65B9\u6CD5\u53EF\u4EE5\u67E5\u8BE2\u88AB\u8F6F\u5220\u9664\u7684\u8BB0\u5F55</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unscoped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age = 20&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">//SELECT * FROM \`user\`  WHERE (age = 20)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

	<span class="token comment">// Unscoped \u65B9\u6CD5\u53EF\u4EE5\u7269\u7406\u5220\u9664\u8BB0\u5F55</span>
	db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unscoped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;eryajf&quot;</span><span class="token punctuation">)</span> <span class="token comment">//DELETE FROM \`user\`  WHERE (name = &#39;eryajf&#39;)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h2 id="_11-\u94FE\u5F0F\u64CD\u4F5C\u76F8\u5173" tabindex="-1"><a class="header-anchor" href="#_11-\u94FE\u5F0F\u64CD\u4F5C\u76F8\u5173" aria-hidden="true">#</a> 11\uFF0C\u94FE\u5F0F\u64CD\u4F5C\u76F8\u5173</h2><h3 id="_1-\u94FE\u5F0F\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#_1-\u94FE\u5F0F\u64CD\u4F5C" aria-hidden="true">#</a> 1\uFF0C\u94FE\u5F0F\u64CD\u4F5C</h3><p>Method Chaining\uFF0CGorm \u5B9E\u73B0\u4E86\u94FE\u5F0F\u64CD\u4F5C\u63A5\u53E3\uFF0C\u6240\u4EE5\u4F60\u53EF\u4EE5\u628A\u4EE3\u7801\u5199\u6210\u8FD9\u6837\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// \u521B\u5EFA\u4E00\u4E2A\u67E5\u8BE2</span>
tx <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// \u6DFB\u52A0\u66F4\u591A\u6761\u4EF6</span>
<span class="token keyword">if</span> someCondition <span class="token punctuation">{</span>
  tx <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  tx <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> yetAnotherCondition <span class="token punctuation">{</span>
  tx <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;active = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>\u5728\u8C03\u7528\u7ACB\u5373\u6267\u884C\u65B9\u6CD5\u524D\u4E0D\u4F1A\u751F\u6210<code>Query</code>\u8BED\u53E5\uFF0C\u501F\u52A9\u8FD9\u4E2A\u7279\u6027\u4F60\u53EF\u4EE5\u521B\u5EFA\u4E00\u4E2A\u51FD\u6570\u6765\u5904\u7406\u4E00\u4E9B\u901A\u7528\u903B\u8F91\u3002</p><h3 id="_2-\u7ACB\u5373\u6267\u884C\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_2-\u7ACB\u5373\u6267\u884C\u65B9\u6CD5" aria-hidden="true">#</a> 2\uFF0C\u7ACB\u5373\u6267\u884C\u65B9\u6CD5</h3><p>Immediate methods \uFF0C\u7ACB\u5373\u6267\u884C\u65B9\u6CD5\u662F\u6307\u90A3\u4E9B\u4F1A\u7ACB\u5373\u751F\u6210<code>SQL</code>\u8BED\u53E5\u5E76\u53D1\u9001\u5230\u6570\u636E\u5E93\u7684\u65B9\u6CD5, \u4ED6\u4EEC\u4E00\u822C\u662F<code>CRUD</code>\u65B9\u6CD5\uFF0C\u6BD4\u5982\uFF1A</p><p><code>Create</code>, <code>First</code>, <code>Find</code>, <code>Take</code>, <code>Save</code>, <code>UpdateXXX</code>, <code>Delete</code>, <code>Scan</code>, <code>Row</code>, <code>Rows</code>\u2026</p><p>\u8FD9\u6709\u4E00\u4E2A\u57FA\u4E8E\u4E0A\u9762\u94FE\u5F0F\u65B9\u6CD5\u4EE3\u7801\u7684\u7ACB\u5373\u6267\u884C\u65B9\u6CD5\u7684\u4F8B\u5B50\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>tx<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u751F\u6210\u7684SQL\u8BED\u53E5\u5982\u4E0B\uFF1A</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">&#39;jinzhu&#39;</span> <span class="token operator">AND</span> age <span class="token operator">=</span> <span class="token number">30</span> <span class="token operator">AND</span> active <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="_3-\u8303\u56F4" tabindex="-1"><a class="header-anchor" href="#_3-\u8303\u56F4" aria-hidden="true">#</a> 3\uFF0C\u8303\u56F4</h3><p><code>Scopes</code>\uFF0CScope\u662F\u5EFA\u7ACB\u5728\u94FE\u5F0F\u64CD\u4F5C\u7684\u57FA\u7840\u4E4B\u4E0A\u7684\u3002</p><p>\u57FA\u4E8E\u5B83\uFF0C\u4F60\u53EF\u4EE5\u62BD\u53D6\u4E00\u4E9B\u901A\u7528\u903B\u8F91\uFF0C\u5199\u51FA\u66F4\u591A\u53EF\u91CD\u7528\u7684\u51FD\u6570\u5E93\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">AmountGreaterThan1000</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
  <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;amount &gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">PaidWithCreditCard</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
  <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;pay_mode_sign = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">PaidWithCod</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
  <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;pay_mode_sign = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">OrderStatus</span><span class="token punctuation">(</span>status <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token keyword">func</span> <span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">func</span> <span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
    <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">Scopes</span><span class="token punctuation">(</span>AmountGreaterThan1000<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;status IN (?)&quot;</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

db<span class="token punctuation">.</span><span class="token function">Scopes</span><span class="token punctuation">(</span>AmountGreaterThan1000<span class="token punctuation">,</span> PaidWithCreditCard<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>orders<span class="token punctuation">)</span>
<span class="token comment">// \u67E5\u627E\u6240\u6709\u91D1\u989D\u5927\u4E8E 1000 \u7684\u4FE1\u7528\u5361\u8BA2\u5355</span>

db<span class="token punctuation">.</span><span class="token function">Scopes</span><span class="token punctuation">(</span>AmountGreaterThan1000<span class="token punctuation">,</span> PaidWithCod<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>orders<span class="token punctuation">)</span>
<span class="token comment">// \u67E5\u627E\u6240\u6709\u91D1\u989D\u5927\u4E8E 1000 \u7684 COD \u8BA2\u5355</span>

db<span class="token punctuation">.</span><span class="token function">Scopes</span><span class="token punctuation">(</span>AmountGreaterThan1000<span class="token punctuation">,</span> <span class="token function">OrderStatus</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;paid&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;shipped&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>orders<span class="token punctuation">)</span>
<span class="token comment">// \u67E5\u627E\u6240\u6709\u91D1\u989D\u5927\u4E8E 1000 \u4E14\u5DF2\u4ED8\u6B3E\u6216\u8005\u5DF2\u53D1\u8D27\u7684\u8BA2\u5355</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="_4-\u591A\u4E2A\u7ACB\u5373\u6267\u884C\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_4-\u591A\u4E2A\u7ACB\u5373\u6267\u884C\u65B9\u6CD5" aria-hidden="true">#</a> 4\uFF0C\u591A\u4E2A\u7ACB\u5373\u6267\u884C\u65B9\u6CD5</h3><p>Multiple Immediate Methods\uFF0C\u5728 GORM \u4E2D\u4F7F\u7528\u591A\u4E2A\u7ACB\u5373\u6267\u884C\u65B9\u6CD5\u65F6\uFF0C\u540E\u4E00\u4E2A\u7ACB\u5373\u6267\u884C\u65B9\u6CD5\u4F1A\u590D\u7528\u524D\u4E00\u4E2A<strong>\u7ACB\u5373\u6267\u884C\u65B9\u6CD5</strong>\u7684\u6761\u4EF6 (\u4E0D\u5305\u62EC\u5185\u8054\u6761\u4EF6) \u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name LIKE ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">,</span> <span class="token string">&quot;id IN (?)&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>count<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u751F\u6210\u7684 Sql</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> name <span class="token operator">LIKE</span> <span class="token string">&#39;jinzhu%&#39;</span> <span class="token operator">AND</span> id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>

<span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> name <span class="token operator">LIKE</span> <span class="token string">&#39;jinzhu%&#39;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div>`,63);function R(L,O){const a=e("ExternalLinkIcon");return o(),c(u,null,[r,k,n("p",null,[n("a",b,[m,p(a)])]),n("p",null,[n("a",d,[g,p(a)]),q]),f,n("p",null,[h,y,E,n("a",_,[v,p(a)]),A]),N,n("p",null,[w,n("a",S,[T,p(a)])]),U],64)}var C=l(i,[["render",R]]);export{C as default};
