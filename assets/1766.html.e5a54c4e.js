import{e}from"./app.dbf5d933.js";import{_ as s}from"./plugin-vue_export-helper.21dcd24c.js";const n={},a=e(`<p>\u90E8\u7F72 kubectl \u5DE5\u5177\uFF0C\u521B\u5EFA kubeconfig \u6587\u4EF6\u3002</p><p>kubectl \u662F kubernetes \u7684\u96C6\u7FA4\u7BA1\u7406\u5DE5\u5177\uFF0C\u4EFB\u4E00\u96C6\u7FA4\u4E2D\u7684\u8282\u70B9\u90FD\u53EF\u4EE5\u901A\u8FC7 kubetcl \u88AB\u7BA1\u7406\u3002</p><p>\u672C\u6587\u662F\u5728 <code>master\u8282\u70B9</code> \u90E8\u7F72\uFF0C\u90E8\u7F72\u6210\u529F\u540E\u4F1A\u751F\u6210 /root/.kube/config \u6587\u4EF6\uFF0Ckubectl \u5C31\u662F\u901A\u8FC7\u8FD9\u4E2A\u83B7\u53D6 kube-apiserver \u5730\u5740\u3001\u8BC1\u4E66\u3001\u7528\u6237\u540D\u7B49\u4FE1\u606F\uFF0C\u6240\u4EE5\u8FD9\u4E2A\u6587\u4EF6\u9700\u8981\u4FDD\u7BA1\u597D\u3002</p><h2 id="_1-\u4E0B\u8F7D\u5B89\u88C5\u5305" tabindex="-1"><a class="header-anchor" href="#_1-\u4E0B\u8F7D\u5B89\u88C5\u5305" aria-hidden="true">#</a> 1\uFF0C\u4E0B\u8F7D\u5B89\u88C5\u5305</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># cd</span>
 
<span class="token comment"># wget https://dl.k8s.io/v1.8.6/kubernetes-client-linux-amd64.tar.gz</span>
 
<span class="token comment"># tar -xzvf kubernetes-client-linux-amd64.tar.gz</span>
 
<span class="token comment"># sudo cp kubernetes/client/bin/kube* /usr/local/bin/</span>
 
<span class="token comment"># chmod a+x /usr/local/bin/kube*</span>
 
<span class="token comment"># export PATH=/root/local/bin:$PATH</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="_2-\u521B\u5EFA-root-kube-config" tabindex="-1"><a class="header-anchor" href="#_2-\u521B\u5EFA-root-kube-config" aria-hidden="true">#</a> 2\uFF0C\u521B\u5EFA / root/.kube/config</h2><h3 id="_1-\u8BBE\u7F6E\u96C6\u7FA4\u53C2\u6570-\u2013server-\u6307\u5B9A-master-\u8282\u70B9-ip" tabindex="-1"><a class="header-anchor" href="#_1-\u8BBE\u7F6E\u96C6\u7FA4\u53C2\u6570-\u2013server-\u6307\u5B9A-master-\u8282\u70B9-ip" aria-hidden="true">#</a> 1\uFF0C\u8BBE\u7F6E\u96C6\u7FA4\u53C2\u6570,\u2013server \u6307\u5B9A Master \u8282\u70B9 ip</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl config set-cluster kubernetes <span class="token punctuation">\\</span>
  --certificate-authority<span class="token operator">=</span>/etc/kubernetes/ssl/ca.pem <span class="token punctuation">\\</span>
  --embed-certs<span class="token operator">=</span>true <span class="token punctuation">\\</span>
  --server<span class="token operator">=</span>https://192.168.106.3:6443
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_2-\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u8BA4\u8BC1\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#_2-\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u8BA4\u8BC1\u53C2\u6570" aria-hidden="true">#</a> 2\uFF0C\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u8BA4\u8BC1\u53C2\u6570</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl config set-credentials admin <span class="token punctuation">\\</span>
  --client-certificate<span class="token operator">=</span>/etc/kubernetes/ssl/admin.pem <span class="token punctuation">\\</span>
  --embed-certs<span class="token operator">=</span>true <span class="token punctuation">\\</span>
  --client-key<span class="token operator">=</span>/etc/kubernetes/ssl/admin-key.pem
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_3-\u8BBE\u7F6E\u4E0A\u4E0B\u6587\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#_3-\u8BBE\u7F6E\u4E0A\u4E0B\u6587\u53C2\u6570" aria-hidden="true">#</a> 3\uFF0C\u8BBE\u7F6E\u4E0A\u4E0B\u6587\u53C2\u6570</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl config set-context kubernetes <span class="token punctuation">\\</span>
  --cluster<span class="token operator">=</span>kubernetes <span class="token punctuation">\\</span>
  --user<span class="token operator">=</span>admin
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_4-\u8BBE\u7F6E\u9ED8\u8BA4\u4E0A\u4E0B\u6587" tabindex="-1"><a class="header-anchor" href="#_4-\u8BBE\u7F6E\u9ED8\u8BA4\u4E0A\u4E0B\u6587" aria-hidden="true">#</a> 4\uFF0C\u8BBE\u7F6E\u9ED8\u8BA4\u4E0A\u4E0B\u6587</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl config use-context kubernetes
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>admin.pem \u8BC1\u4E66 O \u5B57\u6BB5\u503C\u4E3A system:masters\uFF0Ckube-apiserver \u9884\u5B9A\u4E49\u7684 RoleBinding cluster-admin \u5C06 Group system:masters \u4E0E Role cluster-admin \u7ED1\u5B9A\uFF0C\u8BE5 Role \u6388\u4E88\u4E86\u8C03\u7528 kube-apiserver \u76F8\u5173 API \u7684\u6743\u9650\u3002</p><h2 id="_3-\u521B\u5EFA-bootstrap-kubeconfig" tabindex="-1"><a class="header-anchor" href="#_3-\u521B\u5EFA-bootstrap-kubeconfig" aria-hidden="true">#</a> 3\uFF0C\u521B\u5EFA bootstrap.kubeconfig</h2><p>kubelet \u8BBF\u95EE kube-apiserver \u7684\u65F6\u5019\u662F\u901A\u8FC7 bootstrap.kubeconfig \u8FDB\u884C\u7528\u6237\u9A8C\u8BC1\u3002</p><h3 id="_1-\u751F\u6210-token-\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#_1-\u751F\u6210-token-\u53D8\u91CF" aria-hidden="true">#</a> 1\uFF0C\u751F\u6210 token \u53D8\u91CF</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># export BOOTSTRAP_TOKEN=$(head -c 16 /dev/urandom | od -An -t x | tr -d &#39; &#39;)</span>
 
<span class="token comment"># cat &gt; token.csv &lt;&lt;EOF</span>
<span class="token variable">\${BOOTSTRAP_TOKEN}</span>,kubelet-bootstrap,10001,<span class="token string">&quot;system:kubelet-bootstrap&quot;</span>
EOF
 
<span class="token comment"># mv token.csv /etc/kubernetes/</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_2-\u8BBE\u7F6E\u96C6\u7FA4\u53C2\u6570\u2013server-\u4E3A-master-\u8282\u70B9-ip" tabindex="-1"><a class="header-anchor" href="#_2-\u8BBE\u7F6E\u96C6\u7FA4\u53C2\u6570\u2013server-\u4E3A-master-\u8282\u70B9-ip" aria-hidden="true">#</a> 2\uFF0C\u8BBE\u7F6E\u96C6\u7FA4\u53C2\u6570\u2013server \u4E3A master \u8282\u70B9 ip</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl config set-cluster kubernetes <span class="token punctuation">\\</span>
  --certificate-authority<span class="token operator">=</span>/etc/kubernetes/ssl/ca.pem <span class="token punctuation">\\</span>
  --embed-certs<span class="token operator">=</span>true <span class="token punctuation">\\</span>
  --server<span class="token operator">=</span>https://192.168.106.3:6443 <span class="token punctuation">\\</span>
  --kubeconfig<span class="token operator">=</span>bootstrap.kubeconfig
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3-\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u8BA4\u8BC1\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#_3-\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u8BA4\u8BC1\u53C2\u6570" aria-hidden="true">#</a> 3\uFF0C\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u8BA4\u8BC1\u53C2\u6570</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl config set-credentials kubelet-bootstrap <span class="token punctuation">\\</span>
  --token<span class="token operator">=</span><span class="token variable">\${BOOTSTRAP_TOKEN}</span> <span class="token punctuation">\\</span>
  --kubeconfig<span class="token operator">=</span>bootstrap.kubeconfig
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_4-\u8BBE\u7F6E\u4E0A\u4E0B\u6587\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#_4-\u8BBE\u7F6E\u4E0A\u4E0B\u6587\u53C2\u6570" aria-hidden="true">#</a> 4\uFF0C\u8BBE\u7F6E\u4E0A\u4E0B\u6587\u53C2\u6570</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># kubectl config set-context default \\</span>
  --cluster<span class="token operator">=</span>kubernetes <span class="token punctuation">\\</span>
  --user<span class="token operator">=</span>kubelet-bootstrap <span class="token punctuation">\\</span>
  --kubeconfig<span class="token operator">=</span>bootstrap.kubeconfig
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_5-\u8BBE\u7F6E\u9ED8\u8BA4\u4E0A\u4E0B\u6587" tabindex="-1"><a class="header-anchor" href="#_5-\u8BBE\u7F6E\u9ED8\u8BA4\u4E0A\u4E0B\u6587" aria-hidden="true">#</a> 5\uFF0C\u8BBE\u7F6E\u9ED8\u8BA4\u4E0A\u4E0B\u6587</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># kubectl config use-context default --kubeconfig=bootstrap.kubeconfig</span>
 
<span class="token comment"># mv bootstrap.kubeconfig /etc/kubernetes/</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_4-\u521B\u5EFA-kube-proxy-kubeconfig" tabindex="-1"><a class="header-anchor" href="#_4-\u521B\u5EFA-kube-proxy-kubeconfig" aria-hidden="true">#</a> 4\uFF0C\u521B\u5EFA kube-proxy.kubeconfig</h2><h3 id="_1-\u8BBE\u7F6E\u96C6\u7FA4\u53C2\u6570-\u2013server-\u53C2\u6570\u4E3A-master-ip" tabindex="-1"><a class="header-anchor" href="#_1-\u8BBE\u7F6E\u96C6\u7FA4\u53C2\u6570-\u2013server-\u53C2\u6570\u4E3A-master-ip" aria-hidden="true">#</a> 1\uFF0C\u8BBE\u7F6E\u96C6\u7FA4\u53C2\u6570 \u2013server \u53C2\u6570\u4E3A master ip</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl config set-cluster kubernetes <span class="token punctuation">\\</span>
  --certificate-authority<span class="token operator">=</span>/etc/kubernetes/ssl/ca.pem <span class="token punctuation">\\</span>
  --embed-certs<span class="token operator">=</span>true <span class="token punctuation">\\</span>
  --server<span class="token operator">=</span>https://192.168.106.3:6443 <span class="token punctuation">\\</span>
  --kubeconfig<span class="token operator">=</span>kube-proxy.kubeconfig
 
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2-\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u8BA4\u8BC1\u53C2\u6570-1" tabindex="-1"><a class="header-anchor" href="#_2-\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u8BA4\u8BC1\u53C2\u6570-1" aria-hidden="true">#</a> 2\uFF0C\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u8BA4\u8BC1\u53C2\u6570</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl config set-credentials kube-proxy <span class="token punctuation">\\</span>
  --client-certificate<span class="token operator">=</span>/etc/kubernetes/ssl/kube-proxy.pem <span class="token punctuation">\\</span>
  --client-key<span class="token operator">=</span>/etc/kubernetes/ssl/kube-proxy-key.pem <span class="token punctuation">\\</span>
  --embed-certs<span class="token operator">=</span>true <span class="token punctuation">\\</span>
  --kubeconfig<span class="token operator">=</span>kube-proxy.kubeconfig
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3-\u8BBE\u7F6E\u4E0A\u4E0B\u6587\u53C2\u6570-1" tabindex="-1"><a class="header-anchor" href="#_3-\u8BBE\u7F6E\u4E0A\u4E0B\u6587\u53C2\u6570-1" aria-hidden="true">#</a> 3\uFF0C\u8BBE\u7F6E\u4E0A\u4E0B\u6587\u53C2\u6570</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl config set-context default <span class="token punctuation">\\</span>
  --cluster<span class="token operator">=</span>kubernetes <span class="token punctuation">\\</span>
  --user<span class="token operator">=</span>kube-proxy <span class="token punctuation">\\</span>
  --kubeconfig<span class="token operator">=</span>kube-proxy.kubeconfig
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_4-\u8BBE\u7F6E\u9ED8\u8BA4\u4E0A\u4E0B\u6587-1" tabindex="-1"><a class="header-anchor" href="#_4-\u8BBE\u7F6E\u9ED8\u8BA4\u4E0A\u4E0B\u6587-1" aria-hidden="true">#</a> 4\uFF0C\u8BBE\u7F6E\u9ED8\u8BA4\u4E0A\u4E0B\u6587</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># kubectl config use-context default --kubeconfig=kube-proxy.kubeconfig</span>
 
<span class="token comment"># mv kube-proxy.kubeconfig /etc/kubernetes/</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u8BBE\u7F6E\u96C6\u7FA4\u53C2\u6570\u548C\u5BA2\u6237\u7AEF\u8BA4\u8BC1\u53C2\u6570\u65F6 \u2013embed-certs \u90FD\u4E3A true\uFF0C\u8FD9\u4F1A\u5C06 certificate-authority\u3001client-certificate \u548C client-key \u6307\u5411\u7684\u8BC1\u4E66\u6587\u4EF6\u5185\u5BB9\u5199\u5165\u5230\u751F\u6210\u7684 kube-proxy.kubeconfig \u6587\u4EF6\u4E2D\uFF1B</p><p>kube-proxy.pem \u8BC1\u4E66\u4E2D CN \u4E3A system:kube-proxy\uFF0Ckube-apiserver \u9884\u5B9A\u4E49\u7684 RoleBinding cluster-admin \u5C06 User system:kube-proxy \u4E0E Role system:node-proxier \u7ED1\u5B9A\uFF0C\u8BE5 Role \u6388\u4E88\u4E86\u8C03\u7528 kube-apiserver Proxy \u76F8\u5173 API \u7684\u6743\u9650\uFF1B</p><h2 id="_5-\u540C\u6B65\u914D\u7F6E\u6587\u4EF6\u3002" tabindex="-1"><a class="header-anchor" href="#_5-\u540C\u6B65\u914D\u7F6E\u6587\u4EF6\u3002" aria-hidden="true">#</a> 5\uFF0C\u540C\u6B65\u914D\u7F6E\u6587\u4EF6\u3002</h2><p>\u751F\u6210\u7684 bootstrap.kubeconfig\uFF0Ckube-proxy.kubeconfig \u6587\u4EF6\u62F7\u8D1D\u5230\u5176\u5B83 node \u8282\u70B9\u7684 / etc/kubernetes \u76EE\u5F55\u4E0B\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># scp /etc/kubernetes/kube-proxy.kubeconfig node01:/etc/kubernetes/</span>
<span class="token comment"># scp /etc/kubernetes/bootstrap.kubeconfig  node01:/etc/kubernetes/</span>
 
<span class="token comment"># scp /etc/kubernetes/kube-proxy.kubeconfig node02:/etc/kubernetes/</span>
<span class="token comment"># scp /etc/kubernetes/bootstrap.kubeconfig  node02:/etc/kubernetes/</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>`,41);function r(t,p){return a}var o=s(n,[["render",r]]);export{o as default};
