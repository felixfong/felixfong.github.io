import{e as n}from"./app.dbf5d933.js";import{_ as s}from"./plugin-vue_export-helper.21dcd24c.js";const a={},t=n(`<p>geoip\u4E3B\u8981\u7528\u4E8Ekibana\u7ED8\u5236\u5730\u7406\u533A\u57DF\u56FE\u65F6\u4F7F\u7528\uFF0C\u539F\u7406\u5C31\u662F\u901A\u8FC7\u4E00\u4E2AIP\u5E93\uFF0C\u6839\u636EIP\u76F4\u63A5\u83B7\u53D6\u5BF9\u5E94\u7684\u5730\u7406\u5750\u6807\u7B49\u4FE1\u606F\uFF0C\u4ECE\u800C\u5728\u5730\u56FE\u4E0A\u8FDB\u884C\u5C55\u793A\u3002</p><h2 id="_1-\u4E0B\u8F7D\u5E93\u3002" tabindex="-1"><a class="header-anchor" href="#_1-\u4E0B\u8F7D\u5E93\u3002" aria-hidden="true">#</a> 1\uFF0C\u4E0B\u8F7D\u5E93\u3002</h2><p>\u65E2\u7136\u4F9D\u8D56\u5E93\uFF0C\u90A3\u4E48\u5C31\u5148\u4E0B\u8F7D\u4E00\u4E0B\u5BF9\u5E94\u7684\u5E93\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">wget</span> https://geolite.maxmind.com/download/geoip/database/GeoLite2-City.tar.gz
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u8FD9\u4E2A\u5E93\u662F\u6BCF\u5468\u4E00\u66F4\u65B0\u7684\uFF0C\u5728\u751F\u4EA7\u73AF\u5883\u5F53\u4E2D\u5982\u679C\u60F3\u8981\u4FDD\u8BC1\u6700\u7EC8\u7ED3\u679C\u7684\u51C6\u786E\u6027\uFF0C\u53EF\u80FD\u9700\u8981\u5468\u671F\u6027\u66F4\u65B0\u8FD9\u4E2A\u5E93\u3002</p><p>\u89E3\u538B:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">tar</span> xf GeoLite2-City.tar.gz
$ <span class="token function">mv</span> GeoLite2-City_20191126/GeoLite2-City.mmdb /etc/logstash/
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u7136\u540E\u5728\u914D\u7F6Elogstash\u8F6C\u53D1\u65E5\u5FD7\u7684\u65F6\u5019\uFF0C\u5C06\u8FD9\u4E2A\u5E93\u5F15\u5165\u5373\u53EF\u3002</p><h2 id="_2-logstash\u914D\u7F6E\u3002" tabindex="-1"><a class="header-anchor" href="#_2-logstash\u914D\u7F6E\u3002" aria-hidden="true">#</a> 2\uFF0Clogstash\u914D\u7F6E\u3002</h2><p>\u7F51\u4E0A\u9488\u5BF9\u8FD9\u4E2A\u5730\u65B9\u7684\u914D\u7F6E\u5404\u79CD\u5404\u6837\uFF0C\u81F4\u4F7F\u6211\u4EEC\u6709\u65F6\u5019\u53CD\u800C\u4E0D\u77E5\u81EA\u5DF1\u5E94\u8BE5\u600E\u4E48\u914D\u7F6E\u624D\u662F\u6700\u4F18\u7684\uFF0C\u4E4B\u524D\u6211\u4E2A\u4EBA\u7684\u601D\u8DEF\u4E5F\u6CA1\u8D70\u5BF9\uFF0C\u4EE5\u81F3\u4E8E\u8D39\u4E86\u4E0D\u5C11\u529F\u592B\uFF0C\u6CA1\u6709\u591A\u5927\u6536\u83B7\u3002</p><p>\u8FD9\u91CC\u9700\u8981\u8FDB\u884C\u4E00\u6CE2\u8C03\u8BD5\uFF0C\u901A\u8FC7\u8C03\u8BD5\uFF0C\u6211\u4EEC\u83B7\u53D6\u81EA\u5DF1\u60F3\u8981\u7684\u5185\u5BB9\uFF0C\u8BA9\u914D\u7F6E\u8FBE\u5230\u6700\u4F18\u5316\u3002</p><h3 id="_1-\u5168\u89E3\u6790" tabindex="-1"><a class="header-anchor" href="#_1-\u5168\u89E3\u6790" aria-hidden="true">#</a> 1\uFF0C\u5168\u89E3\u6790</h3><p>\u60F3\u8981\u5F97\u5230\u6700\u7EC8\u7B54\u6848\uFF0C\u6211\u4EEC\u9700\u8981\u5148\u770B\u770B\u914D\u7F6E\u9879\u90FD\u7ED9\u4E86\u6211\u4EEC\u54EA\u4E9B\u9009\u62E9\uFF0C\u8FD9\u4E2A\u65F6\u5019\u53EF\u4EE5\u76F4\u63A5\u7528\u5982\u4E0B\u914D\u7F6E\u5BF9NGINX\u8BBF\u95EE\u65E5\u5FD7\u8FDB\u884C\u89E3\u6790\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>input <span class="token punctuation">{</span>
  kafka <span class="token punctuation">{</span>
    bootstrap_servers  =&gt; <span class="token string">&quot;192.168.3.0:9092&quot;</span>
    group_id          =&gt; <span class="token string">&quot;nginx&quot;</span>
    consumer_threads =&gt; <span class="token number">6</span>
    topics            =&gt; <span class="token string">&quot;nginx&quot;</span>
    codec             =&gt; <span class="token string">&quot;json&quot;</span>
    client_id =&gt; <span class="token string">&quot;nginx&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
filter <span class="token punctuation">{</span>
  geoip <span class="token punctuation">{</span>
    source =&gt; <span class="token string">&quot;remote_addr&quot;</span>
    database =&gt; <span class="token string">&quot;/etc/logstash/GeoLite2-City.mmdb&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
output <span class="token punctuation">{</span>
  stdout <span class="token punctuation">{</span>
    codec =&gt; rubydebug
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
# output <span class="token punctuation">{</span>
#  elasticsearch <span class="token punctuation">{</span>
#  hosts =&gt; <span class="token punctuation">[</span><span class="token string">&quot;http://192.168.3.0:9200&quot;</span><span class="token punctuation">]</span>
#  index =&gt; <span class="token string">&quot;logstash-nginx-%{+YYYY.MM}&quot;</span>
#  <span class="token punctuation">}</span>
#<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>\u901A\u8FC7filter\u89C4\u5219\u4E2D\u7684geoip\u6A21\u5757\u8FDB\u884C\u89E3\u6790\uFF0C <code>source</code>\u7528\u4E8E\u6307\u5B9A\u65E5\u5FD7\u5F53\u4E2D\u8BB0\u5F55\u5BA2\u6237\u7AEFIP\u7684\u5B57\u6BB5\uFF0C<code>database</code>\u5219\u6307\u5B9A\u4E86\u6211\u4EEC\u89E3\u538B\u4E4B\u540E\u7684IP\u5E93\u3002\u540C\u65F6\u4F7F\u7528\u5C06\u65E5\u5FD7\u6253\u5370\u5230\u524D\u53F0\u7684\u65B9\u5F0F\uFF0C\u4FBF\u4E8E\u89C2\u5BDF\u8C03\u8BD5\u3002</p><p>\u6B64\u65F6\u5982\u6709\u65E5\u5FD7\u8FC7\u6765\uFF0C\u5219\u53EF\u4EE5\u770B\u5230\u7ECF\u7531logstash\u63A5\u7BA1\u4E4B\u540E\u7684\u65E5\u5FD7\u6837\u5F0F\u5982\u4E0B\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
            <span class="token string">&quot;request_time&quot;</span> =&gt; <span class="token string">&quot;5.495&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;httpversion&quot;</span> =&gt; <span class="token string">&quot;HTTP/1.1&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;request_uri&quot;</span> =&gt; <span class="token string">&quot;/synchrony-proxy/v1/bayeux-sync1&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;server_name&quot;</span> =&gt; <span class="token string">&quot;abc.com&quot;</span><span class="token punctuation">,</span>
                   <span class="token string">&quot;message&quot;</span> =&gt; <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;ip&quot;</span> =&gt; <span class="token string">&quot;10.3.2.12&quot;</span><span class="token punctuation">,</span>
                  <span class="token string">&quot;@version&quot;</span> =&gt; <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
                     <span class="token string">&quot;geoip&quot;</span> =&gt; <span class="token punctuation">{</span>
          <span class="token string">&quot;country_name&quot;</span> =&gt; <span class="token string">&quot;China&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;timezone&quot;</span> =&gt; <span class="token string">&quot;Asia/Shanghai&quot;</span><span class="token punctuation">,</span>
             <span class="token string">&quot;longitude&quot;</span> =&gt; <span class="token number">120.1619</span><span class="token punctuation">,</span>
           <span class="token string">&quot;region_name&quot;</span> =&gt; <span class="token string">&quot;Zhejiang&quot;</span><span class="token punctuation">,</span>
         <span class="token string">&quot;country_code2&quot;</span> =&gt; <span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span>
             <span class="token string">&quot;city_name&quot;</span> =&gt; <span class="token string">&quot;Hangzhou&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;latitude&quot;</span> =&gt; <span class="token number">30.294</span><span class="token punctuation">,</span>
           <span class="token string">&quot;region_code&quot;</span> =&gt; <span class="token string">&quot;ZJ&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;continent_code&quot;</span> =&gt; <span class="token string">&quot;AS&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;ip&quot;</span> =&gt; <span class="token string">&quot;115.239.211.92&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;location&quot;</span> =&gt; <span class="token punctuation">{</span>
            <span class="token string">&quot;lat&quot;</span> =&gt; <span class="token number">30.294</span><span class="token punctuation">,</span>
            <span class="token string">&quot;lon&quot;</span> =&gt; <span class="token number">120.1619</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token string">&quot;country_code3&quot;</span> =&gt; <span class="token string">&quot;CN&quot;</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>\u5185\u5BB9\u6BD4\u8F83\u591A\uFF0C\u8FD9\u91CC\u53EA\u622A\u53D6\u4E86\u6211\u4EEC\u60F3\u8981\u7684\u90E8\u5206\u5185\u5BB9\u8FDB\u884C\u540E\u7EED\u7684\u8BB2\u89E3\u3002</p><p>\u770B\u5230\u9ED8\u8BA4\u7684\u60C5\u51B5\u4E0B\uFF0Cgeoip\u6A21\u5757\u7ED9\u51FA\u7684\u4FE1\u606F\u8FD8\u662F\u5F88\u591A\u7684\uFF0C\u4F46\u5E76\u4E0D\u662F\u6240\u6709\u7684\u90FD\u4F1A\u7528\u5230\uFF0C\u5404\u4F4D\u53EF\u4EE5\u6839\u636E\u81EA\u5DF1\u7684\u9700\u6C42\u8FDB\u884C\u6309\u9700\u914D\u7F6E\u3002</p><p>\u8FD9\u91CC\u53EF\u4EE5\u7528\u5230\u4E24\u4E2A\u5173\u952E\u5B57\uFF1A</p><ul><li><code>fileds</code>\uFF1A\u8868\u793A\u53EA\u4FDD\u7559\u81EA\u5DF1\u60F3\u8981\u7684\u5B57\u6BB5\u3002</li><li><code>remove_field</code>\uFF1A\u8868\u793A\u5220\u9664\u67D0\u4E9B\u4E0D\u60F3\u8981\u7684\u5B57\u6BB5\u3002</li></ul><h3 id="_2-\u6B63\u5F0F\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_2-\u6B63\u5F0F\u914D\u7F6E" aria-hidden="true">#</a> 2\uFF0C\u6B63\u5F0F\u914D\u7F6E</h3><p>\u6839\u636E\u6211\u7684\u5B9E\u9645\u9700\u6C42\uFF0C\u6700\u7EC8\u6211\u7684\u914D\u7F6E\u5982\u4E0B\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>input <span class="token punctuation">{</span>
  kafka <span class="token punctuation">{</span>
    bootstrap_servers  =&gt; <span class="token string">&quot;192.168.3.0:9092&quot;</span>
    group_id          =&gt; <span class="token string">&quot;nginx&quot;</span>
    consumer_threads =&gt; <span class="token number">6</span>
    topics            =&gt; <span class="token string">&quot;nginx&quot;</span>
    codec             =&gt; <span class="token string">&quot;json&quot;</span>
    client_id =&gt; <span class="token string">&quot;nginx&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
filter <span class="token punctuation">{</span>
  geoip <span class="token punctuation">{</span>
    source =&gt; <span class="token string">&quot;remote_addr&quot;</span>
    database =&gt; <span class="token string">&quot;/etc/logstash/GeoLite2-City.mmdb&quot;</span>
    fields =&gt; <span class="token punctuation">[</span><span class="token string">&quot;country_name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;region_name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;city_name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;location&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
output <span class="token punctuation">{</span>
  elasticsearch <span class="token punctuation">{</span>
    hosts =&gt; <span class="token punctuation">[</span><span class="token string">&quot;http://192.168.3.0:9200&quot;</span><span class="token punctuation">]</span>
    index =&gt; <span class="token string">&quot;logstash-nginx-%{+YYYY.MM}&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>\u53EA\u4FDD\u7559\u4E86\u56FD\u5BB6\uFF0C\u7701\u4EFD\uFF0C\u57CE\u5E02\uFF0C\u5750\u6807\u8FD9\u56DB\u4E2A\u4FE1\u606F\uFF0C\u5728\u7ED8\u5236\u5730\u7406\u5750\u6807\u56FE\u7684\u65F6\u5019\uFF0C\u5DF2\u7ECF\u591F\u7528\u4E86\u3002</p><p>\u6B64\u5904\u9700\u8981\u6CE8\u610F\u7684\u4E00\u4E2A\u5730\u65B9\u5C31\u662F\u6700\u540E\u8F93\u51FA\u7684\u7D22\u5F15\u540D\u79F0\uFF0C\u5FC5\u987B\u662F\u4EE5logstash\u5F00\u5934\u624D\u884C\uFF0C\u5426\u5219\u5728kibana\u5F53\u4E2D\u7ED8\u5236\u7684\u65F6\u5019\uFF0C\u5C06\u65E0\u6CD5\u89E3\u6790\u5230IP\u7684\u5750\u6807\u4FE1\u606F\u3002</p><h3 id="_3-\u7ED8\u56FE" tabindex="-1"><a class="header-anchor" href="#_3-\u7ED8\u56FE" aria-hidden="true">#</a> 3\uFF0C\u7ED8\u56FE</h3><p>\u521B\u5EFA\u4E00\u4E2A <code>\u5750\u6807\u5730\u56FE</code>\u7C7B\u578B\u7684\u53EF\u89C6\u5316\uFF0C\u7136\u540E\u9009\u62E9\u5BF9\u5E94\u7684\u7D22\u5F15\uFF0C\u8FDB\u5165\u5230\u914D\u7F6E\u754C\u9762\uFF0C\u6307\u6807\u5C31\u7528\u9ED8\u8BA4\u7684\u8BA1\u6570\uFF0C\u4E3B\u8981\u7684\u914D\u7F6E\u662F\u4E0B\u8FB9\u7684\u5B58\u50A8\u6876\u5F53\u4E2D\uFF0C\u805A\u5408\u9009\u62E9<code>Geohash</code>\uFF0C\u5B57\u6BB5\u9009\u62E9<code>geoip.location</code>\uFF08\u5982\u679C\u6B64\u5904\u770B\u4E0D\u5230\u8FD9\u4E2A\u5B57\u6BB5\uFF0C\u5E94\u8BE5\u5C31\u662F\u4E0A\u8FB9\u6CE8\u610F\u70B9\u6CA1\u6709\u9075\u5B88\uFF0C\u9700\u8981\u8BA9\u7D22\u5F15\u540D\u79F0\u4EE5logstash\u5F00\u5934\uFF09\uFF0C\u7136\u540E\u70B9\u51FB\u64AD\u653E\uFF0C\u5373\u53EF\u770B\u5230\u5BF9\u5E94\u8BBF\u95EE\u70ED\u56FE\u5448\u73B0\u5728\u4E86\u53F3\u4FA7\u5730\u56FE\u5F53\u4E2D\u4E86\u3002</p><p>\u7ED8\u5236\u5730\u7406\u70ED\u56FE\u5982\u4E0B\uFF1A</p><p><img src="http://t.eryajf.net/imgs/2021/09/8d8b6c3a6a429ea3.jpg" alt="image-20191202110445187"></p>`,30);function p(e,o){return t}var l=s(a,[["render",p]]);export{l as default};
