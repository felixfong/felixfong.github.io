import{r as t,o as p,c as r,b as s,a as o,F as l,e as n,d as a}from"./app.dbf5d933.js";import{_ as c}from"./plugin-vue_export-helper.21dcd24c.js";const i={},b=n(`<h2 id="_1-\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#_1-\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> 1\uFF0C\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6</h2><p>\u5C06\u4E0B\u8F7D\u7684 kubernetes-server-linux-amd64.tar.gz \u89E3\u538B\u540E\uFF0C\u518D\u89E3\u538B\u5176\u4E2D\u7684 kubernetes-src.tar.gz \u6587\u4EF6\u3002</p><p>dashboard \u5BF9\u5E94\u7684\u76EE\u5F55\u662F\uFF1A<code>cluster/addons/dashboard</code>\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token variable">$pwd</span>
/home/k8s/k8s/kubernetes/cluster/addons/dashboard
$ <span class="token function">cp</span> dashboard-controller.yaml<span class="token punctuation">{</span>,.orig<span class="token punctuation">}</span>
<span class="token comment">#\u4FEE\u6539\u7B2C33\u884C\u955C\u50CFtag\uFF0C\u5E76pull\u597D\u81EA\u5DF1\u5B9A\u4E49\u7684\u5BF9\u5E94tag\u7684\u955C\u50CF\u3002</span>
$ <span class="token function">vim</span> dashboard-controller.yaml
<span class="token comment">#\u4FEE\u6539\u524D\u540E\u5BF9\u6BD4</span>
<span class="token variable">$diff</span> dashboard-controller.yaml<span class="token punctuation">{</span>,.orig<span class="token punctuation">}</span>
33c33
<span class="token operator">&lt;</span>         image: cnych/kubernetes-dashboard-amd64:v1.8.3
---
<span class="token operator">&gt;</span>         image: k8s.gcr.io/kubernetes-dashboard-amd64:v1.8.3
$ <span class="token function">cp</span> dashboard-service.yaml<span class="token punctuation">{</span>,.orig<span class="token punctuation">}</span>
<span class="token comment">#\u5728\u7B2C\u5341\u4E00\u884C\u6DFB\u52A0\u4E00\u4E2Alabels\uFF0C\u5B9A\u4E49\u7AEF\u53E3\u7C7B\u578B\u4E3ANodePort\u3002</span>
$ <span class="token function">vim</span> dashboard-service.yaml
<span class="token comment">#\u4FEE\u6539\u524D\u540E\u5BF9\u6BD4</span>
$ <span class="token function">diff</span> dashboard-service.yaml.orig dashboard-service.yaml
10a11
<span class="token operator">&gt;</span>   type: NodePort
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li>\u6307\u5B9A\u7AEF\u53E3\u7C7B\u578B\u4E3A NodePort\uFF0C\u8FD9\u6837\u5916\u754C\u53EF\u4EE5\u901A\u8FC7\u5730\u5740 nodeIP:nodePort \u8BBF\u95EE dashboard\u3002</li></ul><h2 id="_2-\u6267\u884C\u6240\u6709\u5B9A\u4E49\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#_2-\u6267\u884C\u6240\u6709\u5B9A\u4E49\u6587\u4EF6" aria-hidden="true">#</a> 2\uFF0C\u6267\u884C\u6240\u6709\u5B9A\u4E49\u6587\u4EF6</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">ls</span> *.yaml
dashboard-configmap.yaml  dashboard-controller.yaml  dashboard-rbac.yaml  dashboard-secret.yaml  dashboard-service.yaml
$ kubectl create -f  <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_3-\u67E5\u770B\u5206\u914D\u7684-nodeport" tabindex="-1"><a class="header-anchor" href="#_3-\u67E5\u770B\u5206\u914D\u7684-nodeport" aria-hidden="true">#</a> 3\uFF0C\u67E5\u770B\u5206\u914D\u7684 NodePort</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token variable">$kubectl</span> get deployment kubernetes-dashboard  -n kube-system
NAME                   DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
kubernetes-dashboard   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>            <span class="token number">1</span>           15h
<span class="token variable">$kubectl</span> --namespace kube-system get pods -o wide
NAME                                    READY     STATUS    RESTARTS   AGE       IP            NODE
coredns-77c989547b-j77lp                <span class="token number">1</span>/1       Running   <span class="token number">0</span>          15h       <span class="token number">172.30</span>.84.3   kube-node1
coredns-77c989547b-t6mxc                <span class="token number">1</span>/1       Running   <span class="token number">0</span>          15h       <span class="token number">172.30</span>.29.3   kube-node3
kubernetes-dashboard-5bb8d4d76c-8kkwt   <span class="token number">1</span>/1       Running   <span class="token number">0</span>          15h       <span class="token number">172.30</span>.84.5   kube-node1
<span class="token variable">$kubectl</span> get svc kubernetes-dashboard -n kube-system
NAME                   TYPE       CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
kubernetes-dashboard   NodePort   <span class="token number">10.254</span>.147.2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>:8605/TCP   15h
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>dashboard pod 443 \u7AEF\u53E3\u901A\u8FC7 NodePort \u6620\u5C04\u5230 node \u7684 8605 \u7AEF\u53E3\u3002</li></ul><p>dashboard \u7684 --authentication-mode \u652F\u6301 token\u3001basic\uFF0C\u9ED8\u8BA4\u4E3A token\u3002\u5982\u679C\u4F7F\u7528 basic\uFF0C\u5219 kube-apiserver \u5FC5\u987B\u914D\u7F6E \u2018--authorization-mode=ABAC\u2019 \u548C \u2018--basic-auth-file\u2019 \u53C2\u6570\u3002</p><h2 id="_4-\u67E5\u770B-dashboard-\u652F\u6301\u7684\u547D\u4EE4\u884C\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#_4-\u67E5\u770B-dashboard-\u652F\u6301\u7684\u547D\u4EE4\u884C\u53C2\u6570" aria-hidden="true">#</a> 4\uFF0C\u67E5\u770B dashboard \u652F\u6301\u7684\u547D\u4EE4\u884C\u53C2\u6570</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token variable">$kubectl</span> <span class="token builtin class-name">exec</span> --namespace kube-system -it kubernetes-dashboard-5bb8d4d76c-8kkwt  -- /dashboard --help
<span class="token number">2018</span>/11/24 04:04:18 Starting overwatch
Usage of /dashboard:
      --alsologtostderr                   log to standard error as well as files
      --apiserver-host string             The address of the Kubernetes Apiserver to connect to <span class="token keyword">in</span> the <span class="token function">format</span> of protocol://address:port, e.g., http://localhost:8080. If not specified, the assumption is that the binary runs inside a Kubernetes cluster and <span class="token builtin class-name">local</span> discovery is attempted.
      --authentication-mode stringSlice   Enables authentication options that will be reflected on login screen. Supported values: token, basic. Default: token.Note that basic option should only be used <span class="token keyword">if</span> apiserver has <span class="token string">&#39;--authorization-mode=ABAC&#39;</span> and <span class="token string">&#39;--basic-auth-file&#39;</span> flags set. <span class="token punctuation">(</span>default <span class="token punctuation">[</span>token<span class="token punctuation">]</span><span class="token punctuation">)</span>
      --auto-generate-certificates        When <span class="token builtin class-name">set</span> to true, Dashboard will automatically generate certificates used to serve HTTPS. Default: false.
      --bind-address <span class="token function">ip</span>                   The IP address on <span class="token function">which</span> to serve the --secure-port <span class="token punctuation">(</span>set to <span class="token number">0.0</span>.0.0 <span class="token keyword">for</span> all interfaces<span class="token punctuation">)</span>. <span class="token punctuation">(</span>default <span class="token number">0.0</span>.0.0<span class="token punctuation">)</span>
      --default-cert-dir string           Directory path containing <span class="token string">&#39;--tls-cert-file&#39;</span> and <span class="token string">&#39;--tls-key-file&#39;</span> files. Used also when auto-generating certificates flag is set. <span class="token punctuation">(</span>default <span class="token string">&quot;/certs&quot;</span><span class="token punctuation">)</span>
      --disable-settings-authorizer       When enabled, Dashboard settings page will not require user to be logged <span class="token keyword">in</span> and authorized to access settings page.
      --enable-insecure-login             When enabled, Dashboard login view will also be shown when Dashboard is not served over HTTPS. Default: false.
      --heapster-host string              The address of the Heapster Apiserver to connect to <span class="token keyword">in</span> the <span class="token function">format</span> of protocol://address:port, e.g., http://localhost:8082. If not specified, the assumption is that the binary runs inside a Kubernetes cluster and <span class="token function">service</span> proxy will be used.
      --insecure-bind-address <span class="token function">ip</span>          The IP address on <span class="token function">which</span> to serve the --port <span class="token punctuation">(</span>set to <span class="token number">0.0</span>.0.0 <span class="token keyword">for</span> all interfaces<span class="token punctuation">)</span>. <span class="token punctuation">(</span>default <span class="token number">127.0</span>.0.1<span class="token punctuation">)</span>
      --insecure-port int                 The port to listen to <span class="token keyword">for</span> incoming HTTP requests. <span class="token punctuation">(</span>default <span class="token number">9090</span><span class="token punctuation">)</span>
      --kubeconfig string                 Path to kubeconfig <span class="token function">file</span> with authorization and master location information.
      --log_backtrace_at traceLocation    when logging hits line file:N, emit a stack trace <span class="token punctuation">(</span>default :0<span class="token punctuation">)</span>
      --log_dir string                    If non-empty, <span class="token function">write</span> log files <span class="token keyword">in</span> this directory
      --logtostderr                       log to standard error instead of files
      --metric-client-check-period int    Time <span class="token keyword">in</span> seconds that defines how often configured metric client health check should be run. Default: <span class="token number">30</span> seconds. <span class="token punctuation">(</span>default <span class="token number">30</span><span class="token punctuation">)</span>
      --port int                          The secure port to listen to <span class="token keyword">for</span> incoming HTTPS requests. <span class="token punctuation">(</span>default <span class="token number">8443</span><span class="token punctuation">)</span>
      --stderrthreshold severity          logs at or above this threshold go to stderr <span class="token punctuation">(</span>default <span class="token number">2</span><span class="token punctuation">)</span>
      --system-banner string              When non-empty displays message to Dashboard users. Accepts simple HTML tags. Default: <span class="token string">&#39;&#39;</span><span class="token builtin class-name">.</span>
      --system-banner-severity string     Severity of system banner. Should be one of <span class="token string">&#39;INFO|WARNING|ERROR&#39;</span><span class="token builtin class-name">.</span> Default: <span class="token string">&#39;INFO&#39;</span><span class="token builtin class-name">.</span> <span class="token punctuation">(</span>default <span class="token string">&quot;INFO&quot;</span><span class="token punctuation">)</span>
      --tls-cert-file string              File containing the default x509 Certificate <span class="token keyword">for</span> HTTPS.
      --tls-key-file string               File containing the default x509 private key matching --tls-cert-file.
      --token-ttl int                     Expiration <span class="token function">time</span> <span class="token punctuation">(</span>in seconds<span class="token punctuation">)</span> of JWE tokens generated by dashboard. Default: <span class="token number">15</span> min. <span class="token number">0</span> - never expires <span class="token punctuation">(</span>default <span class="token number">900</span><span class="token punctuation">)</span>
  -v, --v Level                           log level <span class="token keyword">for</span> V logs
      --vmodule moduleSpec                comma-separated list of <span class="token assign-left variable">pattern</span><span class="token operator">=</span>N settings <span class="token keyword">for</span> file-filtered logging
<span class="token builtin class-name">command</span> terminated with <span class="token builtin class-name">exit</span> code <span class="token number">2</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="_5-\u8BBF\u95EE-dashboard" tabindex="-1"><a class="header-anchor" href="#_5-\u8BBF\u95EE-dashboard" aria-hidden="true">#</a> 5\uFF0C\u8BBF\u95EE dashboard</h2><p>\u4E3A\u4E86\u96C6\u7FA4\u5B89\u5168\uFF0C\u4ECE 1.7 \u5F00\u59CB\uFF0Cdashboard \u53EA\u5141\u8BB8\u901A\u8FC7 https \u8BBF\u95EE\uFF0C\u5982\u679C\u4F7F\u7528 kube proxy \u5219\u5FC5\u987B\u76D1\u542C localhost \u6216 127.0.0.1\uFF0C\u5BF9\u4E8E NodePort \u6CA1\u6709\u8FD9\u4E2A\u9650\u5236\uFF0C\u4F46\u662F\u4EC5\u5EFA\u8BAE\u5728\u5F00\u53D1\u73AF\u5883\u4E2D\u4F7F\u7528\u3002</p><p>\u5BF9\u4E8E\u4E0D\u6EE1\u8DB3\u8FD9\u4E9B\u6761\u4EF6\u7684\u767B\u5F55\u8BBF\u95EE\uFF0C\u5728\u767B\u5F55\u6210\u529F\u540E<strong>\u6D4F\u89C8\u5668\u4E0D\u8DF3\u8F6C\uFF0C\u59CB\u7EC8\u505C\u5728\u767B\u5F55\u754C\u9762</strong>\u3002</p><p>\u53C2\u8003\uFF1A https://github.com/kubernetes/dashboard/wiki/Accessing-Dashboard\u20141.7.X-and-above https://github.com/kubernetes/dashboard/issues/2540</p><ul><li>kubernetes-dashboard \u670D\u52A1\u66B4\u9732\u4E86 NodePort\uFF0C\u53EF\u4EE5\u4F7F\u7528 <code>https://NodeIP:NodePort</code> \u5730\u5740\u8BBF\u95EE dashboard\uFF1B</li><li>\u901A\u8FC7 kube-apiserver \u8BBF\u95EE dashboard\uFF1B</li><li>\u901A\u8FC7 kubectl proxy \u8BBF\u95EE dashboard\uFF1A</li></ul><h3 id="_1-\u901A\u8FC7-kubectl-proxy-\u8BBF\u95EE-dashboard-\u4E86\u89E3" tabindex="-1"><a class="header-anchor" href="#_1-\u901A\u8FC7-kubectl-proxy-\u8BBF\u95EE-dashboard-\u4E86\u89E3" aria-hidden="true">#</a> 1\uFF0C\u901A\u8FC7 kubectl proxy \u8BBF\u95EE dashboard\uFF08\u4E86\u89E3\uFF09</h3><p>\u542F\u52A8\u4EE3\u7406\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl proxy --address<span class="token operator">=</span><span class="token string">&#39;localhost&#39;</span> --port<span class="token operator">=</span><span class="token number">8086</span> --accept-hosts<span class="token operator">=</span><span class="token string">&#39;^*$&#39;</span>
Starting to serve on <span class="token number">127.0</span>.0.1:8086
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>--address \u5FC5\u987B\u4E3A localhost \u6216 127.0.0.1\uFF1B</li><li>\u9700\u8981\u6307\u5B9A <code>\\--accept-hosts</code> \u9009\u9879\uFF0C\u5426\u5219\u6D4F\u89C8\u5668\u8BBF\u95EE dashboard \u9875\u9762\u65F6\u63D0\u793A \u201CUnauthorized\u201D\uFF1B</li></ul><p>\u6D4F\u89C8\u5668\u8BBF\u95EE URL\uFF1A<code>http://127.0.0.1:8086/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy</code></p><h3 id="_2-\u901A\u8FC7-kube-apiserver-\u8BBF\u95EE-dashboard-\u5E94\u7528" tabindex="-1"><a class="header-anchor" href="#_2-\u901A\u8FC7-kube-apiserver-\u8BBF\u95EE-dashboard-\u5E94\u7528" aria-hidden="true">#</a> 2\uFF0C\u901A\u8FC7 kube-apiserver \u8BBF\u95EE dashboard\uFF08\u5E94\u7528\uFF09</h3><p>\u83B7\u53D6\u96C6\u7FA4\u670D\u52A1\u5730\u5740\u5217\u8868\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token variable">$kubectl</span> cluster-info
Kubernetes master is running at https://192.168.106.110:8443
CoreDNS is running at https://192.168.106.110:8443/api/v1/namespaces/kube-system/services/coredns:dns/proxy
kubernetes-dashboard is running at https://192.168.106.110:8443/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy
To further debug and diagnose cluster problems, use <span class="token string">&#39;kubectl cluster-info dump&#39;</span><span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u5FC5\u987B\u901A\u8FC7 kube-apiserver \u7684\u5B89\u5168\u7AEF\u53E3 (https) \u8BBF\u95EE dashbaord\uFF0C\u8BBF\u95EE\u65F6\u6D4F\u89C8\u5668\u9700\u8981\u4F7F\u7528<strong>\u81EA\u5B9A\u4E49\u8BC1\u4E66</strong>\uFF0C\u5426\u5219\u4F1A\u88AB kube-apiserver \u62D2\u7EDD\u8BBF\u95EE\u3002</p>`,27),u=a("\u521B\u5EFA\u548C\u5BFC\u5165\u81EA\u5B9A\u4E49\u8BC1\u4E66\u7684\u6B65\u9AA4\uFF0C\u53C2\u8003\uFF1A"),d={href:"https://wiki.eryajf.net/pages/2186.html",target:"_blank",rel:"noopener noreferrer"},k=a("A. \u6D4F\u89C8\u5668\u8BBF\u95EE kube-apiserver \u5B89\u5168\u7AEF\u53E3"),h=n(`<p>\u6D4F\u89C8\u5668\u8BBF\u95EE URL\uFF1A<code>https://172.27.129.105:6443/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/</code> \u5BF9\u4E8E virtuabox \u505A\u4E86\u7AEF\u53E3\u6620\u5C04\uFF1A <code>http://127.0.0.1:6443/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/</code></p><p>\u73B0\u5728\uFF0C\u76F4\u63A5\u4F7F\u7528\u521A\u521A\u901A\u8FC7<code>kubectl cluster-info</code>\u83B7\u53D6\u5230\u7684\u5730\u5740\u8FDB\u884C\u8BBF\u95EE\uFF1A</p><p><img src="http://t.eryajf.net/imgs/2021/09/85802da360049b22.jpg" alt="image"></p><h2 id="_6-\u521B\u5EFA\u767B\u5F55-dashboard-\u7684-token-\u548C-kubeconfig-\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#_6-\u521B\u5EFA\u767B\u5F55-dashboard-\u7684-token-\u548C-kubeconfig-\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> 6\uFF0C\u521B\u5EFA\u767B\u5F55 Dashboard \u7684 token \u548C kubeconfig \u914D\u7F6E\u6587\u4EF6</h2><p>\u4E0A\u9762\u63D0\u5230\uFF0CDashboard \u9ED8\u8BA4\u53EA\u652F\u6301 token \u8BA4\u8BC1\uFF0C\u6240\u4EE5\u5982\u679C\u4F7F\u7528 KubeConfig \u6587\u4EF6\uFF0C\u9700\u8981\u5728\u8BE5\u6587\u4EF6\u4E2D\u6307\u5B9A token\uFF0C\u4E0D\u652F\u6301\u4F7F\u7528 client \u8BC1\u4E66\u8BA4\u8BC1\u3002</p><h3 id="_1-\u521B\u5EFA\u767B\u5F55-token" tabindex="-1"><a class="header-anchor" href="#_1-\u521B\u5EFA\u767B\u5F55-token" aria-hidden="true">#</a> 1\uFF0C\u521B\u5EFA\u767B\u5F55 token</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl create sa dashboard-admin -n kube-system
$ kubectl create clusterrolebinding dashboard-admin --clusterrole<span class="token operator">=</span>cluster-admin --serviceaccount<span class="token operator">=</span>kube-system:dashboard-admin
$ <span class="token assign-left variable">ADMIN_SECRET</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl get secrets -n kube-system <span class="token operator">|</span> <span class="token function">grep</span> dashboard-admin <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $1}&#39;</span><span class="token variable">)</span></span>
$ <span class="token assign-left variable">DASHBOARD_LOGIN_TOKEN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl describe secret -n kube-system $<span class="token punctuation">{</span>ADMIN_SECRET<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token function">grep</span> -E <span class="token string">&#39;^token&#39;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $2}&#39;</span><span class="token variable">)</span></span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">\${DASHBOARD_LOGIN_TOKEN}</span>
eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4tbGJ4d2giLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiYjBlYzMyMWMtZWYxYi0xMWU4LTk2NzAtNTI1NDAwYzdiYTk3Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRhc2hib2FyZC1hZG1pbiJ9.g_llVGHmryCqQ61BdDlQJ4tsuX1bEg3hzYCZb_cvoz6RkNgPt85QUQJSKymXvpzFYv8sq09jR6hrkgJ8rJpSMVSgbOswu_w5aV9RbiLaquv0d9m6WDR7FGgDGAZxYf8ag0DDzHesnAOUuNnSweklbQTbyB90X5Okff8332PemnMzcZzZP4je70T-OTyCHygcckWji_ZEEC5k3WXRwEhMMZO5cWVAuneNCpVSEJOKw1jRei8CC26FcPVm4vU24u3b0xQDeE6gFya2zIsJPMyaWVKhx_CtIh-uwSbf8SiRBzk767BBFye3sEG-D5NPrq65eB1wDNOOE8YxzomMwtR5aA
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u5C06\u4E0A\u8FB9\u8F93\u51FA\u7684 token \u8F93\u5165\u5230\u521A\u521A dashboard \u9700\u8981\u9A8C\u8BC1\u7684\u754C\u9762\uFF0C\u70B9\u51FB\u4EE4\u724C\uFF0C\u7136\u540E\u590D\u5236\u8FDB\u53BB</p><p><img src="http://t.eryajf.net/imgs/2021/09/50ed2c37bae72291.jpg" alt="image"></p><p>\u70B9\u51FB\u767B\u5F55\u5373\u53EF\u8BBF\u95EE\u9996\u9875\u4E86\u3002</p><p><img src="http://t.eryajf.net/imgs/2021/09/fe5947762ab65405.jpg" alt="image"></p><h3 id="_2-\u521B\u5EFA\u4F7F\u7528-token-\u7684-kubeconfig-\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#_2-\u521B\u5EFA\u4F7F\u7528-token-\u7684-kubeconfig-\u6587\u4EF6" aria-hidden="true">#</a> 2\uFF0C\u521B\u5EFA\u4F7F\u7528 token \u7684 KubeConfig \u6587\u4EF6</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token builtin class-name">source</span> /opt/k8s/bin/environment.sh
<span class="token comment"># \u8BBE\u7F6E\u96C6\u7FA4\u53C2\u6570</span>
$ kubectl config set-cluster kubernetes <span class="token punctuation">\\</span>
  --certificate-authority<span class="token operator">=</span>/etc/kubernetes/cert/ca.pem <span class="token punctuation">\\</span>
  --embed-certs<span class="token operator">=</span>true <span class="token punctuation">\\</span>
  --server<span class="token operator">=</span><span class="token variable">\${KUBE_APISERVER}</span> <span class="token punctuation">\\</span>
  --kubeconfig<span class="token operator">=</span>dashboard.kubeconfig
<span class="token comment"># \u8BBE\u7F6E\u5BA2\u6237\u7AEF\u8BA4\u8BC1\u53C2\u6570\uFF0C\u4F7F\u7528\u4E0A\u9762\u521B\u5EFA\u7684 Token</span>
$ kubectl config set-credentials dashboard_user <span class="token punctuation">\\</span>
  --token<span class="token operator">=</span><span class="token variable">\${DASHBOARD_LOGIN_TOKEN}</span> <span class="token punctuation">\\</span>
  --kubeconfig<span class="token operator">=</span>dashboard.kubeconfig
<span class="token comment"># \u8BBE\u7F6E\u4E0A\u4E0B\u6587\u53C2\u6570</span>
$ kubectl config set-context default <span class="token punctuation">\\</span>
  --cluster<span class="token operator">=</span>kubernetes <span class="token punctuation">\\</span>
  --user<span class="token operator">=</span>dashboard_user <span class="token punctuation">\\</span>
  --kubeconfig<span class="token operator">=</span>dashboard.kubeconfig
<span class="token comment"># \u8BBE\u7F6E\u9ED8\u8BA4\u4E0A\u4E0B\u6587</span>
$ kubectl config use-context default --kubeconfig<span class="token operator">=</span>dashboard.kubeconfig
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>\u5C06\u5982\u4E0A\u64CD\u4F5C\u6240\u751F\u6210\u7684 dashboard.kubeconfig \u4E0B\u8F7D\u5230\u672C\u5730\uFF0C\u7136\u540E\u5728\u767B\u5F55\u754C\u9762\uFF0C\u9009\u62E9 kubeconfig \u7684\u65B9\u5F0F\uFF0C\u5C06\u521A\u521A\u672C\u5730\u7684 config \u6587\u4EF6\u5BFC\u5165\u8FDB\u6765\uFF0C\u70B9\u51FB\u767B\u5F55\u767B\u5165\u5230 Dashboard\u3002</p><p><img src="http://t.eryajf.net/imgs/2021/09/3fe3af853170c510.jpg" alt="image"></p><p>\u7531\u4E8E\u7F3A\u5C11 Heapster \u63D2\u4EF6\uFF0C\u5F53\u524D dashboard \u4E0D\u80FD\u5C55\u793A Pod\u3001Nodes \u7684 CPU\u3001\u5185\u5B58\u7B49\u7EDF\u8BA1\u6570\u636E\u548C\u56FE\u8868\u3002</p><h2 id="_7-\u53C2\u8003" tabindex="-1"><a class="header-anchor" href="#_7-\u53C2\u8003" aria-hidden="true">#</a> 7\uFF0C\u53C2\u8003</h2><p>https://github.com/kubernetes/dashboard/wiki/Access-control https://github.com/kubernetes/dashboard/issues/2558 https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/</p>`,18);function m(g,f){const e=t("ExternalLinkIcon");return p(),r(l,null,[b,s("p",null,[u,s("a",d,[k,o(e)])]),h],64)}var _=c(i,[["render",m]]);export{_ as default};
