import{e as n}from"./app.dbf5d933.js";import{_ as s}from"./plugin-vue_export-helper.21dcd24c.js";const a={},p=n(`<h2 id="_1-\u524D\u8A00" tabindex="-1"><a class="header-anchor" href="#_1-\u524D\u8A00" aria-hidden="true">#</a> 1\uFF0C\u524D\u8A00</h2><p>\u5C06\u8981\u653E\u5047\u524D\u5915\uFF0C\u4E00\u4E2A\u540C\u4E8B\u8FC7\u6765\u8BF4\uFF0C\u67D0\u67D0\u65E5\u5FD7\u5728kafka\u91CC\u8FB9\u4E0D\u6D88\u8D39\u4E86\uFF0C\u6211\u4E00\u5F00\u59CB\u6CA1\u5728\u610F\uFF0C\u53BBkafka\u7684\u76D1\u63A7\u4E00\u770B\uFF0C\u679C\u7136\u662F\u5806\u79EF\u4E86\u4E0D\u5C11\u3002</p><p>\u8FD9\u4E2A\u65F6\u5019\u9996\u5148\u68C0\u67E5\u4E86\u4E00\u6CE2logstash\u7684\u60C5\u51B5\uFF0C\u56E0\u4E3A\u65E5\u5E38\u53D8\u66F4\u4E5F\u5C31\u5B83\u4E86\uFF0C\u5176\u4ED6\u7EC4\u4EF6\u4E00\u822C\u90FD\u662F\u6CA1\u4EBA\u8C03\u6574\u7684\uFF0C\u4F46\u662F\u770B\u4E86\u4E00\u5708\uFF0C\u597D\u50CF\u8FD9\u4E2A\u65F6\u95F4\u70B9\u4E5F\u6CA1\u4EBA\u505A\u53D8\u66F4\uFF0C\u53EA\u662F\u5728\u65E5\u5FD7\u91CC\u770B\u5230\u4E00\u4E9B\u7D22\u5F15\u5728\u4E0E\u67D0\u5904\u5EFA\u8054\u7684\u65F6\u5019\u6709\u62D2\u7EDD\u7684\u60C5\u51B5\u3002</p><p>\u6B64\u65F6\u60F3\u7740\u53BB\u770B\u770Bkafka\u96C6\u7FA4\uFF0C\u662F\u4E0D\u662F\u6709\u4EC0\u4E48\u95EE\u9898\u5462\uFF0C\u53EF\u662F\u4ECEkafka\u81EA\u8EAB\u65E5\u5FD7\u5F53\u4E2D\u770B\u4E86\u4E00\u5708\uFF0C\u5E76\u6CA1\u6709\u53D1\u73B0\u4EFB\u4F55\u5F02\u5E38\u4FE1\u606F\uFF0C\u51B5\u4E14\u540C\u65F6\u6BB5\u60C5\u51B5\u4E0B\uFF0C\u53E6\u4E00\u4E2A\u65E5\u5FD7\u96C6\u7FA4\u5171\u7528\u8FD9\u5957kafka\uFF0C\u8FD8\u5728\u6B63\u5E38\u6D88\u8D39\uFF0C\u8BF4\u660E\u8FD9\u6761\u7EBF\u5E94\u8BE5\u6CA1\u95EE\u9898\u3002</p><h2 id="_2-\u5BFB\u56E0" tabindex="-1"><a class="header-anchor" href="#_2-\u5BFB\u56E0" aria-hidden="true">#</a> 2\uFF0C\u5BFB\u56E0</h2><p>\u5F53\u6211\u5728\u76D1\u63A7\u4E2D\u6392\u9664\u521A\u521A\u90A3\u4E2A\u7D22\u5F15\u7684\u6D88\u8D39\u60C5\u51B5\uFF0C\u53EF\u4EE5\u770B\u5230\u5176\u4ED6\u65E5\u5FD7\u4E5F\u6709\u4E0A\u626C\u5806\u79EF\u7684\u60C5\u51B5\uFF0C\u5982\u6B64\u770B\u6765\uFF0C\u5E94\u8BE5\u662Fes\u90A3\u5757\u513F\u6709\u95EE\u9898\u4E86\uFF0C\u4E8E\u662F\u5F00\u59CB\u4ECE\u67E5es\u8FD0\u884C\u65E5\u5FD7\u5F00\u59CB\u5165\u624B\uFF0C\u5F88\u5FEB\uFF0C\u5728master\u8282\u70B9\u770B\u5230\u4E86\u5982\u4E0B\u65E5\u5FD7\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span><span class="token number">2020</span>-06-24T17:17:19,548<span class="token punctuation">]</span><span class="token punctuation">[</span>WARN <span class="token punctuation">]</span><span class="token punctuation">[</span>o.e.x.m.e.l.LocalExporter<span class="token punctuation">]</span> <span class="token punctuation">[</span>log-center-c2-1<span class="token punctuation">]</span> unexpected error <span class="token keyword">while</span> indexing monitoring document
org.elasticsearch.xpack.monitoring.exporter.ExportException: ClusterBlockException<span class="token punctuation">[</span>blocked by: <span class="token punctuation">[</span>FORBIDDEN/12/index read-only / allow delete <span class="token punctuation">(</span>api<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">]</span>
        at org.elasticsearch.xpack.monitoring.exporter.local.LocalBulk.lambda<span class="token variable">$throwExportException</span><span class="token variable">$2</span><span class="token punctuation">(</span>LocalBulk.java:128<span class="token punctuation">)</span> ~<span class="token punctuation">[</span>?:?<span class="token punctuation">]</span>
        at java.util.stream.ReferencePipeline<span class="token variable">$3</span><span class="token variable">$1</span>.accept<span class="token punctuation">(</span>ReferencePipeline.java:193<span class="token punctuation">)</span> ~<span class="token punctuation">[</span>?:1.8.0_121<span class="token punctuation">]</span>
        at java.util.stream.ReferencePipeline<span class="token variable">$2</span><span class="token variable">$1</span>.accept<span class="token punctuation">(</span>ReferencePipeline.java:175<span class="token punctuation">)</span> ~<span class="token punctuation">[</span>?:1.8.0_121<span class="token punctuation">]</span>
        at java.util.Spliterators<span class="token variable">$ArraySpliterator</span>.forEachRemaining<span class="token punctuation">(</span>Spliterators.java:948<span class="token punctuation">)</span> ~<span class="token punctuation">[</span>?:1.8.0_121<span class="token punctuation">]</span>
        <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token punctuation">[</span><span class="token number">2020</span>-06-24T17:17:19,550<span class="token punctuation">]</span><span class="token punctuation">[</span>WARN <span class="token punctuation">]</span><span class="token punctuation">[</span>o.e.x.m.MonitoringService<span class="token punctuation">]</span> <span class="token punctuation">[</span>log-center-c2-1<span class="token punctuation">]</span> monitoring execution failed
org.elasticsearch.xpack.monitoring.exporter.ExportException: Exception when closing <span class="token builtin class-name">export</span> bulk
        at org.elasticsearch.xpack.monitoring.exporter.ExportBulk<span class="token variable">$1</span><span class="token variable">$1</span>.<span class="token operator">&lt;</span>init<span class="token operator">&gt;</span><span class="token punctuation">(</span>ExportBulk.java:95<span class="token punctuation">)</span> ~<span class="token punctuation">[</span>?:?<span class="token punctuation">]</span>
        at org.elasticsearch.xpack.monitoring.exporter.ExportBulk<span class="token variable">$1</span>.onFailure<span class="token punctuation">(</span>ExportBulk.java:93<span class="token punctuation">)</span> ~<span class="token punctuation">[</span>?:?<span class="token punctuation">]</span>
        at org.elasticsearch.xpack.monitoring.exporter.ExportBulk<span class="token variable">$Compound</span><span class="token variable">$1</span>.onResponse<span class="token punctuation">(</span>ExportBulk.java:206<span class="token punctuation">)</span> ~<span class="token punctuation">[</span>?:?<span class="token punctuation">]</span>
        <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>\u4E4B\u524D\u5E76\u6CA1\u6709\u9047\u5230\u8FC7\u8FD9\u4E2A\u95EE\u9898\uFF0C\u4E0D\u8FC7\u770B\u5230\u4E86\u5173\u952E\u5B57read-only\uFF0C\u67E5\u4E86\u4E00\u4E0B\u8BF4\u662F\u6709\u4E3B\u673A\u78C1\u76D8\u5230\u8FBE\u6C34\u4F4D\u7EBF\u4E86\uFF0C\u4ECE\u800C\u89E6\u53D1es\u81EA\u8EAB\u4FDD\u62A4\u673A\u5236\uFF0C\u4F7F\u7D22\u5F15\u53EA\u8BFB\uFF0C\u4EE5\u9632\u88AB\u7206\u6389\u3002</p><p>\u901A\u8FC7\u5728kibana\u63A7\u5236\u53F0Dev\u5DE5\u5177\u53EF\u4EE5\u770B\u5230\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>GET _settings
......
<span class="token property">&quot;set_099&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;settings&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;index&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;number_of_shards&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;blocks&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;read_only_allow_delete&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;true&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;provided_name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;set_099&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;creation_date&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1573130020809&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;number_of_replicas&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;uuid&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;L_gtQfu0SWq6oAcV35_pOQ&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;version&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;created&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;6050499&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
.......
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>\u6B64\u5904\u4E5F\u53EF\u4EE5\u770B\u5230\u597D\u591A\u7D22\u5F15\u7684 <code>read_only_allow_delete</code>\u503C\u53D8\u6210\u4E86true\uFF0C\u8868\u793A\u5BF9\u5E94\u7D22\u5F15\u5DF2\u7ECF\u65E0\u6CD5\u5199\u5165\u3002</p><h2 id="_3-\u89E3\u51B3" tabindex="-1"><a class="header-anchor" href="#_3-\u89E3\u51B3" aria-hidden="true">#</a> 3\uFF0C\u89E3\u51B3</h2><p>\u89E3\u51B3\u65B9\u6CD5\u53EF\u901A\u8FC7\u5982\u4E0B\u547D\u4EE4\u5C06\u6240\u6709\u7684\u7D22\u5F15\u7F6E\u4E3A\u53EF\u5199\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>PUT _settings
<span class="token punctuation">{</span>
    <span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;blocks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;read_only_allow_delete&quot;</span><span class="token operator">:</span> <span class="token string">&quot;false&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u5982\u679C\u6B64\u65F6kibana\u65E0\u6CD5\u8FDB\u5165\uFF0C\u4E5F\u53EF\u4EE5\u5C06\u5982\u4E0A\u547D\u4EE4\u8F6C\u4E3Acurl\u65B9\u5F0F\u8FDB\u884C\u914D\u7F6E\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>curl -XPUT <span class="token string">&quot;http://localhost:9200/_settings&quot;</span> -H &#39;Content-Type<span class="token operator">:</span> application/json&#39; -d&#39;
<span class="token punctuation">{</span>
    <span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;blocks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;read_only_allow_delete&quot;</span><span class="token operator">:</span> <span class="token string">&quot;false&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>&#39;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u5F53\u7136\u8FD9\u79CD\u89E3\u51B3\u53EA\u662F\u4E34\u65F6\u89E3\u9664\u9650\u5236\uFF0C\u771F\u6B63\u5BFC\u81F4\u8FD9\u4E2A\u60C5\u51B5\u7684\u6839\u56E0\u8FD8\u662F\u8981\u89E3\u51B3\u7684\u3002</p><p><img src="http://t.eryajf.net/imgs/2021/09/11153a1a02d9dd86.jpg" alt="img"></p><h2 id="_4-\u518D\u63A2" tabindex="-1"><a class="header-anchor" href="#_4-\u518D\u63A2" aria-hidden="true">#</a> 4\uFF0C\u518D\u63A2</h2><p>\u901A\u8FC7\u6267\u884C\u5982\u4E0B\u547D\u4EE4\uFF0C\u6211\u4EEC\u53EF\u4EE5\u83B7\u5F97\u5982\u4E0B\u4FE1\u606F\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>GET _cluster/settings
.......
    <span class="token property">&quot;cluster&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;routing&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;allocation&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;disk&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;watermark&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;low&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;90%&quot;</span><span class="token punctuation">,</span>
              <span class="token property">&quot;high&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;95%&quot;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
.......
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>\u6B64\u5904\u7684 <code>watermark</code>\u5C31\u8868\u793A\u78C1\u76D8\u7684\u6C34\u4F4D\u7EBF\uFF0C\u6211\u4EEC\u770B\u5230\u6709\u4E00\u4E2Alow\u548Chigh\uFF0C\u5F53\u78C1\u76D8\u7A7A\u95F4\u8FBE\u5230high\u7684\u754C\u7EBF\uFF0C\u5C31\u4F1A\u89E6\u53D1es\u96C6\u7FA4\u5C06\u8BE5\u8282\u70B9\u4E0A\u5B58\u5728\u7684\u5206\u7247\u5BF9\u5E94\u7684\u7D22\u5F15\u7F6E\u4E3A\u53EA\u8BFB\uFF0C\u4ECE\u800C\u4FDD\u62A4\u6574\u4E2A\u96C6\u7FA4\u3002\u8FD9\u4E00\u70B9\u5728\u6211\u56DE\u770B\u96C6\u7FA4\u78C1\u76D8\u76D1\u63A7\u65F6\uFF0C\u4E5F\u7684\u786E\u88AB\u8BC1\u5B9E\u4E86\uFF0C\u67D0\u4E00\u4E2A\u8282\u70B9\u78C1\u76D8\u8FBE\u5230\u4E8695%\u3002</p><p>\u56E0\u6B64\u66F4\u6539\u4E86\u521A\u521A\u90A3\u4E2A\u53C2\u6570\u4E4B\u540E\uFF0C\u8FD8\u5E94\u8BE5\u9488\u5BF9\u6027\u5730\u8FDB\u884C\u4E00\u4E9B\u6E05\u7406\uFF0C\u4ECE\u800C\u4F7F\u8D1F\u8F7D\u964D\u4E0B\u6765\u3002</p>`,23);function t(e,o){return p}var r=s(a,[["render",t]]);export{r as default};
